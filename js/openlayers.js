var OpenLayers={singleFile:true};(function(){var g=(typeof OpenLayers=="object"&&OpenLayers.singleFile);window.OpenLayers={_scriptName:(!g)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){var n="";var s=OpenLayers._scriptName;var m=document.getElementsByTagName("script");for(var p=0,h=m.length;p<h;p++){var r=m[p].getAttribute("src");if(r){var o=r.lastIndexOf(s);var q=r.lastIndexOf("?");if(q<0){q=r.length}if((o>-1)&&(o+s.length==q)){n=r.slice(0,q-s.length);break}}}return n}};if(!g){var j=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Events.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js");var a=navigator.userAgent;var c=(a.match("MSIE")||a.match("Safari"));if(c){var b=new Array(j.length)}var k=OpenLayers._getScriptLocation()+"lib/";for(var d=0,f=j.length;d<f;d++){if(c){b[d]="<script src='"+k+j[d]+"'><\/script>"}else{var l=document.createElement("script");l.src=k+j[d];var e=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;e.appendChild(l)}}if(c){document.write(b.join(""))}}})();OpenLayers.VERSION_NUMBER="$Revision: 8089 $";OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0)},contains:function(b,a){return(b.indexOf(a)!=-1)},trim:function(a){return a.replace(/^\s*(.*?)\s*$/,"$1")},camelize:function(f){var b=f.split("-");var e=b[0];for(var c=1,a=b.length;c<a;c++){var d=b[c];e+=d.charAt(0).toUpperCase()+d.substring(1)}return e},format:function(g,b,f){if(!b){b=window}var a=g.split("${");var j,h,c;for(var d=1,e=a.length;d<e;d++){j=a[d];h=j.indexOf("}");if(h>0){c=b[j.substring(0,h)];if(typeof c=="function"){c=f?c.apply(null,f):c()}a[d]=c+j.substring(++h)}else{a[d]="${"+j}}return a.join("")},numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a)}}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,c){var b=0;if(c>0){b=parseFloat(a.toPrecision(c))}return b},format:function(d,a,g,i){a=(typeof a!="undefined")?a:0;g=(typeof g!="undefined")?g:OpenLayers.Number.thousandsSeparator;i=(typeof i!="undefined")?i:OpenLayers.Number.decimalSeparator;if(a!=null){d=parseFloat(d.toFixed(a))}var b=d.toString().split(".");if(b.length==1&&a==null){a=0}var c=b[0];if(g){var e=/(-?[0-9]+)([0-9]{3})/;while(e.test(c)){c=c.replace(e,"$1"+g+"$2")}}var f;if(a==0){f=c}else{var h=b.length>1?b[1]:"0";if(a!=null){h=h+new Array(a-h.length+1).join("0")}f=c+i+h}return f}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a)}}OpenLayers.Function={bind:function(c,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var d=a.concat(Array.prototype.slice.apply(arguments,[0]));return c.apply(b,d)}},bindAsEventListener:function(b,a){return function(c){return b.call(a,c||window.event)}}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a)}}OpenLayers.Array={filter:function(g,e,c){var d=[];if(Array.prototype.filter){d=g.filter(e,c)}else{var a=g.length;if(typeof e!="function"){throw new TypeError()}for(var b=0;b<a;b++){if(b in g){var f=g[b];if(e.call(c,f,b,g)){d.push(f)}}}}return d}};OpenLayers.Class=function(){var d=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}};var f={};var c,b;for(var e=0,a=arguments.length;e<a;++e){if(typeof arguments[e]=="function"){if(e==0&&a>1){b=arguments[e].prototype.initialize;arguments[e].prototype.initialize=function(){};f=new arguments[e];arguments[e].prototype.initialize=b}c=arguments[e].prototype}else{c=arguments[e]}OpenLayers.Util.extend(f,c)}d.prototype=f;return d};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(){var c=arguments[0];var e=new c(OpenLayers.Class.isPrototype);for(var d=1,a=arguments.length;d<a;d++){if(typeof arguments[d]=="function"){var b=arguments[d];arguments[d]=new b(OpenLayers.Class.isPrototype)}OpenLayers.Util.extend(e,arguments[d])}return e};OpenLayers.Util={};OpenLayers.Util.getElement=function(){var b=[];for(var d=0,a=arguments.length;d<a;d++){var c=arguments[d];if(typeof c=="string"){c=document.getElementById(c)}if(arguments.length==1){return c}b.push(c)}return b};if($==null){var $=OpenLayers.Util.getElement}OpenLayers.Util.extend=function(e,b){e=e||{};if(b){for(var a in b){var d=b[a];if(d!==undefined){e[a]=d}}var c=typeof window.Event=="function"&&b instanceof window.Event;if(!c&&b.hasOwnProperty&&b.hasOwnProperty("toString")){e.toString=b.toString}}return e};OpenLayers.Util.removeItem=function(c,b){for(var a=c.length-1;a>=0;a--){if(c[a]==b){c.splice(a,1)}}return c};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0};OpenLayers.Util.indexOf=function(d,c){for(var b=0,a=d.length;b<a;b++){if(d[b]==c){return b}}return -1};OpenLayers.Util.modifyDOMElement=function(b,h,e,f,a,d,g,c){if(h){b.id=h}if(e){b.style.left=e.x+"px";b.style.top=e.y+"px"}if(f){b.style.width=f.w+"px";b.style.height=f.h+"px"}if(a){b.style.position=a}if(d){b.style.border=d}if(g){b.style.overflow=g}if(parseFloat(c)>=0&&parseFloat(c)<1){b.style.filter="alpha(opacity="+(c*100)+")";b.style.opacity=c}else{if(parseFloat(c)==1){b.style.filter="";b.style.opacity=""}}};OpenLayers.Util.createDiv=function(a,i,h,c,g,f,d,b){var e=document.createElement("div");if(c){e.style.backgroundImage="url("+c+")"}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!g){g="absolute"}OpenLayers.Util.modifyDOMElement(e,a,i,h,g,f,d,b);return e};OpenLayers.Util.createImage=function(a,i,g,c,f,e,b,h){var d=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!f){f="relative"}OpenLayers.Util.modifyDOMElement(d,a,i,g,f,e,null,b);if(h){d.style.display="none";OpenLayers.Event.observe(d,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,d));OpenLayers.Event.observe(d,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,d))}d.style.alt=a;d.galleryImg="no";if(c){d.src=c}return d};OpenLayers.Util.setOpacity=function(a,b){OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,b)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.backgroundColor="transparent";this.style.display=""}};OpenLayers.Util.onImageLoadErrorColor="pink";OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var d=this.urls;if(d&&d instanceof Array&&d.length>1){var e=this.src.toString();var c,a;for(a=0;c=d[a];a++){if(e.indexOf(c)!=-1){break}}var f=Math.floor(d.length*Math.random());var b=d[f];a=0;while(b==c&&a++<4){f=Math.floor(d.length*Math.random());b=d[f]}this.src=e.replace(c,b)}else{this.src=this.src}}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var d=navigator.appVersion.split("MSIE");var a=parseFloat(d[1]);var b=false;try{b=!!(document.body.filters)}catch(c){}OpenLayers.Util.alphaHackNeeded=(b&&(a>=5.5)&&(a<7))}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,j,i,d,h,f,e,c){OpenLayers.Util.modifyDOMElement(a,b,j,i,h,null,null,c);var g=a.childNodes[0];if(d){g.src=d}OpenLayers.Util.modifyDOMElement(g,a.id+"_innerImage",null,i,"relative",f);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block"}if(e==null){e="scale"}a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+g.src+"', sizingMethod='"+e+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}g.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(b,k,i,d,h,f,e,c,j){var a=OpenLayers.Util.createDiv();var g=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);a.appendChild(g);if(j){g.style.display="none";OpenLayers.Event.observe(g,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(g,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a))}OpenLayers.Util.modifyAlphaImageDiv(a,b,k,i,d,h,f,e,c);return a};OpenLayers.Util.upperCaseObject=function(b){var c={};for(var a in b){c[a.toUpperCase()]=b[a]}return c};OpenLayers.Util.applyDefaults=function(d,c){d=d||{};var b=typeof window.Event=="function"&&c instanceof window.Event;for(var a in c){if(d[a]===undefined||(!b&&c.hasOwnProperty&&c.hasOwnProperty(a)&&!d.hasOwnProperty(a))){d[a]=c[a]}}if(!b&&c&&c.hasOwnProperty&&c.hasOwnProperty("toString")&&!d.hasOwnProperty("toString")){d.toString=c.toString}return d};OpenLayers.Util.getParameterString=function(h){var g=[];for(var c in h){var e=h[c];if((e!=null)&&(typeof e!="function")){var b;if(typeof e=="object"&&e.constructor==Array){var f=[];for(var d=0,a=e.length;d<a;d++){f.push(encodeURIComponent(e[d]))}b=f.join(",")}else{b=encodeURIComponent(e)}g.push(encodeURIComponent(c)+"="+b)}}return g.join("&")};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")};OpenLayers.Util.Try=function(){var b=null;for(var c=0,a=arguments.length;c<a;c++){var d=arguments[c];try{b=d();break}catch(f){}}return b};OpenLayers.Util.getNodes=function(c,b){var a=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(c.documentElement.childNodes,b)},function(){return OpenLayers.Util._getNodes(c.childNodes,b)});return a};OpenLayers.Util._getNodes=function(b,c){var e=[];for(var d=0,a=b.length;d<a;d++){if(b[d].nodeName==c){e.push(b[d])}}return e};OpenLayers.Util.getTagText=function(a,c,b){var d=OpenLayers.Util.getNodes(a,c);if(d&&(d.length>0)){if(!b){b=0}if(d[b].childNodes.length>1){return d.childNodes[1].nodeValue}else{if(d[b].childNodes.length==1){return d[b].firstChild.nodeValue}}}else{return""}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent}if(!b){b=a.firstChild.nodeValue}},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,c){var b=(a.relatedTarget)?a.relatedTarget:a.toElement;while(b!=c&&b!=null){b=b.parentNode}return(b!=c)};OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.distVincenty=function(h,g){var N=6378137,M=6356752.3142,H=1/298.257223563;var o=OpenLayers.Util.rad(g.lon-h.lon);var K=Math.atan((1-H)*Math.tan(OpenLayers.Util.rad(h.lat)));var J=Math.atan((1-H)*Math.tan(OpenLayers.Util.rad(g.lat)));var n=Math.sin(K),j=Math.cos(K);var m=Math.sin(J),i=Math.cos(J);var c=o,k=2*Math.PI;var e=20;while(Math.abs(c-k)>1e-12&&--e>0){var D=Math.sin(c),q=Math.cos(c);var O=Math.sqrt((i*D)*(i*D)+(j*m-n*i*q)*(j*m-n*i*q));if(O==0){return 0}var F=n*m+j*i*q;var z=Math.atan2(O,F);var l=Math.asin(j*i*D/O);var G=Math.cos(l)*Math.cos(l);var p=F-2*n*m/G;var u=H/16*G*(4+H*(4-3*G));k=c;c=o+(1-u)*H*Math.sin(l)*(z+u*O*(p+u*F*(-1+2*p*p)))}if(e==0){return NaN}var t=G*(N*N-M*M)/(M*M);var w=1+t/16384*(4096+t*(-768+t*(320-175*t)));var v=t/1024*(256+t*(-128+t*(74-47*t)));var E=v*O*(p+v/4*(F*(-1+2*p*p)-v/6*p*(-3+4*O*O)*(-3+4*p*p)));var r=M*w*(z-E);var I=r.toFixed(3)/1000;return I};OpenLayers.Util.getParameters=function(b){b=b||window.location.href;var a="";if(OpenLayers.String.contains(b,"?")){var d=b.indexOf("?")+1;var e=OpenLayers.String.contains(b,"#")?b.indexOf("#"):b.length;a=b.substring(d,e)}var o={};var c=a.split(/[&;]/);for(var h=0,k=c.length;h<k;++h){var g=c[h].split("=");if(g[0]){var m=decodeURIComponent(g[0]);var l=g[1]||"";l=l.split(",");for(var f=0,n=l.length;f<n;f++){l[f]=decodeURIComponent(l[f])}if(l.length==1){l=l[0]}o[m]=l}}return o};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_"}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a};OpenLayers.Util.getResolutionFromScale=function(d,a){if(a==null){a="degrees"}var c=OpenLayers.Util.normalizeScale(d);var b=1/(c*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH);return b};OpenLayers.Util.getScaleFromResolution=function(b,a){if(a==null){a="degrees"}var c=b*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH;return c};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true)};OpenLayers.Util.pagePosition=function(d){var b=0,g=0;var a=d;var f=d;while(a){if(a==document.body){if(OpenLayers.Element.getStyle(f,"position")=="absolute"){break}}b+=a.offsetTop||0;g+=a.offsetLeft||0;f=a;try{a=a.offsetParent}catch(c){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:a.id}));break}}a=d;while(a){b-=a.scrollTop||0;g-=a.scrollLeft||0;a=a.parentNode}return[g,b]};OpenLayers.Util.isEquivalentUrl=function(h,g,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var b=OpenLayers.Util.createUrlObject(h,c);var d=OpenLayers.Util.createUrlObject(g,c);for(var a in b){if(c.test){OpenLayers.Console.userError(a+"\n1:"+b[a]+"\n2:"+d[a])}var f=b[a];var e=d[a];switch(a){case"args":break;case"host":case"port":case"protocol":if((f=="")||(e=="")){break}default:if((a!="args")&&(b[a]!=d[a])){return false}break}}for(var a in b.args){if(b.args[a]!=d.args[a]){return false}delete d.args[a]}for(var a in d.args){return false}return true};OpenLayers.Util.createUrlObject=function(e,i){i=i||{};var q={};if(i.ignoreCase){e=e.toLowerCase()}var r=document.createElement("a");r.href=e;q.host=r.host;var l=r.port;if(l.length<=0){var s=q.host.length-(l.length);q.host=q.host.substring(0,s)}q.protocol=r.protocol;q.port=((l=="80")&&(i.ignorePort80))?"":l;q.hash=(i.ignoreHash)?"":r.hash;var j=r.search;if(!j){var k=e.indexOf("?");j=(k!=-1)?e.substr(k):""}q.args=OpenLayers.Util.getParameters(j);if(((q.protocol=="file:")&&(e.indexOf("file:")!=-1))||((q.protocol!="file:")&&(q.host!=""))){q.pathname=r.pathname;var c=q.pathname.indexOf("?");if(c!=-1){q.pathname=q.pathname.substring(0,c)}}else{var d=OpenLayers.Util.removeTail(e);var o=0;do{var f=d.indexOf("../");if(f==0){o++;d=d.substr(3)}else{if(f>=0){var b=d.substr(0,f-1);var n=b.indexOf("/");b=(n!=-1)?b.substr(0,n+1):"";var p=d.substr(f+3);d=b+p}}}while(f!=-1);var h=document.createElement("a");var t=window.location.href;if(i.ignoreCase){t=t.toLowerCase()}h.href=t;q.protocol=h.protocol;var m=(h.pathname.indexOf("/")!=-1)?"/":"\\";var g=h.pathname.split(m);g.pop();while((o>0)&&(g.length>0)){g.pop();o--}d=g.join("/")+"/"+d;q.pathname=d}if((q.protocol=="file:")||(q.protocol=="")){q.host="localhost"}return q};OpenLayers.Util.removeTail=function(b){var c=null;var a=b.indexOf("?");var d=b.indexOf("#");if(a==-1){c=(d!=-1)?b.substr(0,d):b}else{c=(d!=-1)?b.substr(0,Math.min(a,d)):b.substr(0,a)}return c};OpenLayers.Util.getBrowserName=function(){var b="";var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1){b="opera"}else{if(a.indexOf("msie")!=-1){b="msie"}else{if(a.indexOf("safari")!=-1){b="safari"}else{if(a.indexOf("mozilla")!=-1){if(a.indexOf("firefox")!=-1){b="firefox"}else{b="mozilla"}}}}}return b};OpenLayers.Util.getRenderedDimensions=function(b,d,c){var a,e;var g=document.createElement("div");g.style.overflow="";g.style.position="absolute";g.style.left="-9999px";if(d){if(d.w){a=d.w;g.style.width=a+"px"}else{if(d.h){e=d.h;g.style.height=e+"px"}}}if(c&&c.displayClass){g.className=c.displayClass}var f=document.createElement("div");f.innerHTML=b;g.appendChild(f);document.body.appendChild(g);if(!a){a=parseInt(f.scrollWidth);g.style.width=a+"px"}if(!e){e=parseInt(f.scrollHeight)}g.removeChild(f);document.body.removeChild(g);return new OpenLayers.Size(a,e)};OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(a==null){var e=null;var d=null;var b=0;var c=0;e=document.createElement("div");e.style.position="absolute";e.style.top="-1000px";e.style.left="-1000px";e.style.width="100px";e.style.height="50px";e.style.overflow="hidden";d=document.createElement("div");d.style.width="100%";d.style.height="200px";e.appendChild(d);document.body.appendChild(e);b=d.offsetWidth;e.style.overflow="scroll";c=d.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(b-c);a=OpenLayers.Util._scrollbarWidth}return a};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(d,c){d=OpenLayers.Util.getElement(d);this._setOptions(c);var b=this.options.color;if(this.options.color=="fromElement"){b=this._background(d)}var a=this.options.bgColor;if(this.options.bgColor=="fromParent"){a=this._background(d.offsetParent)}this._roundCornersImpl(d,b,a)},changeColor:function(b,a){b.style.backgroundColor=a;var c=b.parentNode.getElementsByTagName("span");for(var d=0;d<c.length;d++){c[d].style.backgroundColor=a}},changeOpacity:function(a,f){var d=f;var c="alpha(opacity="+f*100+")";a.style.opacity=d;a.style.filter=c;var b=a.parentNode.getElementsByTagName("span");for(var e=0;e<b.length;e++){b[e].style.opacity=d;b[e].style.filter=c}},reRound:function(a,c){var b=a.parentNode.childNodes[0];var d=a.parentNode.childNodes[2];a.parentNode.removeChild(b);a.parentNode.removeChild(d);this.round(a.parentNode,c)},_roundCornersImpl:function(c,b,a){if(this.options.border){this._renderBorder(c,a)}if(this._isTopRounded()){this._roundTopCorners(c,b,a)}if(this._isBottomRounded()){this._roundBottomCorners(c,b,a)}},_renderBorder:function(e,a){var c="1px solid "+this._borderColor(a);var b="border-left: "+c;var f="border-right: "+c;var d="style='"+b+";"+f+"'";e.innerHTML="<div "+d+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,c,a){var b=this._createCorner(a);for(var d=0;d<this.options.numSlices;d++){b.appendChild(this._createCornerSlice(c,a,d,"top"))}e.style.paddingTop=0;e.insertBefore(b,e.firstChild)},_roundBottomCorners:function(e,c,a){var b=this._createCorner(a);for(var d=(this.options.numSlices-1);d>=0;d--){b.appendChild(this._createCornerSlice(c,a,d,"bottom"))}e.style.paddingBottom=0;e.appendChild(b)},_createCorner:function(a){var b=document.createElement("div");b.style.backgroundColor=(this._isTransparent()?"transparent":a);return b},_createCornerSlice:function(d,b,g,a){var e=document.createElement("span");var c=e.style;c.backgroundColor=d;c.display="block";c.height="1px";c.overflow="hidden";c.fontSize="1px";var f=this._borderColor(d,b);if(this.options.border&&g==0){c.borderTopStyle="solid";c.borderTopWidth="1px";c.borderLeftWidth="0px";c.borderRightWidth="0px";c.borderBottomWidth="0px";c.height="0px";c.borderColor=f}else{if(f){c.borderColor=f;c.borderStyle="solid";c.borderWidth="0px 1px"}}if(!this.options.compact&&(g==(this.options.numSlices-1))){c.height="2px"}this._setMargin(e,g,a);this._setBorder(e,g,a);return e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(b,a){if(b=="transparent"){return a}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(a,b)}else{return""}}}},_setMargin:function(c,e,a){var b=this._marginSize(e);var d=a=="top"?this._whichSideTop():this._whichSideBottom();if(d=="left"){c.style.marginLeft=b+"px";c.style.marginRight="0px"}else{if(d=="right"){c.style.marginRight=b+"px";c.style.marginLeft="0px"}else{c.style.marginLeft=b+"px";c.style.marginRight=b+"px"}}},_setBorder:function(c,e,a){var b=this._borderSize(e);var d=a=="top"?this._whichSideTop():this._whichSideBottom();if(d=="left"){c.style.borderLeftWidth=b+"px";c.style.borderRightWidth="0px"}else{if(d=="right"){c.style.borderRightWidth=b+"px";c.style.borderLeftWidth="0px"}else{c.style.borderLeftWidth=b+"px";c.style.borderRightWidth=b+"px"}}if(this.options.border!=false){c.style.borderLeftWidth=b+"px";c.style.borderRightWidth=b+"px"}},_marginSize:function(e){if(this._isTransparent()){return 0}var d=[5,3,2,1];var b=[3,2,1,0];var c=[2,1];var a=[1,0];if(this.options.compact&&this.options.blend){return a[e]}else{if(this.options.compact){return c[e]}else{if(this.options.blend){return b[e]}else{return d[e]}}}},_borderSize:function(e){var d=[5,3,2,1];var a=[2,1,1,1];var b=[1,0];var c=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return b[e]}else{if(this.options.blend){return a[e]}else{if(this.options.border){return c[e]}else{if(this._isTransparent()){return d[e]}}}}}return 0},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true}}return false},_blend:function(c,a){var b=OpenLayers.Rico.Color.createFromHex(c);b.blend(OpenLayers.Rico.Color.createFromHex(a));return b},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:a}}})();OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(d,b,a,c){if(d!=null){this.left=parseFloat(d)}if(b!=null){this.bottom=parseFloat(b)}if(a!=null){this.right=parseFloat(a)}if(c!=null){this.top=parseFloat(c)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom))}return a},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")")},toArray:function(){return[this.left,this.bottom,this.right,this.top]},toBBOX:function(a){if(a==null){a=6}var b=Math.pow(10,a);var c=Math.round(this.left*b)/b+","+Math.round(this.bottom*b)/b+","+Math.round(this.right*b)/b+","+Math.round(this.top*b)/b;return c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(d,i){if(i==null){i=this.getCenterLonLat()}var e=[];var c,b;if(i.CLASS_NAME=="OpenLayers.LonLat"){c=i.lon;b=i.lat}else{c=i.x;b=i.y}var a=(this.left-c)*d+c;var f=(this.bottom-b)*d+b;var h=(this.right-c)*d+c;var g=(this.top-b)*d+b;return new OpenLayers.Bounds(a,f,h,g)},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Bounds(this.left+a,this.bottom+c,this.right+a,this.top+c)},extend:function(b){var a=null;if(b){switch(b.CLASS_NAME){case"OpenLayers.LonLat":a=new OpenLayers.Bounds(b.lon,b.lat,b.lon,b.lat);break;case"OpenLayers.Geometry.Point":a=new OpenLayers.Bounds(b.x,b.y,b.x,b.y);break;case"OpenLayers.Bounds":a=b;break}if(a){this.centerLonLat=null;if((this.left==null)||(a.left<this.left)){this.left=a.left}if((this.bottom==null)||(a.bottom<this.bottom)){this.bottom=a.bottom}if((this.right==null)||(a.right>this.right)){this.right=a.right}if((this.top==null)||(a.top>this.top)){this.top=a.top}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a)},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,d,c){if(c==null){c=true}var b=false;if(c){b=((a>=this.left)&&(a<=this.right)&&(d>=this.bottom)&&(d<=this.top))}else{b=((a>this.left)&&(a<this.right)&&(d>this.bottom)&&(d<this.top))}return b},intersectsBounds:function(c,f){if(f==null){f=true}var b=(c.bottom==this.bottom&&c.top==this.top)?true:(((c.bottom>this.bottom)&&(c.bottom<this.top))||((this.bottom>c.bottom)&&(this.bottom<c.top)));var e=(c.bottom==this.bottom&&c.top==this.top)?true:(((c.top>this.bottom)&&(c.top<this.top))||((this.top>c.bottom)&&(this.top<c.top)));var a=(c.right==this.right&&c.left==this.left)?true:(((c.right>this.left)&&(c.right<this.right))||((this.right>c.left)&&(this.right<c.right)));var d=(c.right==this.right&&c.left==this.left)?true:(((c.left>this.left)&&(c.left<this.right))||((this.left>c.left)&&(this.left<c.right)));return(this.containsBounds(c,true,f)||c.containsBounds(this,true,f)||((e||b)&&(d||a)))},containsBounds:function(c,d,g){if(d==null){d=false}if(g==null){g=true}var e;var f;var b;var a;if(g){e=(c.left>=this.left)&&(c.left<=this.right);f=(c.top>=this.bottom)&&(c.top<=this.top);b=(c.right>=this.left)&&(c.right<=this.right);a=(c.bottom>=this.bottom)&&(c.bottom<=this.top)}else{e=(c.left>this.left)&&(c.left<this.right);f=(c.top>this.bottom)&&(c.top<this.top);b=(c.right>this.left)&&(c.right<this.right);a=(c.bottom>this.bottom)&&(c.bottom<this.top)}return(d)?(f||a)&&(e||b):(f&&e&&a&&b)},determineQuadrant:function(a){var b="";var c=this.getCenterLonLat();b+=(a.lat<c.lat)?"b":"t";b+=(a.lon<c.lon)?"l":"r";return b},transform:function(a,c){this.centerLonLat=null;var e=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,c);var b=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,c);var d=OpenLayers.Projection.transform({x:this.left,y:this.top},a,c);var f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,c);this.left=Math.min(e.x,d.x);this.bottom=Math.min(e.y,b.y);this.right=Math.max(b.x,f.x);this.top=Math.max(d.y,f.y);return this},wrapDateLine:function(e,c){c=c||{};var d=c.leftTolerance||0;var b=c.rightTolerance||0;var a=this.clone();if(e){while(a.left<e.left&&(a.right-b)<=e.left){a=a.add(e.getWidth(),0)}while((a.left+d)>=e.right&&a.right>e.right){a=a.add(-e.getWidth(),0)}}return a},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(b){var a=b.split(",");return OpenLayers.Bounds.fromArray(a)};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b};OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none"},toggle:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);var d=OpenLayers.Element.visible(b)?"hide":"show";OpenLayers.Element[d](b)}},hide:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);b.style.display="none"}},show:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);b.style.display=""}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},getDimensions:function(c){c=OpenLayers.Util.getElement(c);if(OpenLayers.Element.getStyle(c,"display")!="none"){return{width:c.offsetWidth,height:c.offsetHeight}}var d=c.style;var a=d.visibility;var b=d.position;d.visibility="hidden";d.position="absolute";d.display="";var f=c.clientWidth;var e=c.clientHeight;d.display="none";d.position=b;d.visibility=a;return{width:f,height:e}},hasClass:function(b,a){var c=b.className;return(!!c&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(c))},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a}return b},removeClass:function(b,a){var c=b.className;if(c){b.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)")," "))}return b},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a)}else{OpenLayers.Element.addClass(b,a)}return b},getStyle:function(b,d){b=OpenLayers.Util.getElement(b);var e=null;if(b&&b.style){e=b.style[OpenLayers.String.camelize(d)];if(!e){if(document.defaultView&&document.defaultView.getComputedStyle){var c=document.defaultView.getComputedStyle(b,null);e=c?c.getPropertyValue(d):null}else{if(b.currentStyle){e=b.currentStyle[OpenLayers.String.camelize(d)]}}}var a=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(a,d)!=-1)&&(OpenLayers.Element.getStyle(b,"position")=="static")){e="auto"}}return e=="auto"?null:e}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=parseFloat(b);this.lat=parseFloat(a)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(c,a){if((c==null)||(a==null)){var b=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.LonLat(this.lon+c,this.lat+a)},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)))}return a},transform:function(b,c){var a=OpenLayers.Projection.transform({x:this.lon,y:this.lat},b,c);this.lon=a.x;this.lat=a.y;return this},wrapDateLine:function(b){var a=this.clone();if(b){while(a.lon<b.left){a.lon+=b.getWidth()}while(a.lon>b.right){a.lon-=b.getWidth()}}return a},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(parseFloat(a[0]),parseFloat(a[1]))};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(b){var a=false;if(b!=null){a=((this.x==b.x&&this.y==b.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(b.x)&&isNaN(b.y)))}return a},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Pixel(this.x+a,this.y+c)},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)))}return a},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var b=document.getElementsByTagName("script");for(var c=0,a=b.length;c<a;++c){if(b[c].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a)}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=function(){return(false)}}if(this.title!=""){this.div.title=this.title}}if(a!=null){this.position=a.clone()}this.moveTo(this.position);return this.div},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(b,c,d,a){this.url=b;this.size=(c)?c:new OpenLayers.Size(20,20);this.offset=d?d:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=a;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null){this.size=a}this.draw()},setUrl:function(a){if(a!=null){this.url=a}this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null){this.px=a}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b)}}},display:function(a){this.imageDiv.style.display=(a)?"":"none"},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(b){var d;if(!b){b=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language}var c=b.split("-");c[0]=c[0].toLowerCase();if(typeof OpenLayers.Lang[c[0]]=="object"){d=c[0]}if(c[1]){var a=c[0]+"-"+c[1].toUpperCase();if(typeof OpenLayers.Lang[a]=="object"){d=a}}if(!d){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language");d=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=d},translate:function(b,a){var d=OpenLayers.Lang[OpenLayers.Lang.getCode()];var c=d[b];if(!c){c=b}if(a){c=OpenLayers.String.format(c,a)}return c}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,closeOnMove:false,map:null,initialize:function(g,a,f,b,e,d){if(g==null){g=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=g;this.lonlat=a;this.contentSize=(f!=null)?f:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(b!=null){this.contentHTML=b}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var c=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden");var g=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(g,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(e){this.addCloseBox(d)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null);var b=c.getPropertyValue("overflow");if(b!="hidden"){this.contentDiv._oldOverflow=b;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null}})}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a)}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){OpenLayers.Element.hide(this.div)},setSize:function(c){this.size=c.clone();var a=this.getContentDivPadding();var b=a.left+a.right;var e=a.top+a.bottom;this.fixPadding();b+=this.padding.left+this.padding.right;e+=this.padding.top+this.padding.bottom;if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);b+=d+a.right}this.size.w+=b;this.size.h+=e;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=a.left+a.right;this.contentSize.h+=a.bottom+a.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=c.w+"px";this.contentDiv.style.height=c.h+"px"}},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"<div>";var d=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass});var a=this.getSafeContentSize(d);var c=null;if(a.equals(d)){c=d}else{var g=new OpenLayers.Size();g.w=(a.w<d.w)?a.w:null;g.h=(a.h<d.h)?a.h:null;if(g.w&&g.h){c=a}else{var h=OpenLayers.Util.getRenderedDimensions(e,g,{displayClass:this.contentDisplayClass});var b=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((b!="hidden")&&(h.equals(a))){var f=OpenLayers.Util.getScrollbarWidth();if(g.w){h.h+=f}else{h.w+=f}}c=this.getSafeContentSize(h)}}this.setSize(c)},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(a){if(a!=undefined){this.opacity=a}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined){this.border=a}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(a){if(a!=null){this.contentHTML=a}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var f=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var e=this.contentDiv.getElementsByTagName("img");for(var d=0,a=e.length;d<a;d++){var b=e[d];if(b.width==0||b.height==0){var c={popup:this,img:b};b._onImgLoad=OpenLayers.Function.bind(f,c);OpenLayers.Event.observe(b,"load",b._onImgLoad)}}},getSafeContentSize:function(c){var e=c.clone();var a=this.getContentDivPadding();var b=a.left+a.right;var h=a.top+a.bottom;this.fixPadding();b+=this.padding.left+this.padding.right;h+=this.padding.top+this.padding.bottom;if(this.closeDiv){var g=parseInt(this.closeDiv.style.width);b+=g+a.right}if(this.minSize){e.w=Math.max(e.w,(this.minSize.w-b));e.h=Math.max(e.h,(this.minSize.h-h))}if(this.maxSize){e.w=Math.min(e.w,(this.maxSize.w-b));e.h=Math.min(e.h,(this.maxSize.h-h))}if(this.map&&this.map.size){var d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-h;var f=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-b;e.w=Math.min(e.w,f);e.h=Math.min(e.h,d)}return e},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){this.div.style.display="none";document.body.appendChild(this.div);a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;document.body.removeChild(this.div);this.div.style.display=""}return a},addCloseBox:function(c){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+"px";this.closeDiv.style.top=a.top+"px";this.groupDiv.appendChild(this.closeDiv);var b=c||function(d){this.hide();OpenLayers.Event.stop(d)};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(b,this))},panIntoView:function(){var e=this.map.getSize();var c=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var d=c.clone();if(c.x<this.map.paddingForPopups.left){d.x=this.map.paddingForPopups.left}else{if((c.x+this.size.w)>(e.w-this.map.paddingForPopups.right)){d.x=e.w-this.map.paddingForPopups.right-this.size.w}}if(c.y<this.map.paddingForPopups.top){d.y=this.map.paddingForPopups.top}else{if((c.y+this.size.h)>(e.h-this.map.paddingForPopups.bottom)){d.y=e.h-this.map.paddingForPopups.bottom-this.size.h}}var b=c.x-d.x;var a=c.y-d.y;this.map.pan(b,a)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true)},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true)}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true)}},onclick:function(a){OpenLayers.Event.stop(a,true)},onmouseout:function(a){this.mousedown=false},ondblclick:function(a){OpenLayers.Event.stop(a,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){this.options=null;this.format=null},read:function(){},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Renderer=OpenLayers.Class({container:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null}},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(b,c){if(c==null){c=b.style}if(b.geometry){var a=b.geometry.getBounds();if(a){if(!a.intersectsBounds(this.extent)){c={display:"none"}}return this.drawGeometry(b.geometry,c,b.id)}}},drawGeometry:function(c,a,b){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(b){if(!(b instanceof Array)){b=[b]}for(var c=0,a=b.length;c<a;++c){this.eraseGeometry(b[c].geometry)}},eraseGeometry:function(a){},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},issue:function(g){var d=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});g=OpenLayers.Util.applyDefaults(g,d);var e=new OpenLayers.Request.XMLHttpRequest();var a=g.url;if(g.params){var c=OpenLayers.Util.getParameterString(g.params);if(c.length>0){var f=(a.indexOf("?")>-1)?"&":"?";a+=f+c}}if(g.proxy&&(a.indexOf("http")==0)){a=g.proxy+encodeURIComponent(a)}e.open(g.method,a,g.async,g.user,g.password);for(var b in g.headers){e.setRequestHeader(b,g.headers[b])}var i=(g.scope)?OpenLayers.Function.bind(g.callback,g.scope):g.callback;var j;if(g.success){j=(g.scope)?OpenLayers.Function.bind(g.success,g.scope):g.success}var h;if(g.failure){h=(g.scope)?OpenLayers.Function.bind(g.failure,g.scope):g.failure}e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){i(e);if(j&&(!e.status||(e.status>=200&&e.status<300))){j(e)}if(h&&(e.status&&(e.status<200||e.status>=300))){h(e)}}};e.send(g.data);return e},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a)}};OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut},start:function(c,a,d,b){this.playing=true;this.begin=c;this.finish=a;this.duration=d;this.callbacks=b.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var g={};for(var d in this.begin){var a=this.begin[d];var e=this.finish[d];if(a==null||e==null||isNaN(a)||isNaN(e)){OpenLayers.Console.error("invalid value for Tween")}var h=e-a;g[d]=this.easing.apply(this,[this.time,a,h,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,g)}if(this.time>this.duration){if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);this.playing=false}window.clearInterval(this.interval);this.interval=null}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,a,g,f){return g*e/f+a},easeOut:function(e,a,g,f){return g*e/f+a},easeInOut:function(e,a,g,f){return g*e/f+a},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a},easeOut:function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a},easeInOut:function(e,a,g,f){if(e==0){return a}if(e==f){return a+g}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a}return g/2*(-Math.pow(2,-10*--e)+2)+a},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,a,g,f){return g*(e/=f)*e+a},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a},easeInOut:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(c,b,a){this.rgb={r:c,g:b,b:a}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(b){var a=this.asHSB();a.h=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setSaturation:function(b){var a=this.asHSB();a.s=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setBrightness:function(a){var c=this.asHSB();c.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},darken:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.max(a.b-b,0))},brighten:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.min(a.b+b,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){var a=this.asHSB();return this.asHSB().b>0.5},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(c){if(c.length==4){var e=c;var c="#";for(var b=1;b<4;b++){c+=(e.charAt(b)+e.charAt(b))}}if(c.indexOf("#")==0){c=c.substring(1)}var f=c.substring(0,2);var d=c.substring(2,4);var a=c.substring(4,6);return new OpenLayers.Rico.Color(parseInt(f,16),parseInt(d,16),parseInt(a,16))};OpenLayers.Rico.Color.createColorFromBackground=function(d){var a=RicoUtil.getElementsComputedStyle(OpenLayers.Util.getElement(d),"backgroundColor","background-color");if(a=="transparent"&&d.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(d.parentNode)}if(a==null){return new OpenLayers.Rico.Color(255,255,255)}if(a.indexOf("rgb(")==0){var c=a.substring(4,a.length-1);var b=c.split(",");return new OpenLayers.Rico.Color(parseInt(b[0]),parseInt(b[1]),parseInt(b[2]))}else{if(a.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(a)}else{return new OpenLayers.Rico.Color(255,255,255)}}};OpenLayers.Rico.Color.HSBtoRGB=function(i,c,k){var d=0;var e=0;var l=0;if(c==0){d=parseInt(k*255+0.5);e=d;l=d}else{var g=(i-Math.floor(i))*6;var j=g-Math.floor(g);var b=k*(1-c);var a=k*(1-c*j);var m=k*(1-(c*(1-j)));switch(parseInt(g)){case 0:d=(k*255+0.5);e=(m*255+0.5);l=(b*255+0.5);break;case 1:d=(a*255+0.5);e=(k*255+0.5);l=(b*255+0.5);break;case 2:d=(b*255+0.5);e=(k*255+0.5);l=(m*255+0.5);break;case 3:d=(b*255+0.5);e=(a*255+0.5);l=(k*255+0.5);break;case 4:d=(m*255+0.5);e=(b*255+0.5);l=(k*255+0.5);break;case 5:d=(k*255+0.5);e=(b*255+0.5);l=(a*255+0.5);break}}return{r:parseInt(d),g:parseInt(e),b:parseInt(l)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,h,j){var f;var d;var k;var l=(a>h)?a:h;if(j>l){l=j}var i=(a<h)?a:h;if(j<i){i=j}k=l/255;if(l!=0){d=(l-i)/l}else{d=0}if(d==0){f=0}else{var c=(l-a)/(l-i);var m=(l-h)/(l-i);var e=(l-j)/(l-i);if(a==l){f=e-m}else{if(h==l){f=2+c-e}else{f=4+m-c}}f=f/6;if(f<0){f=f+1}}return{h:f,s:d,b:k}};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var c=0,a=this.map.controls.length;c<a;c++){var d=this.map.controls[c];if((d!=this)&&(d.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(d.displayProjection!=this.displayProjection){this.displayProjection=d.displayProjection}break}}if(c==this.map.controls.length){var b=OpenLayers.Util.getParameters();if(b.layers){this.layers=b.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(b.lat&&b.lon){this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat));if(b.zoom){this.zoom=parseInt(b.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var d=0,a=this.layers.length;d<a;d++){var b=this.map.layers[d];var e=this.layers.charAt(d);if(e=="B"){this.map.setBaseLayer(b)}else{if((e=="T")||(e=="F")){b.setVisibility(e=="T")}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var d=[];if(this.map&&this.map.layers){for(var c=0,a=this.map.layers.length;c<a;c++){var b=this.map.layers[c];if(b.attribution&&b.getVisibility()){d.push(b.attribution)}}this.div.innerHTML=d.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{activeColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div);OpenLayers.Event.stopObservingElement(this.minimizeDiv);OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},clearLayersArray:function(b){var e=this[b+"Layers"];if(e){for(var d=0,a=e.length;d<a;d++){var c=e[d];OpenLayers.Event.stopObservingElement(c.inputElem);OpenLayers.Event.stopObservingElement(c.labelSpan)}}this[b+"LayersDiv"].innerHTML="";this[b+"Layers"]=[]},checkRedraw:function(){var d=false;if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){d=true}else{for(var c=0,a=this.layerStates.length;c<a;c++){var e=this.layerStates[c];var b=this.map.layers[c];if((e.name!=b.name)||(e.inRange!=b.inRange)||(e.id!=b.id)||(e.visibility!=b.visibility)){d=true;break}}}return d},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var c=false;var l=false;var h=this.map.layers.length;this.layerStates=new Array(h);for(var e=0;e<h;e++){var f=this.map.layers[e];this.layerStates[e]={name:f.name,visibility:f.visibility,inRange:f.inRange,id:f.id}}var d=this.map.layers.slice();if(!this.ascending){d.reverse()}for(var e=0,h=d.length;e<h;e++){var f=d[e];var o=f.isBaseLayer;if(f.displayInLayerSwitcher){if(o){l=true}else{c=true}var k=(o)?(f==this.map.baseLayer):f.getVisibility();var j=document.createElement("input");j.id=this.id+"_input_"+f.name;j.name=(o)?"baseLayers":f.name;j.type=(o)?"radio":"checkbox";j.value=f.name;j.checked=k;j.defaultChecked=k;if(!o&&!f.inRange){j.disabled=true}var a={inputElem:j,layer:f,layerSwitcher:this};OpenLayers.Event.observe(j,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var g=document.createElement("span");if(!o&&!f.inRange){g.style.color="gray"}g.innerHTML=f.name;g.style.verticalAlign=(o)?"bottom":"baseline";OpenLayers.Event.observe(g,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var n=document.createElement("br");var m=(o)?this.baseLayers:this.dataLayers;m.push({layer:f,inputElem:j,labelSpan:g});var b=(o)?this.baseLayersDiv:this.dataLayersDiv;b.appendChild(j);b.appendChild(g);b.appendChild(n)}}this.dataLbl.style.display=(c)?"":"none";this.baseLbl.style.display=(l)?"":"none";return this.div},onInputClick:function(a){if(!this.inputElem.disabled){if(this.inputElem.type=="radio"){this.inputElem.checked=true;this.layer.map.setBaseLayer(this.layer)}else{this.inputElem.checked=!this.inputElem.checked;this.layerSwitcher.updateMap()}}OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var c=0,b=this.baseLayers.length;c<b;c++){var a=this.baseLayers[c];if(a.inputElem.checked){this.map.setBaseLayer(a.layer,false)}}for(var c=0,b=this.dataLayers.length;c<b;c++){var a=this.dataLayers[c];a.layer.setVisibility(a.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="20em";this.div.style.height="";this.showControls(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(a!=null){OpenLayers.Event.stop(a)}},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){this.div.style.position="absolute";this.div.style.top="25px";this.div.style.right="0px";this.div.style.left="";this.div.style.fontFamily="sans-serif";this.div.style.fontWeight="bold";this.div.style.marginTop="3px";this.div.style.marginLeft="3px";this.div.style.marginBottom="3px";this.div.style.fontSize="smaller";this.div.style.color="white";this.div.style.backgroundColor="transparent";OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this));OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this));OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";this.layersDiv.style.paddingTop="5px";this.layersDiv.style.paddingLeft="10px";this.layersDiv.style.paddingBottom="5px";this.layersDiv.style.paddingRight="75px";this.layersDiv.style.backgroundColor=this.activeColor;this.layersDiv.style.width="100%";this.layersDiv.style.height="100%";this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("baseLayer");this.baseLbl.style.marginTop="3px";this.baseLbl.style.marginLeft="3px";this.baseLbl.style.marginBottom="3px";this.baseLayersDiv=document.createElement("div");this.baseLayersDiv.style.paddingLeft="10px";this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("overlays");this.dataLbl.style.marginTop="3px";this.dataLbl.style.marginLeft="3px";this.dataLbl.style.marginBottom="3px";this.dataLayersDiv=document.createElement("div");this.dataLayersDiv.style.paddingLeft="10px";if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.activeColor,blend:false});OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75);var c=OpenLayers.Util.getImagesLocation();var b=new OpenLayers.Size(18,18);var a=c+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,b,a,"absolute");this.maximizeDiv.style.top="5px";this.maximizeDiv.style.right="0px";this.maximizeDiv.style.left="";this.maximizeDiv.style.display="none";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var a=c+"layer-switcher-minimize.png";var b=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,b,a,"absolute");this.minimizeDiv.style.top="5px";this.minimizeDiv.style.right="0px";this.minimizeDiv.style.left="";this.minimizeDiv.style.display="none";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=true;this.ignoreEvent(a)},mouseUp:function(a){if(this.isMouseDown){this.isMouseDown=false;this.ignoreEvent(a)}},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}var a=!this.performedDrag;this.performedDrag=false;return a},defaultDblClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1);OpenLayers.Event.stop(a);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox)}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},defaultMouseMove:function(b){this.mousePosition=b.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var e=Math.abs(this.mouseDragStart.x-b.xy.x);var f=Math.abs(this.mouseDragStart.y-b.xy.y);this.zoomBox.style.width=Math.max(1,e)+"px";this.zoomBox.style.height=Math.max(1,f)+"px";if(b.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=b.xy.x+"px"}if(b.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=b.xy.y+"px"}}else{var e=this.mouseDragStart.x-b.xy.x;var f=this.mouseDragStart.y-b.xy.y;var c=this.map.getSize();var a=new OpenLayers.Pixel(c.w/2+e,c.h/2+f);var d=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(d,null,true);this.mouseDragStart=b.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox()}this.mouseDragStart=null}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)}},zoomBoxEnd:function(c){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-c.xy.x)>5||Math.abs(this.mouseDragStart.y-c.xy.y)>5){var h=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var b=this.map.getLonLatFromViewPortPx(c.xy);var g=Math.max(h.lat,b.lat);var e=Math.min(h.lat,b.lat);var f=Math.min(h.lon,b.lon);var d=Math.max(h.lon,b.lon);var a=new OpenLayers.Bounds(f,e,d,g);this.map.zoomToExtent(a)}else{var b=this.map.getLonLatFromViewPortPx(c.xy);this.map.setCenter(new OpenLayers.LonLat((b.lon),(b.lat)),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(c){var b=false;var a=OpenLayers.Event.element(c);while(a!=null){if(this.map&&a==this.map.div){b=true;break}a=a.parentNode}if(b){var d=0;if(!c){c=window.event}if(c.wheelDelta){d=c.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){d=-d}}else{if(c.detail){d=-c.detail/3}}if(d){c.xy=this.mousePosition;if(d<0){this.defaultWheelDown(c)}else{this.defaultWheelUp(c)}}OpenLayers.Event.stop(c)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.map){this.map.events.unregister("mousemove",this,this.redraw)}OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}this.redraw();return this.div},redraw:function(a){var c;if(a==null){c=new OpenLayers.LonLat(0,0)}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}c=this.map.getLonLatFromPixel(a.xy);if(!c){return}if(this.displayProjection){c.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=a.xy}var b=this.formatOutput(c);if(b!=this.element.innerHTML){this.element.innerHTML=b}},formatOutput:function(c){var a=parseInt(this.numDigits);var b=this.prefix+c.lon.toFixed(a)+this.separator+c.lat.toFixed(a)+this.suffix;return b},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("mousemove",this,this.redraw)},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,activateOnDraw:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.registry=OpenLayers.Util.extend({moveend:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution()}}},this.registry);this.clear();var a={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(a,this.previousOptions);this.previous=new OpenLayers.Control.Button(a);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions);this.next=new OpenLayers.Control.Button(c)},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate()}else{if(!b&&this.previous.active){this.previous.deactivate()}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate()}else{if(!b&&this.next.active){this.next.deactivate()}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();if(this.activateOnDraw){this.activate()}},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(b)}return a},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.nextStack=[]},restore:function(b){var a=this.map.getZoomForResolution(b.resolution);this.map.setCenter(b.center,a)},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b])}a=true;if(this.previousStack.length==0){this.initStack()}}}return a},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a])}if(this.clearOnDeactivate){this.clear()}b=true}}return b},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(b,a){this.direction=b;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[a])},trigger:function(){switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,this.slideFactor);break;case OpenLayers.Control.Pan.WEST:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(this.slideFactor,0);break}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);while(this.buttons.length){var a=this.buttons.shift();a.map=null;OpenLayers.Event.stopObservingElement(a)}this.buttons=null;this.position=null},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position;this.buttons=[];var c=new OpenLayers.Size(18,18);var b=new OpenLayers.Pixel(a.x+c.w/2,a.y);this._addButton("panup","north-mini.png",b,c);a.y=b.y+c.h;this._addButton("panleft","west-mini.png",a,c);this._addButton("panright","east-mini.png",a.add(c.w,0),c);this._addButton("pandown","south-mini.png",b.add(0,c.h*2),c);this._addButton("zoomin","zoom-plus-mini.png",b.add(0,c.h*3+5),c);this._addButton("zoomworld","zoom-world-mini.png",b.add(0,c.h*4+5),c);this._addButton("zoomout","zoom-minus-mini.png",b.add(0,c.h*5+5),c);return this.div},_addButton:function(f,a,e,d){var c=OpenLayers.Util.getImagesLocation()+a;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,e,d,c,"absolute");this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=f;b.map=this.map;b.slideFactor=this.slideFactor;this.buttons.push(b);return b},doubleClick:function(a){OpenLayers.Event.stop(a);return false},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"panup":this.map.pan(0,-this.slideFactor);break;case"pandown":this.map.pan(0,this.slideFactor);break;case"panleft":this.map.pan(-this.slideFactor,0);break;case"panright":this.map.pan(this.slideFactor,0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,defaultControl:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[]},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a=this.controls.length-1;a>=0;a--){if(this.controls[a].events){this.controls[a].events.un({activate:this.redraw,deactivate:this.redraw,scope:this})}OpenLayers.Event.stopObservingElement(this.controls[a].panel_div);this.controls[a].panel_div=null}},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var b=0,a=this.controls.length;b<a;b++){if(this.controls[b]==this.defaultControl){this.controls[b].activate()}}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.controls.length;b<a;b++){this.controls[b].deactivate()}return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);for(var b=0,a=this.controls.length;b<a;b++){this.map.addControl(this.controls[b]);this.controls[b].deactivate();this.controls[b].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.activate();return this.div},redraw:function(){this.div.innerHTML="";if(this.active){for(var c=0,a=this.controls.length;c<a;c++){var b=this.controls[c].panel_div;if(this.controls[c].active){b.className=this.controls[c].displayClass+"ItemActive"}else{b.className=this.controls[c].displayClass+"ItemInactive"}this.div.appendChild(b)}}},activateControl:function(c){if(!this.active){return false}if(c.type==OpenLayers.Control.TYPE_BUTTON){c.trigger();this.redraw();return}if(c.type==OpenLayers.Control.TYPE_TOGGLE){if(c.active){c.deactivate()}else{c.activate()}this.redraw();return}for(var b=0,a=this.controls.length;b<a;b++){if(this.controls[b]!=c){if(this.controls[b].type!=OpenLayers.Control.TYPE_TOGGLE){this.controls[b].deactivate()}}}c.activate()},addControls:function(d){if(!(d instanceof Array)){d=[d]}this.controls=this.controls.concat(d);for(var c=0,a=d.length;c<a;c++){var b=document.createElement("div");var e=document.createTextNode(" ");d[c].panel_div=b;if(d[c].title!=""){d[c].panel_div.title=d[c].title}OpenLayers.Event.observe(d[c].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,d[c]));OpenLayers.Event.observe(d[c].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}if(this.map){for(var c=0,a=d.length;c<a;c++){this.map.addControl(d[c]);d[c].deactivate();d[c].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.redraw()}},onClick:function(b,a){OpenLayers.Event.stop(a?a:window.event);this.activateControl(b)},getControlsBy:function(a,b){var d=(typeof b.test=="function");var c=OpenLayers.Array.filter(this.controls,function(e){return e[a]==b||(d&&b.test(e[a]))});return c},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a=this.map.getScale();if(!a){return}if(a>=9500&&a<=950000){a=Math.round(a/1000)+"K"}else{if(a>=950000){a=Math.round(a/1000000)+"M"}else{a=Math.round(a)}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:a})},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.div.style.display="block";this.div.style.position="absolute";this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(d){var b=parseInt(Math.log(d)/Math.log(10));var a=Math.pow(10,b);var c=parseInt(d/a);var e;if(c>5){e=5}else{if(c>2){e=2}else{e=1}}return e*a},update:function(){var h=this.map.getResolution();if(!h){return}var l=this.map.getUnits();var d=OpenLayers.INCHES_PER_UNIT;var j=this.maxWidth*h*d[l];var g;var e;if(j>100000){g=this.topOutUnits;e=this.bottomOutUnits}else{g=this.topInUnits;e=this.bottomInUnits}var b=j/d[g];var k=j/d[e];var f=this.getBarLen(b);var c=this.getBarLen(k);b=f/d[l]*d[g];k=c/d[l]*d[e];var a=b/h;var i=k/h;this.eTop.style.width=Math.round(a)+"px";this.eBottom.style.width=Math.round(i)+"px";this.eTop.innerHTML=f+" "+g;this.eBottom.innerHTML=c+" "+e},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)))},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}},findElement:function(c,b){var a=OpenLayers.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observe:function(f,d,b,e){var c=OpenLayers.Util.getElement(f);e=e||false;if(d=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||c.attachEvent)){d="keydown"}if(!this.observers){this.observers={}}if(!c._eventCacheID){var a="eventCacheID_";if(c.id){a=c.id+"_"+a}c._eventCacheID=OpenLayers.Util.createUniqueID(a)}var g=c._eventCacheID;if(!this.observers[g]){this.observers[g]=[]}this.observers[g].push({element:c,name:d,observer:b,useCapture:e});if(c.addEventListener){c.addEventListener(d,b,e)}else{if(c.attachEvent){c.attachEvent("on"+d,b)}}},stopObservingElement:function(b){var a=OpenLayers.Util.getElement(b);var c=a._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(e){if(e){for(var b=e.length-1;b>=0;b--){var c=e[b];var a=new Array(c.element,c.name,c.observer,c.useCapture);var d=OpenLayers.Event.stopObserving.apply(this,a)}}},stopObserving:function(j,a,g,f){f=f||false;var b=OpenLayers.Util.getElement(j);var c=b._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||b.detachEvent){a="keydown"}}var h=false;var d=OpenLayers.Event.observers[c];if(d){var e=0;while(!h&&e<d.length){var k=d[e];if((k.name==a)&&(k.observer==g)&&(k.useCapture==f)){d.splice(e,1);if(d.length==0){delete OpenLayers.Event.observers[c]}h=true;break}e++}}if(h){if(b.removeEventListener){b.removeEventListener(a,g,f)}else{if(b&&b.detachEvent){b.detachEvent("on"+a,g)}}}return h},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,initialize:function(e,b,g,f,d){OpenLayers.Util.extend(this,d);this.object=e;this.element=b;this.fallThrough=f;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.eventTypes=[];if(g!=null){for(var c=0,a=g.length;c<a;c++){this.addEventType(g[c])}}if(this.element!=null){this.attachToElement(b)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[]}},attachToElement:function(b){for(var d=0,a=this.BROWSER_EVENTS.length;d<a;d++){var c=this.BROWSER_EVENTS[d];this.addEventType(c);OpenLayers.Event.observe(b,c,this.eventHandler)}OpenLayers.Event.observe(b,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b])}}},register:function(b,d,c){if((c!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,b)!=-1)){if(d==null){d=this.object}var a=this.listeners[b];a.push({obj:d,func:c})}},registerPriority:function(b,d,c){if(c!=null){if(d==null){d=this.object}var a=this.listeners[b];if(a!=null){a.unshift({obj:d,func:c})}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b])}}},unregister:function(d,f,e){if(f==null){f=this.object}var b=this.listeners[d];if(b!=null){for(var c=0,a=b.length;c<a;c++){if(b[c].obj==f&&b[c].func==e){b.splice(c,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(e,b){if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=e}var c=(this.listeners[e])?this.listeners[e].slice():null;if((c!=null)&&(c.length>0)){var g;for(var d=0,a=c.length;d<a;d++){var f=c[d];g=f.func.apply(f.obj,[b]);if((g!=undefined)&&(g==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}}return g},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a)}this.triggerEvent(a.type,a)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",OpenLayers.Function.bind(this.clearMouseCache,this));this.element.hasScrollEvent=true}}if(!this.element.scrolls){this.element.scrolls=[];this.element.scrolls[0]=(document.documentElement.scrollLeft||document.body.scrollLeft);this.element.scrolls[1]=(document.documentElement.scrollTop||document.body.scrollTop)}if(!this.element.lefttop){this.element.lefttop=[];this.element.lefttop[0]=(document.documentElement.clientLeft||0);this.element.lefttop[1]=(document.documentElement.clientTop||0)}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1]}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",end:"",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type."};OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,anchor:null,initialize:function(h,a,g,b,c,f,e){var d=[h,a,g,b,f,e];OpenLayers.Popup.prototype.initialize.apply(this,d);this.anchor=(c!=null)?c:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(b){var a=this.relativePosition;this.relativePosition=this.calculateRelativePosition(b);var d=this.calculateNewPx(b);var c=new Array(d);OpenLayers.Popup.prototype.moveTo.apply(this,c);if(this.relativePosition!=a){this.updateRelativePosition()}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(c){var a=this.map.getLonLatFromLayerPx(c);var b=this.map.getExtent();var d=b.determineQuadrant(a);return OpenLayers.Bounds.oppositeQuadrant(d)},updateRelativePosition:function(){},calculateNewPx:function(b){var e=b.offset(this.anchor.offset);var a=this.size||this.contentSize;var d=(this.relativePosition.charAt(0)=="t");e.y+=(d)?-a.h:this.anchor.size.h;var c=(this.relativePosition.charAt(1)=="l");e.x+=(c)?-a.w:this.anchor.size.w;return e},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.projCode=a;if(window.Proj4js){this.proj=new Proj4js.Proj(a)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode()}else{return false}},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(c,b,a){if(!OpenLayers.Projection.transforms[c]){OpenLayers.Projection.transforms[c]={}}OpenLayers.Projection.transforms[c][b]=a};OpenLayers.Projection.transform=function(b,a,c){if(a.proj&&c.proj){b=Proj4js.transform(a.proj,c.proj,b)}else{if(a&&c&&OpenLayers.Projection.transforms[a.getCode()]&&OpenLayers.Projection.transforms[a.getCode()][c.getCode()]){OpenLayers.Projection.transforms[a.getCode()][c.getCode()](b)}}return b};OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:true,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return false},evaluateFilter:function(b,a){return a&&this.postReadFiltering?a.evaluate(b):true},CLASS_NAME:"OpenLayers.Protocol.SQL"});OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{root:null,canvas:null,features:null,geometryMap:null,initialize:function(a){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.geometryMap={}},eraseGeometry:function(a){this.eraseFeatures(this.features[this.geometryMap[a.id]][0])},supported:function(){var a=document.createElement("canvas");return !!a.getContext},setExtent:function(a){this.extent=a.clone();this.resolution=null;this.redraw()},setSize:function(a){this.size=a.clone();this.root.style.width=a.w+"px";this.root.style.height=a.h+"px";this.root.width=a.w;this.root.height=a.h;this.resolution=null},drawFeature:function(a,b){if(b==null){b=a.style}b=OpenLayers.Util.extend({fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1},b);this.features[a.id]=[a,b];this.geometryMap[a.geometry.id]=a.id;this.redraw()},drawGeometry:function(d,c){var a=d.CLASS_NAME;if((a=="OpenLayers.Geometry.Collection")||(a=="OpenLayers.Geometry.MultiPoint")||(a=="OpenLayers.Geometry.MultiLineString")||(a=="OpenLayers.Geometry.MultiPolygon")){for(var b=0;b<d.components.length;b++){this.drawGeometry(d.components[b],c)}return}switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(d,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(d,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(d,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(d,c);break;default:break}},drawExternalGraphic:function(i,a){var e=new Image();e.src=a.externalGraphic;var c=a.graphicWidth||a.graphicHeight;var h=a.graphicHeight||a.graphicWidth;c=c?c:a.pointRadius*2;h=h?h:a.pointRadius*2;var g=(a.graphicXOffset!=undefined)?a.graphicXOffset:-(0.5*c);var f=(a.graphicYOffset!=undefined)?a.graphicYOffset:-(0.5*h);var d=a.graphicOpacity||a.fillOpacity;var b={img:e,x:(i[0]+g),y:(i[1]+f),width:c,height:h,canvas:this.canvas};e.onload=OpenLayers.Function.bind(function(){this.canvas.drawImage(this.img,this.x,this.y,this.width,this.height)},b)},setCanvasStyle:function(b,a){if(b=="fill"){this.canvas.globalAlpha=a.fillOpacity;this.canvas.fillStyle=a.fillColor}else{if(b=="stroke"){this.canvas.globalAlpha=a.strokeOpacity;this.canvas.strokeStyle=a.strokeColor;this.canvas.lineWidth=a.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},drawPoint:function(c,a){var b=this.getLocalXY(c);if(a.externalGraphic){this.drawExternalGraphic(b,a)}else{this.setCanvasStyle("fill",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],6,0,Math.PI*2,true);this.canvas.fill();this.setCanvasStyle("stroke",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],6,0,Math.PI*2,true);this.canvas.stroke();this.setCanvasStyle("reset")}},drawLineString:function(d,b){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var e=this.getLocalXY(d.components[0]);this.canvas.moveTo(e[0],e[1]);for(var a=1;a<d.components.length;a++){var c=this.getLocalXY(d.components[a]);this.canvas.lineTo(c[0],c[1])}this.canvas.stroke();this.setCanvasStyle("reset")},drawLinearRing:function(e,c){this.setCanvasStyle("fill",c);this.canvas.beginPath();var f=this.getLocalXY(e.components[0]);this.canvas.moveTo(f[0],f[1]);for(var b=1;b<e.components.length-1;b++){var d=this.getLocalXY(e.components[b]);this.canvas.lineTo(d[0],d[1])}this.canvas.fill();var a=this.canvas.lineWidth;this.setCanvasStyle("stroke",c);this.canvas.beginPath();var f=this.getLocalXY(e.components[0]);this.canvas.moveTo(f[0],f[1]);for(var b=1;b<e.components.length;b++){var d=this.getLocalXY(e.components[b]);this.canvas.lineTo(d[0],d[1])}this.canvas.stroke();this.setCanvasStyle("reset")},drawPolygon:function(c,b){this.drawLinearRing(c.components[0],b);for(var a=1;a<c.components.length;a++){this.drawLinearRing(c.components[a],{fillOpacity:0,strokeWidth:0,strokeOpacity:0,strokeColor:"#000000",fillColor:"#000000"})}},getLocalXY:function(b){var d=this.getResolution();var c=this.extent;var a=(b.x/d+(-c.left/d));var e=((c.top/d)-b.y/d);return[a,e]},clear:function(){this.canvas.clearRect(0,0,this.root.width,this.root.height)},getFeatureIdFromEvent:function(b){var f=this.map.getLonLatFromPixel(b.xy);var d=this.getResolution();var a=new OpenLayers.Bounds(f.lon-d*5,f.lat-d*5,f.lon+d*5,f.lat+d*5);var c=a.toGeometry();for(var e in this.features){if(!this.features.hasOwnProperty(e)){continue}if(this.features[e][0].geometry.intersects(c)){return e}}return null},eraseFeatures:function(a){if(!(a instanceof Array)){a=[a]}for(var b=0;b<a.length;++b){delete this.features[a[b].id]}this.redraw()},redraw:function(){if(!this.locked){this.clear();for(var a in this.features){if(!this.features.hasOwnProperty(a)){continue}if(!this.features[a][0].geometry){continue}this.drawGeometry(this.features[a][0].geometry,this.features[a][1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0},insert:function(e){if(this.exists(e)){this.remove(e)}var g=e.id;this.determineZIndex(e);var f=-1;var b=this.order.length;var d;while(b-f>1){d=parseInt((f+b)/2);var c=this.compare(this,e,OpenLayers.Util.getElement(this.order[d]));if(c>0){f=d}else{b=d}}this.order.splice(b,0,g);this.indices[g]=this.getZIndex(e);var a=b+1;return a<this.order.length?OpenLayers.Util.getElement(this.order[a]):null},remove:function(b){var d=b.id;var a=OpenLayers.Util.indexOf(this.order,d);if(a>=0){this.order.splice(a,1);delete this.indices[d];if(this.order.length>0){var c=this.order[this.order.length-1];this.maxZIndex=this.indices[c]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return(this.indices[a.id]!=null)},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else{if(b>this.maxZIndex){this.maxZIndex=b}}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,d,a){var f=e.getZIndex(d);var b=0;if(a){var c=e.getZIndex(a);b=f-c}return b},Z_ORDER_DRAWING_ORDER:function(d,c,a){var b=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,c,a);if(a&&b==0){b=1}return b},Z_ORDER_Y_ORDER:function(e,d,a){var b=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,a);if(a&&b==0){var f=d._geometry.getBounds().bottom;var c=a._geometry.getBounds().bottom;var g=c-f;b=(g==0)?1:g}return b}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",minimumSymbolizer:{strokeLinecap:"round",strokeOpacity:1,strokeDashstyle:"solid",fillOpacity:1,pointRadius:0},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot();this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){if(this.root){while(this.root.childNodes.length>0){this.root.removeChild(this.root.firstChild)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(b,a){},drawGeometry:function(h,d,g){var b=h.CLASS_NAME;var f=true;if((b=="OpenLayers.Geometry.Collection")||(b=="OpenLayers.Geometry.MultiPoint")||(b=="OpenLayers.Geometry.MultiLineString")||(b=="OpenLayers.Geometry.MultiPolygon")){for(var c=0,a=h.components.length;c<a;c++){f=this.drawGeometry(h.components[c],d,g)&&f}return f}f=false;if(d.display!="none"){if(d.backgroundGraphic){this.redrawBackgroundNode(h.id,h,d,g)}f=this.redrawNode(h.id,h,d,g)}if(f==false){var e=document.getElementById(h.id);if(e){if(e._style.backgroundGraphic){e.parentNode.removeChild(document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX))}e.parentNode.removeChild(e)}}return f},redrawNode:function(g,f,c,e){var d=this.nodeFactory(g,this.getNodeType(f,c));d._featureId=e;d._geometry=f;d._geometryClass=f.CLASS_NAME;d._style=c;var b=this.drawGeometryNode(d,f,c);if(b===false){return false}d=b.node;var a=this.indexer?this.indexer.insert(d):null;if(a){this.root.insertBefore(d,a)}else{this.root.appendChild(d)}this.postDraw(d);return b.complete},redrawBackgroundNode:function(e,d,b,c){var a=OpenLayers.Util.extend({},b);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,d,a,null)},drawGeometryNode:function(c,e,b){b=b||c._style;OpenLayers.Util.applyDefaults(b,this.minimumSymbolizer);var a={isFilled:true,isStroked:!!b.strokeWidth};var d;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":d=this.drawPoint(c,e);break;case"OpenLayers.Geometry.LineString":a.isFilled=false;d=this.drawLineString(c,e);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(c,e);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(c,e);break;case"OpenLayers.Geometry.Surface":d=this.drawSurface(c,e);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(c,e);break;default:break}c._style=b;c._options=a;if(d!=false){return{node:this.setStyle(c,b,a,e),complete:d}}else{return false}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},getFeatureIdFromEvent:function(a){var e=a.target;var b=e&&e.correspondingUseElement;var c=b?b:(e||a.srcElement);var d=c._featureId;return d},eraseGeometry:function(f){if((f.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(f.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(f.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(f.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var c=0,a=f.components.length;c<a;c++){this.eraseGeometry(f.components[c])}}else{var b=OpenLayers.Util.getElement(f.id);if(b&&b.parentNode){if(b.geometry){b.geometry.destroy();b.geometry=null}b.parentNode.removeChild(b);if(this.indexer){this.indexer.remove(b)}if(b._style.backgroundGraphic){var d=f.id+this.BACKGROUND_ID_SUFFIX;var e=OpenLayers.Util.getElement(d);if(e&&e.parentNode){e.parentNode.removeChild(e)}}}}},nodeFactory:function(c,a){var b=OpenLayers.Util.getElement(c);if(b){if(!this.nodeTypeCompare(b,a)){b.parentNode.removeChild(b);b=this.nodeFactory(c,a)}}else{b=this.createNode(a,c)}return b},nodeTypeCompare:function(b,a){},createNode:function(a,b){},isComplexSymbol:function(a){return(a!="circle")&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};(function(){var d=window.XMLHttpRequest;var h=!!window.controllers,e=window.document.all&&!window.opera;function c(){this._object=d?new d:new window.ActiveXObject("Microsoft.XMLHTTP")}if(h&&d.wrapped){c.wrapped=d.wrapped}c.UNSENT=0;c.OPENED=1;c.HEADERS_RECEIVED=2;c.LOADING=3;c.DONE=4;c.prototype.readyState=c.UNSENT;c.prototype.responseText="";c.prototype.responseXML=null;c.prototype.status=0;c.prototype.statusText="";c.prototype.onreadystatechange=null;c.onreadystatechange=null;c.onopen=null;c.onsend=null;c.onabort=null;c.prototype.open=function(l,o,m,p,n){this._async=m;var i=this,k=this.readyState;if(e){var j=function(){if(i._object.readyState!=c.DONE){f(i)}};if(m){window.attachEvent("onunload",j)}}this._object.onreadystatechange=function(){if(h&&!m){return}i.readyState=i._object.readyState;g(i);if(i._aborted){i.readyState=c.UNSENT;return}if(i.readyState==c.DONE){f(i);if(e&&m){window.detachEvent("onunload",j)}}if(k!=i.readyState){b(i)}k=i.readyState};if(c.onopen){c.onopen.apply(this,arguments)}this._object.open(l,o,m,p,n);if(!m&&h){this.readyState=c.OPENED;b(this)}};c.prototype.send=function(i){if(c.onsend){c.onsend.apply(this,arguments)}if(i&&i.nodeType){i=window.XMLSerializer?new window.XMLSerializer().serializeToString(i):i.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")}}this._object.send(i);if(h&&!this._async){this.readyState=c.OPENED;g(this);while(this.readyState<c.DONE){this.readyState++;b(this);if(this._aborted){return}}}};c.prototype.abort=function(){if(c.onabort){c.onabort.apply(this,arguments)}if(this.readyState>c.UNSENT){this._aborted=true}this._object.abort();f(this)};c.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};c.prototype.getResponseHeader=function(i){return this._object.getResponseHeader(i)};c.prototype.setRequestHeader=function(j,i){if(!this._headers){this._headers={}}this._headers[j]=i;return this._object.setRequestHeader(j,i)};c.prototype.toString=function(){return"[object XMLHttpRequest]"};c.toString=function(){return"[XMLHttpRequest]"};function b(i){if(i.onreadystatechange){i.onreadystatechange.apply(i)}if(c.onreadystatechange){c.onreadystatechange.apply(i)}}function a(i){var j=i.responseXML;if(e&&j&&!j.documentElement&&i.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){j=new ActiveXObject("Microsoft.XMLDOM");j.loadXML(i.responseText)}if(j){if((e&&j.parseError!=0)||(j.documentElement&&j.documentElement.tagName=="parsererror")){return null}}return j}function g(i){try{i.responseText=i._object.responseText}catch(j){}try{i.responseXML=a(i._object)}catch(j){}try{i.status=i._object.status}catch(j){}try{i.statusText=i._object.statusText}catch(j){}}function f(i){i._object.onreadystatechange=new window.Function;delete i._headers}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(i,j){if(!j){j=[]}i.__func=this;i.__func(j[0],j[1],j[2],j[3],j[4]);delete i.__func}}OpenLayers.Request.XMLHttpRequest=c})();OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,features:null,clusters:null,clustering:false,resolution:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},cacheFeatures:function(a){var b=true;if(!this.clustering){this.clearCache();this.features=a.features;this.cluster();b=false}return b},clearCache:function(){if(this.features){for(var a=0;a<this.features.length;++a){this.features[a].destroy()}}this.features=null},cluster:function(h){if((!h||h.zoomChanged)&&this.features){var e=this.layer.map.getResolution();if(e!=this.resolution||!this.clustersExist()){this.resolution=e;var g=[];var c,f,a;for(var d=0;d<this.features.length;++d){c=this.features[d];if(c.geometry){f=false;for(var b=0;b<g.length;++b){a=g[b];if(this.shouldCluster(a,c)){this.addToCluster(a,c);f=true;break}}if(!f){g.push(this.createCluster(this.features[d]))}}}this.layer.destroyFeatures();if(g.length>0){this.clustering=true;this.layer.addFeatures(g);this.clustering=false}this.clusters=g}}},clustersExist:function(){var b=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){b=true;for(var a=0;a<this.clusters.length;++a){if(this.clusters[a]!=this.layer.features[a]){b=false;break}}}return b},shouldCluster:function(a,b){var e=a.geometry.getBounds().getCenterLonLat();var c=b.geometry.getBounds().getCenterLonLat();var d=(Math.sqrt(Math.pow((e.lon-c.lon),2)+Math.pow((e.lat-c.lat),2))/this.resolution);return(d<=this.distance)},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(b){var c=b.geometry.getBounds().getCenterLonLat();var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),{count:1});a.cluster=[b];return a},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.protocol.read({callback:this.merge,scope:this});return true}return false},merge:function(b){var a=b.features;if(a&&a.length>0){this.layer.addFeatures(a)}},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},cacheFeatures:function(a){if(!this.paging){this.clearCache();this.features=a.features;this.pageNext(a)}},clearCache:function(){if(this.features){for(var a=0;a<this.features.length;++a){this.features[a].destroy()}}this.features=null;this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){if(a&&a>0){this.length=a}return this.length},pageNext:function(a){var b=false;if(this.features){if(this.num===null){this.num=-1}var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=false;if(this.features){if(this.num===null){this.num=this.pageCount()}var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(e,c){var d=false;if(this.features){if(e>=0&&e<this.features.length){var b=Math.floor(e/this.length);if(b!=this.num){this.paging=true;var a=this.features.slice(e,e+this.length);this.layer.removeFeatures(this.layer.features);this.num=b;if(c&&c.features){c.features=a}else{this.layer.addFeatures(a)}this.paging=false;d=true}}}return d},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(e,a,b,c,d){this.layer=e;this.position=a.clone();this.bounds=b.clone();this.url=c;this.size=d.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(a,this);return a},draw:function(){var b=this.layer.maxExtent;var a=(b&&this.bounds.intersectsBounds(b,false));this.shouldDraw=(a||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw},moveTo:function(b,a,c){if(c==null){c=true}this.bounds=b.clone();this.position=a.clone();if(c){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(a){var f=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(f);var c=this.layer.map.getLonLatFromLayerPx(a);var e=a.clone();e.x+=this.size.w;e.y+=this.size.h;var d=this.layer.map.getLonLatFromLayerPx(e);if(c.lon>d.lon){if(c.lon<0){c.lon=-180-(c.lon+180)}else{d.lon=180+d.lon+180}}var b=new OpenLayers.Bounds(c.lon,d.lat,d.lon,c.lat);return b},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}))};OpenLayers.loadURL=function(d,f,b,g,c){if(typeof f=="string"){f=OpenLayers.Util.getParameters(f)}var e=(g)?g:OpenLayers.nullHandler;var a=(c)?c:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:d,params:f,success:e,failure:a,scope:b})};OpenLayers.parseXMLString=function(c){var b=c.indexOf("<");if(b>0){c=c.substring(b)}var a=OpenLayers.Util.Try(function(){var d=new ActiveXObject("Microsoft.XMLDOM");d.loadXML(c);return d},function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var d=new XMLHttpRequest();d.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send(null);return d.responseXML});return a};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return}}this.responders.push(b)},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a)},dispatch:function(f,c,g){var b;for(var a=0;a<this.responders.length;a++){b=this.responders[a];if(b[f]&&typeof b[f]=="function"){try{b[f].apply(b,[c,g])}catch(d){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(a,b){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[b]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(a,"http")){a=OpenLayers.ProxyHost+encodeURIComponent(a)}this.transport=OpenLayers.Ajax.getTransport();this.request(a)},request:function(a){this.url=a;this.method=this.options.method;var d=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){d._method=this.method;this.method="post"}this.parameters=d;if(d=OpenLayers.Util.getParameterString(d)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+d}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){d+="&_="}}}try{var b=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(b)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(typeof b.push=="function"){for(var d=0,a=b.length;d<a;d+=2){e[b[d]]=b[d+1]}}else{for(var d in b){e[d]=b[d]}}}for(var c in e){this.transport.setRequestHeader(c,e[c])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=OpenLayers.Ajax.Request.Events[a];var b=new OpenLayers.Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(b)}catch(f){this.dispatchException(f)}var d=b.getHeader("Content-type")}try{(this.options["on"+c]||OpenLayers.Ajax.emptyFunction)(b);OpenLayers.Ajax.Responders.dispatch("on"+c,this,b)}catch(f){this.dispatchException(f)}if(c=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},dispatchException:function(c){var d=this.options.onException;if(d){d(this,c);OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{var e=false;var b=OpenLayers.Ajax.Responders.responders;for(var a=0;a<b.length;a++){if(b[a].onException){e=true;break}}if(e){OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{throw c}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!(!!(window.attachEvent&&!window.opera)))||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=d.responseText==null?"":String(d.responseText)}if(a==4){var b=d.responseXML;this.responseXML=b===undefined?null:b}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a)}});OpenLayers.Ajax.getElementsByTagNameNS=function(c,b,d,a){var e=null;if(c.getElementsByTagNameNS){e=c.getElementsByTagNameNS(b,a)}else{e=c.getElementsByTagName(d+":"+a)}return e};OpenLayers.Ajax.serializeXMLToString=function(b){var a=new XMLSerializer();var c=a.serializeToString(b);return c};OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y);if(a){this.position=a}if(b){this.direction=b}this.measureDivs=[]},destroy:function(){for(var b in this.buttons){var a=this.buttons[b];a.map=null;a.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var b=new OpenLayers.Size(28,28);var a=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",a,b,"Shift->Drag to zoom to area");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this._addButton("pan","panning-hand-off.png","panning-hand-on.png",a,b,"Drag the map to pan.");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this.switchModeTo("pan");return this.div},_addButton:function(a,d,c,i,g,h){var f=OpenLayers.Util.getImagesLocation()+d;var e=OpenLayers.Util.getImagesLocation()+c;var b=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+a,i,g,f,"absolute");this.div.appendChild(b);b.imgLocation=f;b.activeImgLocation=e;b.events=new OpenLayers.Events(this,b,null,true);b.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this});b.action=a;b.title=h;b.alt=h;b.map=this.map;this.buttons[a]=b;return b},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.buttonClicked=a.element.action;OpenLayers.Event.stop(a)},buttonUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.buttonClicked!=null){if(this.buttonClicked==a.element.action){this.switchModeTo(a.element.action)}OpenLayers.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(a){this.switchModeTo("pan");this.performedDrag=false;var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1);OpenLayers.Event.stop(a);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;this.startViaKeyboard=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else{if(a.altKey&&this.mode!="measure"){this.switchModeTo("measure")}else{if(!this.mode){this.switchModeTo("pan")}}}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case"measure":var c="";if(this.measureStart){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);c=OpenLayers.Util.distVincenty(this.measureStart,b);c=Math.round(c*100)/100;c=c+"km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);if(c){this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=c;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},switchModeTo:function(c){if(c!=this.mode){if(this.mode&&this.buttons[this.mode]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation)}if(this.mode=="measure"&&c!="measure"){for(var b=0,a=this.measureDivs.length;b<a;b++){if(this.measureDivs[b]){this.map.layerContainerDiv.removeChild(this.measureDivs[b])}}this.measureDivs=[];this.measureStart=null}this.mode=c;if(this.buttons[c]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[c],null,null,null,this.buttons[c].activeImgLocation)}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(b){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var e=Math.abs(this.mouseDragStart.x-b.xy.x);var f=Math.abs(this.mouseDragStart.y-b.xy.y);this.zoomBox.style.width=Math.max(1,e)+"px";this.zoomBox.style.height=Math.max(1,f)+"px";if(b.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=b.xy.x+"px"}if(b.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=b.xy.y+"px"}break;default:var e=this.mouseDragStart.x-b.xy.x;var f=this.mouseDragStart.y-b.xy.y;var c=this.map.getSize();var a=new OpenLayers.Pixel(c.w/2+e,c.h/2+f);var d=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(d,null,true);this.mouseDragStart=b.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.mode){case"zoombox":this.zoomBoxEnd(a);if(this.startViaKeyboard){this.leaveMode()}break;case"pan":if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="default"},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();if(this.startViaKeyboard){this.leaveMode()}}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(a){if(this.performedDrag){this.performedDrag=false;return false}},CLASS_NAME:"OpenLayers.Control.MouseToolbar"});OpenLayers.Control.MouseToolbar.X=6;OpenLayers.Control.MouseToolbar.Y=300;OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoomBarDiv:null,divEvents:null,zoomWorldIcon:false,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this.div.removeChild(this.slider);this.slider=null;this.sliderEvents.destroy();this.sliderEvents=null;this.div.removeChild(this.zoombarDiv);this.zoomBarDiv=null;this.divEvents.destroy();this.divEvents=null;this.map.events.un({zoomend:this.moveZoomBar,changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.div.innerHTML=""}this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var d=new OpenLayers.Size(18,18);var b=new OpenLayers.Pixel(a.x+d.w/2,a.y);var c=d.w;if(this.zoomWorldIcon){b=new OpenLayers.Pixel(a.x+d.w,a.y)}this._addButton("panup","north-mini.png",b,d);a.y=b.y+d.h;this._addButton("panleft","west-mini.png",a,d);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",a.add(d.w,0),d);c*=2}this._addButton("panright","east-mini.png",a.add(c,0),d);this._addButton("pandown","south-mini.png",b.add(0,d.h*2),d);this._addButton("zoomin","zoom-plus-mini.png",b.add(0,d.h*3+5),d);b=this._addZoomBar(b.add(0,d.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",b,d);return this.div},_addZoomBar:function(c){var e=OpenLayers.Util.getImagesLocation();var g=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var a=OpenLayers.Util.createAlphaImageDiv(g,c.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),e+"slider.png","absolute");this.slider=a;this.sliderEvents=new OpenLayers.Events(this,a,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var d=new OpenLayers.Size();d.h=this.zoomStopHeight*this.map.getNumZoomLevels();d.w=this.zoomStopWidth;var f=null;if(OpenLayers.Util.alphaHack()){var g=this.id+"_"+this.map.id;f=OpenLayers.Util.createAlphaImageDiv(g,c,new OpenLayers.Size(d.w,this.zoomStopHeight),e+"zoombar.png","absolute",null,"crop");f.style.height=d.h+"px"}else{f=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,c,d,e+"zoombar.png")}this.zoombarDiv=f;this.divEvents=new OpenLayers.Events(this,f,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(f);this.startTop=parseInt(f.style.top);this.div.appendChild(a);this.map.events.register("zoomend",this,this.moveZoomBar);c=c.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return c},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}var e=b.xy.y;var d=OpenLayers.Util.pagePosition(b.object)[1];var a=(e-d)/this.zoomStopHeight;if(!this.map.fractionalZoom){a=Math.floor(a)}var c=(this.map.getNumZoomLevels()-1)-a;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(c);OpenLayers.Event.stop(b)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var d=this.mouseDragStart.y-b.xy.y;var a=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-a[1])>0&&(b.clientY-a[1])<parseInt(this.zoombarDiv.style.height)-2){var c=parseInt(this.slider.style.top)-d;this.slider.style.top=c+"px";this.mouseDragStart=b.xy.clone()}OpenLayers.Event.stop(b)}},zoomBarUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.zoomStart.y-a.xy.y;var c=this.map.zoom;if(this.map.fractionalZoom){c+=b/this.zoomStopHeight;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)}else{c+=Math.round(b/this.zoomStopHeight)}this.map.zoomTo(c);this.moveZoomBar();this.mouseDragStart=null;OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,base:"",displayProjection:null,initialize:function(a,c,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a);this.base=c||document.location.href},destroy:function(){if(this.element.parentNode==this.div){this.div.removeChild(this.element)}this.element=null;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,a=this.map.controls.length;b<a;b++){var c=this.map.controls[b];if(c.CLASS_NAME==this.argParserClass.CLASS_NAME){if(c.displayProjection!=this.displayProjection){this.displayProjection=c.displayProjection}break}}if(b==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.className=this.displayClass;this.element=document.createElement("a");this.element.innerHTML=OpenLayers.i18n("permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.base;if(a.indexOf("?")!=-1){a=a.substring(0,a.indexOf("?"))}a+="?"+OpenLayers.Util.getParameterString(this.createParams());this.element.href=a},createParams:function(h,k,c){h=h||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(h){d.zoom=k||this.map.getZoom();var j=h.lat;var b=h.lon;if(this.displayProjection){var a=OpenLayers.Projection.transform({x:b,y:j},this.map.getProjectionObject(),this.displayProjection);b=a.x;j=a.y}d.lat=Math.round(j*100000)/100000;d.lon=Math.round(b*100000)/100000;c=c||this.map.layers;d.layers="";for(var e=0,g=c.length;e<g;e++){var f=c[e];if(f.isBaseLayer){d.layers+=(f==this.map.baseLayer)?"B":"0"}else{d.layers+=(f.getVisibility())?"T":"F"}}}return d},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn(),new OpenLayers.Control.ZoomToMaxExtent(),new OpenLayers.Control.ZoomOut()])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}return object}}catch(e){}return null},write:function(d,a){this.pretty=!!a;var b=null;var c=typeof d;if(this.serialize[c]){b=this.serialize[c].apply(this,[d])}return b},writeIndent:function(){var a=[];if(this.pretty){for(var b=0;b<this.level;++b){a.push(this.indent)}}return a.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{object:function(e){if(e==null){return"null"}if(e.constructor==Date){return this.serialize.date.apply(this,[e])}if(e.constructor==Array){return this.serialize.array.apply(this,[e])}var b=["{"];this.level+=1;var d,c,a;var f=false;for(d in e){if(e.hasOwnProperty(d)){c=OpenLayers.Format.JSON.prototype.write.apply(this,[d,this.pretty]);a=OpenLayers.Format.JSON.prototype.write.apply(this,[e[d],this.pretty]);if(c!=null&&a!=null){if(f){b.push(",")}b.push(this.writeNewline(),this.writeIndent(),c,":",this.writeSpace(),a);f=true}}}this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"}");return b.join("")},array:function(e){var d;var b=["["];this.level+=1;for(var c=0,a=e.length;c<a;++c){d=OpenLayers.Format.JSON.prototype.write.apply(this,[e[c],this.pretty]);if(d!=null){if(c>0){b.push(",")}b.push(this.writeNewline(),this.writeIndent(),d)}}this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"]");return b.join("")},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(e,d){var f=a[d];if(f){return f}f=d.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"'}return'"'+b+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(c){return(c<10)?"0"+c:c}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(b){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[b]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var a in this.namespaces){this.namespaceAlias[this.namespaces[a]]=a}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var d;if(window.ActiveXObject&&!this.xmldom){d=new ActiveXObject("Microsoft.XMLDOM")}else{d=this.xmldom}d.loadXML(c);return d}),this),function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var d=new XMLHttpRequest();d.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send(null);return d.responseXML});return b},write:function(b){var c;if(this.xmldom){c=b.xml}else{var a=new XMLSerializer();if(b.nodeType==1){var d=document.implementation.createDocument("","",null);if(d.importNode){b=d.importNode(b,true)}d.appendChild(b);c=a.serializeToString(d)}else{c=a.serializeToString(b)}}return c},createElementNS:function(c,b){var a;if(this.xmldom){if(typeof c=="string"){a=this.xmldom.createNode(1,b,c)}else{a=this.xmldom.createNode(1,b,"")}}else{a=document.createElementNS(c,b)}return a},createTextNode:function(b){var a;if(this.xmldom){a=this.xmldom.createTextNode(b)}else{a=document.createTextNode(b)}return a},getElementsByTagNameNS:function(e,d,b){var j=[];if(e.getElementsByTagNameNS){j=e.getElementsByTagNameNS(d,b)}else{var c=e.getElementsByTagName("*");var a,f;for(var g=0,h=c.length;g<h;++g){a=c[g];f=(a.prefix)?(a.prefix+":"+b):b;if((b=="*")||(f==a.nodeName)){if((d=="*")||(d==a.namespaceURI)){j.push(a)}}}}return j},getAttributeNodeNS:function(d,c,b){var j=null;if(d.getAttributeNodeNS){j=d.getAttributeNodeNS(c,b)}else{var f=d.attributes;var a,e;for(var g=0,h=f.length;g<h;++g){a=f[g];if(a.namespaceURI==c){e=(a.prefix)?(a.prefix+":"+b):b;if(e==a.nodeName){j=a;break}}}}return j},getAttributeNS:function(e,d,c){var b="";if(e.getAttributeNS){b=e.getAttributeNS(d,c)||""}else{var a=this.getAttributeNodeNS(e,d,c);if(a){b=a.nodeValue}}return b},getChildValue:function(a,c){var b=c||"";if(a){var d=a.firstChild;if(d){b=d.nodeValue||b}}return b},concatChildValues:function(b,d){var c="";var e=b.firstChild;var a;while(e){a=e.nodeValue;if(a){c+=a}e=e.nextSibling}if(c==""&&d!=undefined){c=d}return c},hasAttributeNS:function(c,b,a){var d=false;if(c.hasAttributeNS){d=c.hasAttributeNS(b,a)}else{d=!!this.getAttributeNodeNS(c,b,a)}return d},setAttributeNS:function(d,c,a,e){if(d.setAttributeNS){d.setAttributeNS(c,a,e)}else{if(this.xmldom){if(c){var b=d.ownerDocument.createNode(2,a,c);b.nodeValue=e;d.setAttributeNode(b)}else{d.setAttribute(a,e)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(a,b){b=b||{};var e=a.indexOf(":");var d=b.uri||this.namespaces[b.prefix];if(!d){e=a.indexOf(":");d=this.namespaces[a.substring(0,e)]}if(!d){d=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(d,a);if(b.attributes){this.setAttributes(c,b.attributes)}if(b.value!=null){c.appendChild(this.createTextNode(b.value))}return c},setAttributes:function(d,f){var e,g,b,c;for(var a in f){if(f[a]!=null&&f[a].toString){e=f[a].toString();c=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(d,c,a,e)}}},readNode:function(b,e){if(!e){e={}}var d=this.readers[this.namespaceAlias[b.namespaceURI]];if(d){var a=b.localName||b.nodeName.split(":").pop();var c=d[a]||d["*"];if(c){c.apply(this,[b,e])}}return e},readChildNodes:function(d,e){if(!e){e={}}var c=d.childNodes;var f;for(var b=0,a=c.length;b<a;++b){f=c[b];if(f.nodeType==1){this.readNode(f,e)}}return e},writeNode:function(c,f,b){var a,e;var d=c.indexOf(":");if(d>0){a=c.substring(0,d);e=c.substring(d+1)}else{if(b){a=this.namespaceAlias[b.namespaceURI]}else{a=this.defaultPrefix}e=c}var g=this.writers[a][e].apply(this,[f]);if(b){b.appendChild(g)}return g},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(c,a,b){OpenLayers.Util.extend(this,b);this.control=c;this.callbacks=a;if(c.map){this.setMap(c.map)}OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null){return true}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask)},activate:function(){if(this.active){return false}var b=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var c=0,a=b.length;c<a;c++){if(this[b[c]]){this.register(b[c],this[b[c]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var b=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var c=0,a=b.length;c<a;c++){if(this[b[c]]){this.unregister(b[c],this[b[c]])}}this.active=false;return true},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a)}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,paddingForPopups:null,initialize:function(h,e){this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,e);this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);OpenLayers.Element.addClass(this.div,"olMap");var g=this.div.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);g=this.div.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(g);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var f=true;var c=document.getElementsByTagName("link");for(var d=0,a=c.length;d<a;++d){if(OpenLayers.Util.isEquivalentUrl(c.item(d).href,this.theme)){f=false;break}}if(f){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b)}}this.layers=[];if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var d=0,a=this.controls.length;d<a;d++){this.addControlToMap(this.controls[d])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy)},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy()}this.controls=null}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(a){OpenLayers.Util.extend(this,a)},getTileSize:function(){return this.tileSize},getBy:function(e,a,b){var d=(typeof b.test=="function");var c=OpenLayers.Array.filter(this[e],function(f){return f[a]==b||(d&&b.test(f[a]))});return c},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(e){var d=null;for(var c=0,a=this.layers.length;c<a;c++){var b=this.layers[c];if(b.id==e){d=b;break}}return d},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5)},resetLayersZIndex:function(){for(var c=0,a=this.layers.length;c<a;c++){var b=this.layers[c];this.setLayerZIndex(b,c)}},addLayer:function(c){for(var b=0,a=this.layers.length;b<a;b++){if(this.layers[b]==c){var d=OpenLayers.i18n("layerAlreadyAdded",{layerName:c.name});OpenLayers.Console.warn(d);return false}}this.events.triggerEvent("preaddlayer",{layer:c});c.div.className="olLayerDiv";c.div.style.overflow="";this.setLayerZIndex(c,this.layers.length);if(c.isFixed){this.viewPortDiv.appendChild(c.div)}else{this.layerContainerDiv.appendChild(c.div)}this.layers.push(c);c.setMap(this);if(c.isBaseLayer){if(this.baseLayer==null){this.setBaseLayer(c)}else{c.setVisibility(false)}}else{c.redraw()}this.events.triggerEvent("addlayer",{layer:c})},addLayers:function(c){for(var b=0,a=c.length;b<a;b++){this.addLayer(c[b])}},removeLayer:function(d,e){if(e==null){e=true}if(d.isFixed){this.viewPortDiv.removeChild(d.div)}else{this.layerContainerDiv.removeChild(d.div)}OpenLayers.Util.removeItem(this.layers,d);d.removeMap(this);d.map=null;if(this.baseLayer==d){this.baseLayer=null;if(e){for(var c=0,a=this.layers.length;c<a;c++){var b=this.layers[c];if(b.isBaseLayer){this.setBaseLayer(b);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:d})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(d,b){var e=this.getLayerIndex(d);if(b<0){b=0}else{if(b>this.layers.length){b=this.layers.length}}if(e!=b){this.layers.splice(e,1);this.layers.splice(b,0,d);for(var c=0,a=this.layers.length;c<a;c++){this.setLayerZIndex(this.layers[c],c)}this.events.triggerEvent("changelayer",{layer:d,property:"order"})}},raiseLayer:function(b,c){var a=this.getLayerIndex(b)+c;this.setLayerIndex(b,a)},setBaseLayer:function(a){var c=null;if(this.baseLayer){c=this.baseLayer.getExtent()}if(a!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,a)!=-1){if(this.baseLayer!=null){this.baseLayer.setVisibility(false)}this.baseLayer=a;this.viewRequestID++;this.baseLayer.visibility=true;var e=this.getCenter();if(e!=null){var d=(c)?c.getCenterLonLat():e;var b=(c)?this.getZoomForExtent(c,true):this.getZoomForResolution(this.resolution,true);this.setCenter(d,b,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a)},addControlToMap:function(b,a){b.outsideViewport=(b.div!=null);if(this.displayProjection&&!b.displayProjection){b.displayProjection=this.displayProjection}b.setMap(this);var c=b.draw(a);if(c){if(!b.outsideViewport){c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(c)}}},getControl:function(e){var c=null;for(var b=0,a=this.controls.length;b<a;b++){var d=this.controls[b];if(d.id==e){c=d;break}}return c},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},addPopup:function(a,d){if(d){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b])}}a.map=this;this.popups.push(a);var c=a.draw();if(c){c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(c)}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div)}catch(b){}}a.map=null},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone()}return a},updateSize:function(){this.events.clearMouseCache();var c=this.getCurrentSize();var b=this.getSize();if(b==null){this.size=b=c}if(!c.equals(b)){this.size=c;for(var d=0,a=this.layers.length;d<a;d++){this.layers[d].onMapResize()}if(this.baseLayer!=null){var f=new OpenLayers.Pixel(c.w/2,c.h/2);var g=this.getLonLatFromViewPortPx(f);var e=this.getZoom();this.zoom=null;this.setCenter(this.getCenter(),e)}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){var b=OpenLayers.Element.getDimensions(this.div);a.w=b.width;a.h=b.height}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)}return a},calculateBounds:function(f,d){var a=null;if(f==null){f=this.getCenter()}if(d==null){d=this.getResolution()}if((f!=null)&&(d!=null)){var c=this.getSize();var e=c.w*d;var b=c.h*d;a=new OpenLayers.Bounds(f.lon-e/2,f.lat-b/2,f.lon+e/2,f.lat+b/2)}return a},getCenter:function(){var a=null;if(this.center){a=this.center.clone()}return a},getZoom:function(){return this.zoom},pan:function(d,c,e){e=OpenLayers.Util.applyDefaults(e,{animate:true,dragging:false});var b=this.getViewPortPxFromLonLat(this.getCenter());var a=b.add(d,c);if(!e.dragging||!a.equals(b)){var f=this.getLonLatFromViewPortPx(a);if(e.animate){this.panTo(f)}else{this.setCenter(f,null,e.dragging)}}},panTo:function(a){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(a)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var b=this.getCenter();if(a.lon==b.lon&&a.lat==b.lat){return}var d={lon:b.lon,lat:b.lat};var c={lon:a.lon,lat:a.lat};this.panTween.start(d,c,50,{callbacks:{start:OpenLayers.Function.bind(function(e){this.events.triggerEvent("movestart")},this),eachStep:OpenLayers.Function.bind(function(e){e=new OpenLayers.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{dragging:true,noEvent:true})},this),done:OpenLayers.Function.bind(function(e){e=new OpenLayers.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{noEvent:true});this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(a)}},setCenter:function(b,c,a,d){this.moveTo(b,c,{dragging:a,forceZoomChange:d,caller:"setCenter"})},moveTo:function(a,q,m){if(!m){m={}}var p=m.dragging;var h=m.forceZoomChange;var e=m.noEvent;if(this.panTween&&m.caller=="setCenter"){this.panTween.stop()}if(!this.center&&!this.isValidLonLat(a)){a=this.maxExtent.getCenterLonLat()}if(this.restrictedExtent!=null){if(a==null){a=this.getCenter()}if(q==null){q=this.getZoom()}var d=this.getResolutionForZoom(q);var n=this.calculateBounds(a,d);if(!this.restrictedExtent.containsBounds(n)){var l=this.restrictedExtent.getCenterLonLat();if(n.getWidth()>this.restrictedExtent.getWidth()){a=new OpenLayers.LonLat(l.lon,a.lat)}else{if(n.left<this.restrictedExtent.left){a=a.add(this.restrictedExtent.left-n.left,0)}else{if(n.right>this.restrictedExtent.right){a=a.add(this.restrictedExtent.right-n.right,0)}}}if(n.getHeight()>this.restrictedExtent.getHeight()){a=new OpenLayers.LonLat(a.lon,l.lat)}else{if(n.bottom<this.restrictedExtent.bottom){a=a.add(0,this.restrictedExtent.bottom-n.bottom)}else{if(n.top>this.restrictedExtent.top){a=a.add(0,this.restrictedExtent.top-n.top)}}}}}var k=h||((this.isValidZoomLevel(q))&&(q!=this.getZoom()));var b=(this.isValidLonLat(a))&&(!a.equals(this.center));if(k||b||!p){if(!this.dragging&&!e){this.events.triggerEvent("movestart")}if(b){if((!k)&&(this.center)){this.centerLayerContainer(a)}this.center=a.clone()}if((k)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(k){this.zoom=q;this.resolution=this.getResolutionForZoom(q);this.viewRequestID++}var j=this.getExtent();this.baseLayer.moveTo(j,k,p);if(p){this.baseLayer.events.triggerEvent("move")}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:k})}j=this.baseLayer.getExtent();for(var c=0,g=this.layers.length;c<g;c++){var f=this.layers[c];if(!f.isBaseLayer){var o=f.calculateInRange();if(f.inRange!=o){f.inRange=o;if(!o){f.display(false)}this.events.triggerEvent("changelayer",{layer:f,property:"visibility"})}if(o&&f.visibility){f.moveTo(j,k,p);if(p){f.events.triggerEvent("move")}else{f.events.triggerEvent("moveend",{zoomChanged:k})}}}}if(k){for(var c=0,g=this.popups.length;c<g;c++){this.popups[c].updatePosition()}}this.events.triggerEvent("move");if(k){this.events.triggerEvent("zoomend")}}if(!p&&!e){this.events.triggerEvent("moveend")}this.dragging=!!p},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var c=this.getViewPortPxFromLonLat(a);if((b!=null)&&(c!=null)){this.layerContainerDiv.style.left=Math.round(b.x-c.x)+"px";this.layerContainerDiv.style.top=Math.round(b.y-c.y)+"px"}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()))},isValidLonLat:function(a){var b=false;if(a!=null){var c=this.getMaxExtent();b=c.containsLonLat(a)}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection}return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution}return a},getMaxExtent:function(a){var b=null;if(a&&a.restricted&&this.restrictedExtent){b=this.restrictedExtent}else{if(this.baseLayer!=null){b=this.baseLayer.maxExtent}}return b},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}return a},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent()}return a},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution()}return a},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units}return a},getScale:function(){var c=null;if(this.baseLayer!=null){var b=this.getResolution();var a=this.baseLayer.units;c=OpenLayers.Util.getScaleFromResolution(b,a)}return c},getZoomForExtent:function(a,c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForExtent(a,c)}return b},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b)}return a},getZoomForResolution:function(a,c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForResolution(a,c)}return b},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){var d=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){var c=this.getMaxExtent();a=a.clone();while(a.right<a.left){a.right+=c.getWidth()}d=a.getCenterLonLat().wrapDateLine(c)}this.setCenter(d,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=(a)?a.restricted:true;var c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(h,f){var d=OpenLayers.Util.getResolutionFromScale(h,this.baseLayer.units);var c=this.getSize();var e=c.w*d;var b=c.h*d;var g=this.getCenter();var a=new OpenLayers.Bounds(g.lon-e/2,g.lat-b/2,g.lon+e/2,g.lat+b/2);this.zoomToExtent(a,f)},getLonLatFromViewPortPx:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getLonLatFromViewPortPx(b)}return a},getViewPortPxFromLonLat:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getViewPortPxFromLonLat(a)}return b},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getViewPortPxFromLayerPx:function(c){var d=null;if(c!=null){var b=parseInt(this.layerContainerDiv.style.left);var a=parseInt(this.layerContainerDiv.style.top);d=c.add(b,a)}return d},getLayerPxFromViewPortPx:function(d){var c=null;if(d!=null){var b=-parseInt(this.layerContainerDiv.style.left);var a=-parseInt(this.layerContainerDiv.style.top);c=d.add(b,a);if(isNaN(c.x)||isNaN(c.y)){c=null}}return c},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,c){this.lonlat=a;var b=(c)?c:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=b}else{this.icon.url=b.url;this.icon.size=b.size;this.icon.offset=b.offset;this.icon.calculateOffset=b.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a)}this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a)}},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var b=OpenLayers.Util.getImagesLocation()+"marker.png";var c=new OpenLayers.Size(21,25);var a=function(d){return new OpenLayers.Pixel(-(d.w/2),-d.h)};return new OpenLayers.Icon(b,c,null,a)};OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(g,a,f,b,c,e,d){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)}}},setBorder:function(a){this.border=0},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity()}},getCornersToRound:function(){var b=["tl","tr","bl","br"];var a=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(b,a);return b.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(g,a,f,b,c,e,d){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(h){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(e){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];if(b.image){b.div.removeChild(b.image)}b.image=null;if(b.div){this.groupDiv.removeChild(b.div)}b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);b=b.offset(this.positionBlocks[this.relativePosition].offset);return b},createBlocks:function(){this.blocks=[];var b=null;for(var f in this.positionBlocks){b=f;break}var a=this.positionBlocks[b];for(var e=0;e<a.blocks.length;e++){var h={};this.blocks.push(h);var c=this.id+"_FrameDecorationDiv_"+e;h.div=OpenLayers.Util.createDiv(c,null,null,null,"absolute",null,"hidden",null);var d=this.id+"_FrameDecorationImg_"+e;var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;h.image=g(d,null,this.imageSize,this.imageSrc,"absolute",null,null,null);h.div.appendChild(h.image);this.groupDiv.appendChild(h.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var j=this.positionBlocks[this.relativePosition];for(var f=0;f<j.blocks.length;f++){var d=j.blocks[f];var e=this.blocks[f];var c=d.anchor.left;var k=d.anchor.bottom;var a=d.anchor.right;var n=d.anchor.top;var m=(isNaN(d.size.w))?this.size.w-(a+c):d.size.w;var g=(isNaN(d.size.h))?this.size.h-(k+n):d.size.h;e.div.style.width=m+"px";e.div.style.height=g+"px";e.div.style.left=(c!=null)?c+"px":"";e.div.style.bottom=(k!=null)?k+"px":"";e.div.style.right=(a!=null)?a+"px":"";e.div.style.top=(n!=null)?n+"px":"";e.image.style.left=d.position.x+"px";e.image.style.top=d.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolSize:{},initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0}},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},inValidRange:function(a,e,b){var d=a+(b?0:this.translationParameters.x);var c=e+(b?0:this.translationParameters.y);return(d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&c>=-this.MAX_PIXEL&&c<=this.MAX_PIXEL)},setExtent:function(a,d){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var b=this.getResolution();var f=-a.left/b;var e=a.top/b;if(d){this.left=f;this.top=e;var c="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",c);this.translate(0,0);return true}else{var g=this.translate(f-this.left,e-this.top);if(!g){this.setExtent(a,true)}return g}},translate:function(a,c){if(!this.inValidRange(a,c,true)){return false}else{var b="";if(a||c){b="translate("+a+","+c+")"}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:c};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a="use"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break}return a},setStyle:function(g,c,l){c=c||g._style;l=l||g._options;var a=parseFloat(g.getAttributeNS(null,"r"));var k=1;var m;if(g._geometryClass=="OpenLayers.Geometry.Point"&&a){if(c.externalGraphic){m=this.getPosition(g);if(c.graphicWidth&&c.graphicHeight){g.setAttributeNS(null,"preserveAspectRatio","none")}var e=c.graphicWidth||c.graphicHeight;var o=c.graphicHeight||c.graphicWidth;e=e?e:c.pointRadius*2;o=o?o:c.pointRadius*2;var j=(c.graphicXOffset!=undefined)?c.graphicXOffset:-(0.5*e);var i=(c.graphicYOffset!=undefined)?c.graphicYOffset:-(0.5*o);var f=c.graphicOpacity||c.fillOpacity;g.setAttributeNS(null,"x",(m.x+j).toFixed());g.setAttributeNS(null,"y",(m.y+i).toFixed());g.setAttributeNS(null,"width",e);g.setAttributeNS(null,"height",o);g.setAttributeNS(this.xlinkns,"href",c.externalGraphic);g.setAttributeNS(null,"style","opacity: "+f)}else{if(this.isComplexSymbol(c.graphicName)){var h=c.pointRadius*3;var p=h*2;var d=this.importSymbol(c.graphicName);var b="#"+d;m=this.getPosition(g);k=this.symbolSize[d]/p;if(g.getAttributeNS(this.xlinkns,"href")!=b){g.setAttributeNS(this.xlinkns,"href",b)}else{if(p!=parseFloat(g.getAttributeNS(null,"width"))){g.style.visibility="hidden";this.container.scrollLeft=this.container.scrollLeft}}g.setAttributeNS(null,"width",p);g.setAttributeNS(null,"height",p);g.setAttributeNS(null,"x",m.x-h);g.setAttributeNS(null,"y",m.y-h);g.style.visibility=""}else{g.setAttributeNS(null,"r",c.pointRadius)}}if(typeof c.rotation!="undefined"&&m){var n=OpenLayers.String.format("rotate(${0} ${1} ${2})",[c.rotation,m.x,m.y]);g.setAttributeNS(null,"transform",n)}}if(l.isFilled){g.setAttributeNS(null,"fill",c.fillColor);g.setAttributeNS(null,"fill-opacity",c.fillOpacity)}else{g.setAttributeNS(null,"fill","none")}if(l.isStroked){g.setAttributeNS(null,"stroke",c.strokeColor);g.setAttributeNS(null,"stroke-opacity",c.strokeOpacity);g.setAttributeNS(null,"stroke-width",c.strokeWidth*k);g.setAttributeNS(null,"stroke-linecap",c.strokeLinecap);g.setAttributeNS(null,"stroke-linejoin","round");g.setAttributeNS(null,"stroke-dasharray",this.dashStyle(c,k))}else{g.setAttributeNS(null,"stroke","none")}if(c.pointerEvents){g.setAttributeNS(null,"pointer-events",c.pointerEvents)}if(c.cursor!=null){g.setAttributeNS(null,"cursor",c.cursor)}return g},dashStyle:function(c,b){var a=c.strokeWidth*b;switch(c.strokeDashstyle){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return c.strokeDashstyle.replace(/ /g,",")}},createNode:function(a,c){var b=document.createElementNS(this.xmlns,a);if(c){b.setAttributeNS(null,"id",c)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(){return this.nodeFactory(this.container.id+"_root","g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(c,e,d){var b=this.getResolution();var a=(e.x/b+this.left);var f=(this.top-e.y/b);if(this.inValidRange(a,f)){c.setAttributeNS(null,"cx",a);c.setAttributeNS(null,"cy",f);c.setAttributeNS(null,"r",d);return c}else{return false}},drawLineString:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawLinearRing:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawPolygon:function(a,h){var g="";var i=true;var f=true;var c,k;for(var b=0,e=h.components.length;b<e;b++){g+=" M";c=this.getComponentsString(h.components[b].components," ");k=c.path;if(k){g+=" "+k;f=c.complete&&f}else{i=false}}g+=" z";if(i){a.setAttributeNS(null,"d",g);a.setAttributeNS(null,"fill-rule","evenodd");return f?a:null}else{return false}},drawRectangle:function(c,d){var b=this.getResolution();var a=(d.x/b+this.left);var e=(this.top-d.y/b);if(this.inValidRange(a,e)){c.setAttributeNS(null,"x",a);c.setAttributeNS(null,"y",e);c.setAttributeNS(null,"width",d.width/b);c.setAttributeNS(null,"height",d.height/b);return c}else{return false}},drawSurface:function(f,h){var g=null;var b=true;for(var e=0,a=h.components.length;e<a;e++){if((e%3)==0&&(e/3)==0){var c=this.getShortString(h.components[e]);if(!c){b=false}g="M "+c}else{if((e%3)==1){var c=this.getShortString(h.components[e]);if(!c){b=false}g+=" C "+c}else{var c=this.getShortString(h.components[e]);if(!c){b=false}g+=" "+c}}}g+=" Z";if(b){f.setAttributeNS(null,"d",g);return f}else{return false}},getComponentsString:function(a,d){var h=[];var f=true;var e=a.length;var k=[];var g,l,b;for(var c=0;c<e;c++){l=a[c];h.push(l);g=this.getShortString(l);if(g){k.push(g)}else{if(c>0){if(this.getShortString(a[c-1])){k.push(this.clipLine(a[c],a[c-1]))}}if(c<e-1){if(this.getShortString(a[c+1])){k.push(this.clipLine(a[c],a[c+1]))}}f=false}}return{path:k.join(d||","),complete:f}},clipLine:function(g,h){if(h.equals(g)){return""}var f=this.getResolution();var c=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var d=h.x/f+this.left;var j=this.top-h.y/f;var b=g.x/f+this.left;var i=this.top-g.y/f;var e;if(b<-c||b>c){e=(i-j)/(b-d);b=b<0?-c:c;i=j+(b-d)*e}if(i<-a||i>a){e=(b-d)/(i-j);i=i<0?-a:a;b=d+(i-j)*e}return b+","+i},getShortString:function(b){var c=this.getResolution();var a=(b.x/c+this.left);var d=(this.top-b.y/c);if(this.inValidRange(a,d)){return a+","+d}else{return false}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))})},importSymbol:function(f){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+f;if(document.getElementById(b)!=null){return b}var e=OpenLayers.Renderer.symbol[f];if(!e){throw new Error(f+" is not a valid symbol name");return}var g=this.nodeFactory(b,"symbol");var c=this.nodeFactory(null,"polygon");g.appendChild(c);var m=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var l="";var j,h;for(var d=0;d<e.length;d=d+2){j=e[d];h=e[d+1];m.left=Math.min(m.left,j);m.bottom=Math.min(m.bottom,h);m.right=Math.max(m.right,j);m.top=Math.max(m.top,h);l+=" "+j+","+h}c.setAttributeNS(null,"points",l);var a=m.getWidth();var k=m.getHeight();var n=[m.left-a,m.bottom-k,a*3,k*3];g.setAttributeNS(null,"viewBox",n.join(" "));this.symbolSize[b]=Math.max(a,k)*3;this.defs.appendChild(g);return g.id},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(a){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var b=document.createStyleSheet();b.addRule("olv\\:*","behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.offset={x:0,y:0}},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(a,d){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution();var f=a.left/c;var e=a.top/c-this.size.h;if(d){this.offset={x:f,y:e};f=0;e=0}else{f=f-this.offset.x;e=e-this.offset.y}var g=f+" "+e;this.root.setAttribute("coordorigin",g);var b=this.size.w+" "+this.size.h;this.root.setAttribute("coordsize",b);this.root.style.flip="y";return true},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.style.width=this.size.w+"px";this.rendererRoot.style.height=this.size.h+"px";this.root.style.width=this.size.w+"px";this.root.style.height=this.size.h+"px"},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="olv:rect"}else{if(this.isComplexSymbol(b.graphicName)){a="olv:shape"}else{a="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":a="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="olv:shape";break;default:break}return a},setStyle:function(d,b,k,l){b=b||d._style;k=k||d._options;var i=1;if(d._geometryClass=="OpenLayers.Geometry.Point"){if(b.externalGraphic){var c=b.graphicWidth||b.graphicHeight;var n=b.graphicHeight||b.graphicWidth;c=c?c:b.pointRadius*2;n=n?n:b.pointRadius*2;var g=this.getResolution();var h=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*c);var f=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*n);d.style.left=((l.x/g-this.offset.x)+h).toFixed();d.style.top=((l.y/g-this.offset.y)-(f+n)).toFixed();d.style.width=c+"px";d.style.height=n+"px";d.style.flip="y";b.fillColor="none";k.isStroked=false}else{if(this.isComplexSymbol(b.graphicName)){var a=this.importSymbol(b.graphicName);var p=a.extent;var c=p.getWidth();var n=p.getHeight();d.setAttribute("path",a.path);d.setAttribute("coordorigin",p.left+","+p.bottom);d.setAttribute("coordsize",c+","+n);d.style.left=p.left+"px";d.style.top=p.bottom+"px";d.style.width=c+"px";d.style.height=n+"px";this.drawCircle(d,l,b.pointRadius);d.style.flip="y"}else{this.drawCircle(d,l,b.pointRadius)}}}if(k.isFilled){d.setAttribute("fillcolor",b.fillColor)}else{d.setAttribute("filled","false")}var j=d.getElementsByTagName("fill");var o=(j.length==0)?null:j[0];if(!k.isFilled){if(o){d.removeChild(o)}}else{if(!o){o=this.createNode("olv:fill",d.id+"_fill")}o.setAttribute("opacity",b.fillOpacity);if(d._geometryClass=="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){o.setAttribute("opacity",b.graphicOpacity)}o.setAttribute("src",b.externalGraphic);o.setAttribute("type","frame");if(!(b.graphicWidth&&b.graphicHeight)){o.aspect="atmost"}}if(o.parentNode!=d){d.appendChild(o)}}if(typeof b.rotation!="undefined"){if(b.externalGraphic){this.graphicRotate(d,h,f);o.setAttribute("opacity",0)}else{d.style.rotation=b.rotation}}if(k.isStroked){d.setAttribute("strokecolor",b.strokeColor);d.setAttribute("strokeweight",b.strokeWidth+"px")}else{d.setAttribute("stroked","false")}var e=d.getElementsByTagName("stroke");var m=(e.length==0)?null:e[0];if(!k.isStroked){if(m){d.removeChild(m)}}else{if(!m){m=this.createNode("olv:stroke",d.id+"_stroke");d.appendChild(m)}m.setAttribute("opacity",b.strokeOpacity);m.setAttribute("endcap",!b.strokeLinecap||b.strokeLinecap=="butt"?"flat":b.strokeLinecap);m.setAttribute("dashstyle",this.dashStyle(b))}if(b.cursor!="inherit"&&b.cursor!=null){d.style.cursor=b.cursor}return d},graphicRotate:function(l,q,c){var n=n||l._style;var f=l._options;var a,j;if(!(n.graphicWidth&&n.graphicHeight)){var s=new Image();s.onreadystatechange=OpenLayers.Function.bind(function(){if(s.readyState=="complete"||s.readyState=="interactive"){a=s.width/s.height;j=Math.max(n.pointRadius*2,n.graphicWidth||0,n.graphicHeight||0);q=q*a;n.graphicWidth=j*a;n.graphicHeight=j;this.graphicRotate(l,q,c)}},this);s.src=n.externalGraphic;return}else{j=Math.max(n.graphicWidth,n.graphicHeight);a=n.graphicWidth/n.graphicHeight}var k=Math.round(n.graphicWidth||j*a);var p=Math.round(n.graphicHeight||j);l.style.width=k+"px";l.style.height=p+"px";var i=document.getElementById(l.id+"_image");if(!i){i=this.createNode("olv:imagedata",l.id+"_image");l.appendChild(i)}i.style.width=k+"px";i.style.height=p+"px";i.src=n.externalGraphic;i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var o=n.rotation*Math.PI/180;var h=Math.sin(o);var d=Math.cos(o);var b="progid:DXImageTransform.Microsoft.Matrix(M11="+d+",M12="+(-h)+",M21="+h+",M22="+d+",SizingMethod='auto expand')\n";var g=n.graphicOpacity||n.fillOpacity;if(g&&g!=1){b+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+g+")\n"}l.style.filter=b;var m=new OpenLayers.Geometry.Point(-q,-c);var e=new OpenLayers.Bounds(0,0,k,p).toGeometry();e.rotate(n.rotation,m);var r=e.getBounds();l.style.left=Math.round(parseInt(l.style.left)+r.left)+"px";l.style.top=Math.round(parseInt(l.style.top)-r.bottom)+"px"},postDraw:function(a){var c=a._style.fillColor;var b=a._style.strokeColor;if(c=="none"&&a.getAttribute("fillcolor")!=c){a.setAttribute("fillcolor",c)}if(b=="none"&&a.getAttribute("strokecolor")!=b){a.setAttribute("strokecolor",b)}},setNodeDimension:function(b,e){var d=e.getBounds();if(d){var a=this.getResolution();var c=new OpenLayers.Bounds((d.left/a-this.offset.x).toFixed(),(d.bottom/a-this.offset.y).toFixed(),(d.right/a-this.offset.x).toFixed(),(d.top/a-this.offset.y).toFixed());b.style.left=c.left+"px";b.style.top=c.top+"px";b.style.width=c.getWidth()+"px";b.style.height=c.getHeight()+"px";b.coordorigin=c.left+" "+c.top;b.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){var c=a.strokeDashstyle;switch(c){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return c;default:var b=c.split(/[ ,]/);if(b.length==2){if(1*b[0]>=2*b[1]){return"longdash"}return(b[0]==1||b[1]==1)?"dot":"dash"}else{if(b.length==4){return(1*b[0]>=2*b[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(a,c){var b=document.createElement(a);if(c){b.setAttribute("id",c)}b.setAttribute("unselectable","on",0);b.onselectstart=function(){return(false)};return b},nodeTypeCompare:function(c,b){var d=b;var a=d.indexOf(":");if(a!=-1){d=d.substr(a+1)}var e=c.nodeName;a=e.indexOf(":");if(a!=-1){e=e.substr(a+1)}return(d==e)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(){return this.nodeFactory(this.container.id+"_root","olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(c,e,d){if(!isNaN(e.x)&&!isNaN(e.y)){var b=this.getResolution();c.style.left=((e.x/b-this.offset.x).toFixed()-d)+"px";c.style.top=((e.y/b-this.offset.y).toFixed()-d)+"px";var a=d*2;c.style.width=a+"px";c.style.height=a+"px";return c}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,b,true)},drawLine:function(a,k,b){this.setNodeDimension(a,k);var f=this.getResolution();var h=k.components.length;var d=new Array(h);var g,l,j;for(var e=0;e<h;e++){g=k.components[e];l=(g.x/f-this.offset.x);j=(g.y/f-this.offset.y);d[e]=" "+l.toFixed()+","+j.toFixed()+" l "}var c=(b)?" x e":" e";a.path="m"+d.join("")+c;return a},drawPolygon:function(b,l){this.setNodeDimension(b,l);var e=this.getResolution();var n=[];var f,d,c,h,a,g,m,k;for(c=0,h=l.components.length;c<h;c++){f=l.components[c];n.push("m");for(d=0,a=f.components.length;d<a;d++){g=f.components[d];m=g.x/e-this.offset.x;k=g.y/e-this.offset.y;n.push(" "+m.toFixed()+","+k.toFixed());if(d==0){n.push(" l")}}n.push(" x ")}n.push("e");b.path=n.join("");return b},drawRectangle:function(b,c){var a=this.getResolution();b.style.left=(c.x/a-this.offset.x)+"px";b.style.top=(c.y/a-this.offset.y)+"px";b.style.width=c.width/a+"px";b.style.height=c.height/a+"px";return b},drawSurface:function(a,f){this.setNodeDimension(a,f);var c=this.getResolution();var j=[];var d,h,g;for(var b=0,e=f.components.length;b<e;b++){d=f.components[b];h=d.x/c-this.offset.x;g=d.y/c-this.offset.y;if((b%3)==0&&(b/3)==0){j.push("m")}else{if((b%3)==1){j.push(" c")}}j.push(" "+h+","+g)}j.push(" x e");a.path=j.join("");return a},importSymbol:function(e){var h=this.container.id+"-"+e;var b=this.symbolCache[h];if(b){return b}var a=OpenLayers.Renderer.symbol[e];if(!a){throw new Error(e+" is not a valid symbol name");return}var g=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var c=["m"];for(var d=0;d<a.length;d=d+2){x=a[d];y=a[d+1];g.left=Math.min(g.left,x);g.bottom=Math.min(g.bottom,y);g.right=Math.max(g.right,x);g.top=Math.max(g.top,y);c.push(x);c.push(y);if(d==0){c.push("l")}}c.push("x e");var f=c.join(" ");b={path:f,extent:g};this.symbolCache[h]=b;return b},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(e,a,b,c,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=c;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0].id)}OpenLayers.Event.stopObservingElement(this.imgDiv.id);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!a){return false}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var b=this.layer.maxExtent;var a=(b&&this.bounds.intersectsBounds(b,false));if(a){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.imageSize||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv()}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice()}this.url=this.layer.getURL(this.bounds);OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize();if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}return true},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){var c=this.layer.imageOffset;var a=this.layer.getImageSize();if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,c,a,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,c,a,null,"relative",null,null,true)}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var d=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(d,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(d,this))}var b=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){d.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(b,this))},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var e=1;if(this.backBufferTile.resolution){e=this.backBufferTile.resolution/this.layer.getResolution()}if(e!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var d=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var c=new OpenLayers.Size(this.backBufferTile.size.w*e,this.backBufferTile.size.h*e);var b=this.layer.map.getLayerPxFromLonLat(d);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,b,c);var a=this.backBufferTile.imageSize;a=new OpenLayers.Size(a.w*e,a.h*e);var f=this.backBufferTile.imageOffset;if(f){f=new OpenLayers.Pixel(f.x*e,f.y*e)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,f,a);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}this.lastRatio=e},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(e,a,b,c,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=c;this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments);this.destroyAllFeatures();this.features=null;this.url=null;if(this.request){this.request.abort();this.request=null}},clear:function(){this.destroyAllFeatures()},draw:function(){if(OpenLayers.Tile.prototype.draw.apply(this,arguments)){if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.loadFeaturesForRegion(this.requestSuccess)}},loadFeaturesForRegion:function(b,a){if(this.request){this.request.abort()}this.request=OpenLayers.Request.GET({url:this.url,success:b,failure:a,scope:this})},requestSuccess:function(b){if(this.features){var d=b.responseXML;if(!d||!d.documentElement){d=b.responseText}if(this.layer.vectorMode){this.layer.addFeatures(this.layer.formatObject.read(d))}else{var a=new OpenLayers.Format.XML();if(typeof d=="string"){d=a.read(d)}var c=a.getElementsByTagNameNS(d,"http://www.opengis.net/gml","featureMember");this.addResults(c)}}if(this.events){this.events.triggerEvent("loadend")}this.request=null},addResults:function(c){for(var b=0;b<c.length;b++){var a=new this.layer.featureClass(this.layer,c[b]);this.features.push(a)}},destroyAllFeatures:function(){while(this.features.length>0){var a=this.features.shift();a.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,handlers:null,resolutionFactor:1,initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(!this.mapDiv){return}this.handlers.click.destroy();this.mapDiv.removeChild(this.extentRectangle);this.extentRectangle=null;this.rectEvents.destroy();this.rectEvents=null;this.ovmap.destroy();this.ovmap=null;this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){OpenLayers.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var d=this.map.baseLayer.clone();this.layers=[d]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var e=OpenLayers.Util.getImagesLocation();var b=e+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var b=e+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var f=["dblclick","mousedown"];for(var c=0,a=f.length;c<a;c++){OpenLayers.Event.observe(this.maximizeDiv,f[c],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,f[c],OpenLayers.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(i){var c=this.handlers.drag.last.x-i.x;var e=this.handlers.drag.last.y-i.y;if(c!=0||e!=0){var g=this.rectPxBounds.top;var f=this.rectPxBounds.left;var b=Math.abs(this.rectPxBounds.getHeight());var d=this.rectPxBounds.getWidth();var a=Math.max(0,(g-e));a=Math.min(a,this.ovmap.size.h-this.hComp-b);var h=Math.max(0,(f-c));h=Math.min(h,this.ovmap.size.w-this.wComp-d);this.setRectPxBounds(new OpenLayers.Bounds(h,a+b,h+d,a))}},mapDivClick:function(j){var f=this.rectPxBounds.getCenterPixel();var d=j.xy.x-f.x;var e=j.xy.y-f.y;var g=this.rectPxBounds.top;var c=this.rectPxBounds.left;var i=Math.abs(this.rectPxBounds.getHeight());var b=this.rectPxBounds.getWidth();var a=Math.max(0,(g+e));a=Math.min(a,this.ovmap.size.h-i);var h=Math.max(0,(c+d));h=Math.min(h,this.ovmap.size.w-b);this.setRectPxBounds(new OpenLayers.Bounds(h,a+i,h+b,a));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";this.showToggle(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);if(a!=null){OpenLayers.Event.stop(a)}},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){if(this.ovmap==null){this.createMap()}if(!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent();var c=this.map.maxExtent;var b=new OpenLayers.Bounds(Math.max(a.left,c.left),Math.max(a.bottom,c.bottom),Math.min(a.right,c.right),Math.min(a.top,c.top));if(this.ovmap.getProjection()!=this.map.getProjection()){b=b.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var d=this.ovmap.getResolution()/this.map.getResolution();return((d>this.minRatio)&&(d<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(b)))},updateOverview:function(){var a=this.map.getResolution();var c=this.ovmap.getResolution();var d=c/a;if(d>this.maxRatio){c=this.minRatio*a}else{if(d<=this.minRatio){c=this.maxRatio*a}}var b;if(this.ovmap.getProjection()!=this.map.getProjection()){b=this.map.center.clone();b.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{b=this.map.center}this.ovmap.setCenter(b,this.ovmap.getZoomForResolution(c*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(d){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(d){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var c=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=c&&b?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[b]:1}},updateRectToMap:function(){var a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{a=this.map.getExtent()}var b=this.getRectBoundsFromMapBounds(a);if(b){this.setRectPxBounds(b)}},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(d){var g=Math.max(d.top,0);var c=Math.max(d.left,0);var e=Math.min(d.top+Math.abs(d.getHeight()),this.ovmap.size.h-this.hComp);var i=Math.min(d.left+d.getWidth(),this.ovmap.size.w-this.wComp);var b=Math.max(i-c,0);var h=Math.max(e-g,0);if(b<this.minRectSize||h<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var f=c+(b/2)-(this.minRectSize/2);var a=g+(h/2)-(this.minRectSize/2);this.extentRectangle.style.top=Math.round(a)+"px";this.extentRectangle.style.left=Math.round(f)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(g)+"px";this.extentRectangle.style.left=Math.round(c)+"px";this.extentRectangle.style.height=Math.round(h)+"px";this.extentRectangle.style.width=Math.round(b)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(e),Math.round(i),Math.round(g))},getRectBoundsFromMapBounds:function(d){var b=new OpenLayers.LonLat(d.left,d.bottom);var f=new OpenLayers.LonLat(d.right,d.top);var c=this.getOverviewPxFromLonLat(b);var e=this.getOverviewPxFromLonLat(f);var a=null;if(c&&e){a=new OpenLayers.Bounds(c.x,c.y,e.x,e.y)}return a},getMapBoundsFromRectBounds:function(c){var b=new OpenLayers.Pixel(c.left,c.bottom);var d=new OpenLayers.Pixel(c.right,c.top);var a=this.getLonLatFromOverviewPx(b);var e=this.getLonLatFromOverviewPx(d);return new OpenLayers.Bounds(a.lon,a.lat,e.lon,e.lat)},getLonLatFromOverviewPx:function(f){var b=this.ovmap.size;var a=this.ovmap.getResolution();var c=this.ovmap.getExtent().getCenterLonLat();var e=f.x-(b.w/2);var d=f.y-(b.h/2);return new OpenLayers.LonLat(c.lon+e*a,c.lat-d*a)},getOverviewPxFromLonLat:function(a){var d=this.ovmap.getResolution();var b=this.ovmap.getExtent();var c=null;if(b){c=new OpenLayers.Pixel(Math.round(1/d*(a.lon-b.left)),Math.round(1/d*(b.top-a.lat)))}return c},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(b,a,c){this.layer=b;this.lonlat=a;this.data=(c!=null)?c:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){if(this.lonlat!=null){var c=this.id+"_popup";var a=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(c,this.lonlat,this.data.popupSize,this.data.popupContentHTML,a,b)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.Format.WMC=OpenLayers.Class({defaultVersion:"1.1.0",version:null,layerOptions:null,parser:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},read:function(e,d){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var b=e.documentElement;var a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=a){var g=OpenLayers.Format.WMC["v"+a.replace(/\./g,"_")];if(!g){throw"Can't find a WMC parser for version "+a}this.parser=new g(this.options)}var c=this.parser.read(e,d);var f;if(d.map){this.context=c;if(d.map instanceof OpenLayers.Map){f=this.mergeContextToMap(c,d.map)}else{f=this.contextToMap(c,d.map)}}else{f=c}return f},contextToMap:function(a,c){var b=new OpenLayers.Map(c,{maxExtent:a.maxExtent,projection:a.projection});b.addLayers(a.layers);b.setCenter(a.bounds.getCenterLonLat(),b.getZoomForExtent(a.bounds,true));return b},mergeContextToMap:function(a,b){b.addLayers(a.layers);return b},write:function(d,b){if(d.CLASS_NAME=="OpenLayers.Map"){d=this.mapToContext(d)}var a=(b&&b.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var e=OpenLayers.Format.WMC["v"+a.replace(/\./g,"_")];if(!e){throw"Can't find a WMS capabilities parser for version "+a}this.parser=new e(this.options)}var c=this.parser.write(d,b);return c},mapToContext:function(b){var a={bounds:b.getExtent(),maxExtent:b.maxExtent,projection:b.projection,layers:b.layers,size:b.getSize()};return a},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.pixelTolerance!=null){this.mousedown=function(d){this.down=d.xy;return true}}},mousedown:null,mouseup:function(a){var b=true;if(this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)){b=this.rightclick(a)}return b},rightclick:function(a){if(this.passesTolerance(a)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[a]);return !this.stopDouble}else{var c=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]);var b=OpenLayers.Function.bind(this.delayedRightCall,this,c);this.rightclickTimerId=window.setTimeout(b,this.delay)}}return !this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}return !this.stopSingle},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a])}this.clearTimer()}return !this.stopDouble},click:function(a){if(this.passesTolerance(a)){if(this.timerId!=null){this.clearTimer()}else{var b=this.single?OpenLayers.Util.extend({},a):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)}}return !this.stopSingle},passesTolerance:function(c){var b=true;if(this.pixelTolerance!=null&&this.down){var a=Math.sqrt(Math.pow(this.down.x-c.xy.x,2)+Math.pow(this.down.y-c.xy.y,2));if(a>this.pixelTolerance){b=false}}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){var b=true;this.dragging=false;if(this.checkModifiers(a)&&OpenLayers.Event.isLeftClick(a)){this.started=true;this.start=a.xy;this.last=a.xy;this.map.div.style.cursor="move";this.down(a);this.callback("down",[a.xy]);OpenLayers.Event.stop(a);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:function(){return true};document.onselectstart=function(){return false}}b=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return b},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=function(){return false}}this.last=this.evt.xy}return true},removeTimeout:function(){this.timeoutId=null},mouseup:function(b){if(this.started){var a=(this.start!=this.last);this.started=false;this.dragging=false;this.map.div.style.cursor="";this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){var a=(this.start!=this.last);this.started=false;this.dragging=false;this.map.div.style.cursor="";this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}return true},click:function(a){return(this.start==this.last)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickoutTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(d,c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,[d,a,b]);this.layer=c},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(a);return true},dblclick:function(a){return !this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(b){if(this.feature&&!this.feature.layer){this.feature=null}var d=b.type;var f=false;var a=!!(this.feature);var e=(d=="click"||d=="dblclick");this.feature=this.layer.getFeatureFromEvent(b);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){var c=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(a&&c){if(this.lastFeature){this.triggerCallback(d,"out",[this.lastFeature])}this.triggerCallback(d,"in",[this.feature])}else{if(!a||e){this.triggerCallback(d,"in",[this.feature])}}this.lastFeature=this.feature;f=true}else{if(this.lastFeature&&(a&&c||e)){this.triggerCallback(d,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(a||e)){this.triggerCallback(d,"out",[this.lastFeature])}}return f},triggerCallback:function(d,e,b){var c=this.EVENTMAP[d][e];if(c){if(d=="click"&&e=="out"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickoutTolerance){this.callback(c,b)}}else{this.callback(c,b)}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}return !this.stopMove},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a])}return true},passesTolerance:function(c){var b=true;if(this.pixelTolerance&&this.px){var a=Math.sqrt(Math.pow(this.px.x-c.x,2)+Math.pow(this.px.y-c.y,2));if(a<this.pixelTolerance){b=false}}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.observe(document,this.KEY_EVENTS[b],this.eventListener)}return true}else{return false}},deactivate:function(){var c=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[b],this.eventListener)}c=true}return c},handleKeyEvent:function(a){if(this.checkModifiers(a)){this.callback(a.type,[a])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(k){if(!this.map||!this.checkModifiers(k)){return}var f=false;var l=false;var g=false;var b=OpenLayers.Event.element(k);while((b!=null)&&!g&&!f){if(!f){try{if(b.currentStyle){c=b.currentStyle.overflow}else{var a=document.defaultView.getComputedStyle(b,null);var c=a.getPropertyValue("overflow")}f=(c&&(c=="auto")||(c=="scroll"))}catch(d){}}if(!l){for(var h=0,j=this.map.layers.length;h<j;h++){if(b==this.map.layers[h].div||b==this.map.layers[h].pane){l=true;break}}}g=(b==this.map.div);b=b.parentNode}if(!f&&g){if(l){this.wheelZoom(k)}OpenLayers.Event.stop(k)}},wheelZoom:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){b=-b}}else{if(a.detail){b=-a.detail/3}}if(b){if(this.mousePosition){a.xy=this.mousePosition}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(b<0){this.callback("down",[a,b])}else{this.callback("up",[a,b])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true}else{return false}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],initialize:function(a,b){this.addOptions(b);this.name=a;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(a){if(a==null){a=true}if(this.map!=null){this.map.removeLayer(this,a)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.options)}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(a){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},onMapResize:function(){},redraw:function(){var a=false;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&this.inRange&&this.visibility){this.moveTo(b,true,false);a=true}}return a},moveTo:function(b,c,a){var d=this.visibility;if(!this.isBaseLayer){d=d&&this.inRange}this.display(d)},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.projection=this.projection||this.map.projection;if(this.projection&&typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none"}this.setTileSize()}},removeMap:function(a){},getImageSize:function(){return(this.imageSize||this.tileSize)},setTileSize:function(b){var a=(b)?b:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=a;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(a.w+(2*this.gutter),a.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(a){var b=this.calculateInRange();if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&b)?"block":"none"}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution))}}return b},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var n=new Array("projection","units","scales","resolutions","maxScale","minScale","maxResolution","minResolution","minExtent","maxExtent","numZoomLevels","maxZoomLevel");var b=["projection","units"];var d=false;var f={};for(var e=0,j=n.length;e<j;e++){var p=n[e];if(this.options[p]&&OpenLayers.Util.indexOf(b,p)==-1){d=true}f[p]=this.options[p]||this.map[p]}if(this.alwaysInRange==null){this.alwaysInRange=!d}if((this.options.minScale!=null||this.options.maxScale!=null)&&this.options.scales==null){f.scales=null}if((this.options.minResolution!=null||this.options.maxResolution!=null)&&this.options.resolutions==null){f.resolutions=null}if((!f.numZoomLevels)&&(f.maxZoomLevel)){f.numZoomLevels=f.maxZoomLevel+1}if((f.scales!=null)||(f.resolutions!=null)){if(f.scales!=null){f.resolutions=[];for(var e=0,j=f.scales.length;e<j;e++){var c=f.scales[e];f.resolutions[e]=OpenLayers.Util.getResolutionFromScale(c,f.units)}}f.numZoomLevels=f.resolutions.length}else{if(f.minScale){f.maxResolution=OpenLayers.Util.getResolutionFromScale(f.minScale,f.units)}else{if(f.maxResolution=="auto"){var o=this.map.getSize();var m=f.maxExtent.getWidth()/o.w;var h=f.maxExtent.getHeight()/o.h;f.maxResolution=Math.max(m,h)}}if(f.maxScale!=null){f.minResolution=OpenLayers.Util.getResolutionFromScale(f.maxScale,f.units)}else{if((f.minResolution=="auto")&&(f.minExtent!=null)){var o=this.map.getSize();var m=f.minExtent.getWidth()/o.w;var h=f.minExtent.getHeight()/o.h;f.minResolution=Math.max(m,h)}}if(f.minResolution!=null&&this.options.numZoomLevels==undefined){var l=f.maxResolution/f.minResolution;f.numZoomLevels=Math.floor(Math.log(l)/Math.log(2))+1}f.resolutions=new Array(f.numZoomLevels);var a=2;if(typeof f.minResolution=="number"&&f.numZoomLevels>1){a=Math.pow((f.maxResolution/f.minResolution),(1/(f.numZoomLevels-1)))}for(var e=0;e<f.numZoomLevels;e++){var k=f.maxResolution/Math.pow(a,e);f.resolutions[e]=k}}f.resolutions.sort(function(q,i){return(i-q)});this.resolutions=f.resolutions;this.maxResolution=f.resolutions[0];var g=f.resolutions.length-1;this.minResolution=f.resolutions[g];this.scales=[];for(var e=0,j=f.resolutions.length;e<j;e++){this.scales[e]=OpenLayers.Util.getScaleFromResolution(f.resolutions[e],f.units)}this.minScale=this.scales[0];this.maxScale=this.scales[this.scales.length-1];this.numZoomLevels=f.numZoomLevels},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(b,c){var d=this.map.getSize();var a=Math.max(b.getWidth()/d.w,b.getHeight()/d.h);return this.getZoomForResolution(a,c)},getDataExtent:function(){},getResolutionForZoom:function(c){c=Math.max(0,Math.min(c,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var a=Math.floor(c);var d=Math.ceil(c);b=this.resolutions[a]-((c-a)*(this.resolutions[a]-this.resolutions[d]))}else{b=this.resolutions[Math.round(c)]}return b},getZoomForResolution:function(d,a){var n;if(this.map.fractionalZoom){var k=0;var e=this.resolutions.length-1;var b=this.resolutions[k];var h=this.resolutions[e];var j;for(var c=0,f=this.resolutions.length;c<f;++c){j=this.resolutions[c];if(j>=d){b=j;k=c}if(j<=d){h=j;e=c;break}}var g=b-h;if(g>0){n=k+((b-d)/g)}else{n=k}}else{var l;var m=Number.POSITIVE_INFINITY;for(var c=0,f=this.resolutions.length;c<f;c++){if(a){l=Math.abs(this.resolutions[c]-d);if(l>m){break}m=l}else{if(this.resolutions[c]<d){break}}}n=Math.max(0,c-1)}return n},getLonLatFromViewPortPx:function(d){var a=null;if(d!=null){var c=this.map.getSize();var e=this.map.getCenter();if(e){var b=this.map.getResolution();var g=d.x-(c.w/2);var f=d.y-(c.h/2);a=new OpenLayers.LonLat(e.lon+g*b,e.lat-f*b);if(this.wrapDateLine){a=a.wrapDateLine(this.maxExtent)}}}return a},getViewPortPxFromLonLat:function(a){var d=null;if(a!=null){var c=this.map.getResolution();var b=this.map.getExtent();d=new OpenLayers.Pixel((1/c*(a.lon-b.left)),(1/c*(b.top-a.lat)))}return d},setOpacity:function(d){if(d!=this.opacity){this.opacity=d;for(var c=0,a=this.div.childNodes.length;c<a;++c){var b=this.div.childNodes[c].firstChild;OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,d)}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,c,b){this.bounds=a;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div,null);this.setBorder(c,b)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){if(!a){a="red"}if(!b){b=2}this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsBounds(this.bounds,true,true)}return b},display:function(a){this.div.style.display=(a)?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(676,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,32,80,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-668)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-668)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(600,660),initialize:function(g,a,f,b,c,e,d){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(b,a){},onDrag:function(b,a){},onComplete:function(b,a){},layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks)),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){if(!this.handlers.drag.dragging){this.feature=a;this.handlers.drag.activate();this.over=true;this.map.div.style.cursor="move"}else{if(this.feature.id==a.id){this.over=true}else{this.over=false}}},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate();this.feature=null;this.map.div.style.cursor="default"}else{this.map.div.style.cursor="move"}},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();this.map.div.style.cursor="default";this.feature=null}else{if(this.feature.id==a.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval})},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false})},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{slideFactor:75,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress});this.activate()},defaultKeyPress:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:var b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:var b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:var b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,renderIntent:"default",initialize:function(c,a,b){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,a]);this.lonlat=null;this.geometry=c?c:null;this.state=null;this.attributes={};if(a){this.attributes=OpenLayers.Util.extend(this.attributes,a)}this.style=b?b:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var d=false;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var b=this.geometry.getBounds();d=c.intersectsBounds(b)}else{var e=c.toGeometry();d=e.intersects(this.geometry)}}return d},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,c,d){var b=false;if(this.geometry){b=this.geometry.atPoint(a,c,d)}return b},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a)}else{b=a}var d=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var c=this.layer.map.getResolution();this.geometry.move(c*(b.x-d.x),c*(d.y-b.y));this.layer.drawFeature(this);return d},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"yellow",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"yellow",strokeOpacity:1,strokeLinecap:"round",strokeWidth:4,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"}};OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(b,a){var c=arguments;var d=this.processXMLNode(a);c=new Array(b,d.lonlat,d);OpenLayers.Feature.prototype.initialize.apply(this,c);this.createMarker();this.layer.addMarker(this.marker)},destroy:function(){if(this.marker!=null){this.layer.removeMarker(this.marker)}OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(b){var a=OpenLayers.Ajax.getElementsByTagNameNS(b,"http://www.opengis.net/gml","gml","Point");var d=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(a[0],"http://www.opengis.net/gml","gml","coordinates")[0]);var c=d.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(c[0]),parseFloat(c[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(b){var a=null;if(b==null){a=this.namespaces[this.defaultPrefix]}else{for(a in this.namespaces){if(this.namespaces[a]==b){break}}}return a},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a=c.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};this.runChildNodes(b,a);return b},runChildNodes:function(e,c){var a=c.childNodes;var h,f,b,j;for(var d=0,g=a.length;d<g;++d){h=a[d];if(h.nodeType==1){b=this.getNamespacePrefix(h.namespaceURI);j=h.nodeName.split(":").pop();f=this["read_"+b+"_"+j];if(f){f.apply(this,[e,h])}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")))},read_wmc_LayerList:function(a,b){a.layers=[];this.runChildNodes(a,b)},read_wmc_Layer:function(b,c){var d={params:{},options:{visibility:(c.getAttribute("hidden")!="1"),queryable:(c.getAttribute("queryable")=="1")},formats:[],styles:[]};this.runChildNodes(d,c);d.params.layers=d.name;d.options.maxExtent=d.maxExtent;var a=this.getLayerFromInfo(d);b.layers.push(a)},getLayerFromInfo:function(c){var b=c.options;if(this.layerOptions){OpenLayers.Util.applyDefaults(b,this.layerOptions)}var a=new OpenLayers.Layer.WMS(c.title,c.href,c.params,b);return a},read_wmc_Extension:function(b,a){this.runChildNodes(b,a)},read_ol_units:function(b,a){b.options.units=this.getChildValue(a)},read_ol_maxExtent:function(c,b){var a=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));c.maxExtent=a},read_ol_transparent:function(b,a){b.params.transparent=this.getChildValue(a)},read_ol_numZoomLevels:function(b,a){b.options.numZoomLevels=parseInt(this.getChildValue(a))},read_ol_opacity:function(b,a){b.options.opacity=parseFloat(this.getChildValue(a))},read_ol_singleTile:function(b,a){b.options.singleTile=(this.getChildValue(a)=="true")},read_ol_isBaseLayer:function(b,a){b.options.isBaseLayer=(this.getChildValue(a)=="true")},read_ol_displayInLayerSwitcher:function(b,a){b.options.displayInLayerSwitcher=(this.getChildValue(a)=="true")},read_wmc_Server:function(b,a){b.params.version=a.getAttribute("version");this.runChildNodes(b,a)},read_wmc_FormatList:function(b,a){this.runChildNodes(b,a)},read_wmc_Format:function(c,a){var b=this.getChildValue(a);c.formats.push(b);if(a.getAttribute("current")=="1"){c.params.format=b}},read_wmc_StyleList:function(b,a){this.runChildNodes(b,a)},read_wmc_Style:function(c,b){var a={};this.runChildNodes(a,b);if(b.getAttribute("current")=="1"){if(a.href){c.params.sld=a.href}else{if(a.body){c.params.sld_body=a.body}else{c.params.styles=a.name}}}c.styles.push(a)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(c,b){var a=OpenLayers.Format.XML.prototype.write.apply(this,[b]);c.body=a},read_wmc_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},read_wmc_Name:function(c,b){var a=this.getChildValue(b);if(a){c.name=a}},read_wmc_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_wmc_MetadataURL:function(d,b){var c={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(c,a[0])}d.options.metadataURL=c.href},read_wmc_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},read_wmc_LatLonBoundingBox:function(a,b){a.llbbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))]},read_wmc_LegendURL:function(c,d){var b={width:d.getAttribute("width"),height:d.getAttribute("height")};var a=d.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(b,a[0])}c.legend=b},write:function(c,b){var a=this.createElementDefaultNS("ViewContext");this.setAttributes(a,{version:this.VERSION,id:(b&&typeof b.id=="string")?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);a.appendChild(this.write_wmc_General(c));a.appendChild(this.write_wmc_LayerList(c));return OpenLayers.Format.XML.prototype.write.apply(this,[a])},createElementDefaultNS:function(c,b,a){var d=this.createElementNS(this.namespaces[this.defaultPrefix],c);if(b){d.appendChild(this.createTextNode(b))}if(a){this.setAttributes(d,a)}return d},setAttributes:function(b,d){var c;for(var a in d){c=d[a].toString();if(c.match(/[A-Z]/)){this.setAttributeNS(b,null,a,c)}else{b.setAttribute(a,c)}}},write_wmc_General:function(b){var c=this.createElementDefaultNS("General");if(b.size){c.appendChild(this.createElementDefaultNS("Window",null,{width:b.size.w,height:b.size.h}))}var a=b.bounds;c.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:a.left.toPrecision(10),miny:a.bottom.toPrecision(10),maxx:a.right.toPrecision(10),maxy:a.top.toPrecision(10),SRS:b.projection}));c.appendChild(this.createElementDefaultNS("Title",b.title));c.appendChild(this.write_ol_MapExtension(b));return c},write_ol_MapExtension:function(b){var c=this.createElementDefaultNS("Extension");var a=b.maxExtent;if(a){var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:a.left.toPrecision(10),miny:a.bottom.toPrecision(10),maxx:a.right.toPrecision(10),maxy:a.top.toPrecision(10)});c.appendChild(d)}return c},write_wmc_LayerList:function(d){var e=this.createElementDefaultNS("LayerList");var c;for(var b=0,a=d.layers.length;b<a;++b){c=d.layers[b];if(c instanceof OpenLayers.Layer.WMS){e.appendChild(this.write_wmc_Layer(c))}}return e},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.params.LAYERS));b.appendChild(this.createElementDefaultNS("Title",a.name));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a))}b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b},write_wmc_LayerExtension:function(f){var c=this.createElementDefaultNS("Extension");var h=f.maxExtent;var j=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(j,{minx:h.left.toPrecision(10),miny:h.bottom.toPrecision(10),maxx:h.right.toPrecision(10),maxy:h.top.toPrecision(10)});c.appendChild(j);var d=f.params.TRANSPARENT;if(d){var k=this.createElementNS(this.namespaces.ol,"ol:transparent");k.appendChild(this.createTextNode(d));c.appendChild(k)}var a=["numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var b;for(var e=0,g=a.length;e<g;++e){b=this.createOLPropertyNode(f,a[e]);if(b){c.appendChild(b)}}return c},createOLPropertyNode:function(b,c){var a=null;if(b[c]!=null){a=this.createElementNS(this.namespaces.ol,"ol:"+c);a.appendChild(this.createTextNode(b[c].toString()))}return a},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.params.VERSION});b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_MetadataURL:function(a){var b=this.createElementDefaultNS("MetadataURL");b.appendChild(this.write_wmc_OnlineResource(a.metadataURL));return b},write_wmc_FormatList:function(a){var b=this.createElementDefaultNS("FormatList");b.appendChild(this.createElementDefaultNS("Format",a.params.FORMAT,{current:"1"}));return b},write_wmc_StyleList:function(f){var d=this.createElementDefaultNS("StyleList");var b=this.createElementDefaultNS("Style",null,{current:"1"});if(f.params.SLD){var c=this.createElementDefaultNS("SLD");var g=this.write_wmc_OnlineResource(f.params.SLD);c.appendChild(g);b.appendChild(c)}else{if(f.params.SLD_BODY){var c=this.createElementDefaultNS("SLD");var e=f.params.SLD_BODY;var h=OpenLayers.Format.XML.prototype.read.apply(this,[e]);var i=h.documentElement;if(c.ownerDocument&&c.ownerDocument.importNode){i=c.ownerDocument.importNode(i,true)}c.appendChild(i);b.appendChild(c)}else{var a=f.params.STYLES?f.params.STYLES:this.defaultStyleName;b.appendChild(this.createElementDefaultNS("Name",a));b.appendChild(this.createElementDefaultNS("Title",this.defaultStyleTitle))}}d.appendChild(b);return d},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(c,a,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var a={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,a,{keyMask:this.keyMask})},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a)}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.map.div.style.cursor="crosshair"},moveBox:function(f){var c=this.dragHandler.start.x;var e=this.dragHandler.start.y;var b=Math.abs(c-f.x);var d=Math.abs(e-f.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,d)+"px";this.zoomBox.style.left=f.x<c?f.x+"px":c+"px";this.zoomBox.style.top=f.y<e?f.y+"px":e+"px";var a=this.getBoxCharacteristics();if(a.newBoxModel){if(f.x>c){this.zoomBox.style.width=Math.max(1,b-a.xOffset)+"px"}if(f.y>e){this.zoomBox.style.height=Math.max(1,d-a.yOffset)+"px"}}},endBox:function(a){var d;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var g=this.dragHandler.start;var f=Math.min(g.y,a.y);var c=Math.max(g.y,a.y);var e=Math.min(g.x,a.x);var b=Math.max(g.x,a.x);d=new OpenLayers.Bounds(e,c,b,f)}else{d=this.dragHandler.start.clone()}this.removeBox();this.map.div.style.cursor="";this.callback("done",[d])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true}else{return false}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var b=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var c=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:b,newBoxModel:c}}return this.boxCharacteristics},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(c,a,b){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});OpenLayers.Handler.prototype.initialize.apply(this,[c,a,b]);this.options=(b)?b:new Object()},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b={displayInLayerSwitcher:false,calculateInRange:function(){return true}};this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;a=true}return a},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(c){var e=this.map.getLonLatFromPixel(c.xy);var a=new OpenLayers.Geometry.Point(e.lon,e.lat);if(this.irregular){var g=Math.sqrt(2)*Math.abs(a.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,g)}else{if(this.fixedRadius){this.origin=a}else{this.calculateAngle(a,c);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin))}}this.modifyGeometry();if(this.irregular){var d=a.x-this.origin.x;var b=a.y-this.origin.y;var f;if(b==0){f=d/(this.radius*Math.sqrt(2))}else{f=d/b}this.feature.geometry.resize(1,this.origin,f);this.feature.geometry.move(d/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize()},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var f,c,b,a;var d=this.feature.geometry.components[0];if(d.components.length!=(this.sides+1)){this.createGeometry();d=this.feature.geometry.components[0]}for(var e=0;e<this.sides;++e){a=d.components[e];f=this.angle+(e*2*Math.PI/this.sides);a.x=this.origin.x+(this.radius*Math.cos(f));a.y=this.origin.y+(this.radius*Math.sin(f));a.clearBounds()}},calculateAngle:function(a,b){var d=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!b[this.snapToggle])){var c=(Math.PI/180)*this.snapAngle;this.angle=Math.round(d/c)*c}else{this.angle=d}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer.renderer.clear();this.layer.destroyFeatures()},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(b=="done"||b=="cancel")){this.clear()}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.Util.getBrowserName()=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(a){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane);this.pane=null}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var g=this.map.getSize();var c=Math.min(g.w,300);var e=Math.min(g.h,200);var d=new OpenLayers.Size(c,e);var a=new OpenLayers.Pixel(g.w/2,g.h/2);var b=a.add(-d.w/2,-d.h/2);var f=OpenLayers.Util.createDiv(this.name+"_warning",b,d,null,null,null,"auto");f.style.padding="7px";f.style.backgroundColor="yellow";f.innerHTML=this.getWarningHTML();this.div.appendChild(f)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveTo:function(f,g,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var d=this.map.getCenter();var c=this.map.getZoom();if(d!=null){var b=this.getMapObjectCenter();var a=this.getOLLonLatFromMapObjectLonLat(b);var i=this.getMapObjectZoom();var h=this.getOLZoomFromMapObjectZoom(i);if(!(d.equals(a))||!(c==h)){if(k&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(a);var l=this.map.getViewPortPxFromLonLat(d);this.dragPanMapObject(l.x-j.x,j.y-l.y)}else{var e=this.getMapObjectLonLatFromOLLonLat(d);var m=this.getMapObjectZoomFromOLZoom(c);this.setMapObjectCenter(e,m,k)}}}}},getLonLatFromViewPortPx:function(b){var a=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var d=this.getMapObjectPixelFromOLPixel(b);var c=this.getMapObjectLonLatFromMapObjectPixel(d);a=this.getOLLonLatFromMapObjectLonLat(c)}return a},getViewPortPxFromLonLat:function(a){var b=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var c=this.getMapObjectLonLatFromOLLonLat(a);var d=this.getMapObjectPixelFromMapObjectLonLat(c);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(c){var a=null;if(c!=null){var d=this.getLongitudeFromMapObjectLonLat(c);var b=this.getLatitudeFromMapObjectLonLat(c);a=new OpenLayers.LonLat(d,b)}return a},getMapObjectLonLatFromOLLonLat:function(b){var a=null;if(b!=null){a=this.getMapObjectLonLatFromLonLat(b.lon,b.lat)}return a},getOLPixelFromMapObjectPixel:function(d){var c=null;if(d!=null){var a=this.getXFromMapObjectPixel(d);var b=this.getYFromMapObjectPixel(d);c=new OpenLayers.Pixel(a,b)}return c},getMapObjectPixelFromOLPixel:function(b){var a=null;if(b!=null){a=this.getMapObjectPixelFromXY(b.x,b.y)}return a},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var e=new Array("minZoomLevel","maxZoomLevel","numZoomLevels");for(var d=0,c=e.length;d<c;d++){var b=e[d];this[b]=(this.options[b]!=null)?this.options[b]:this.map[b]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var g;var a=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){g=this.maxZoomLevel-this.minZoomLevel+1}else{g=this.numZoomLevels}if(g!=null){this.numZoomLevels=Math.min(g,a)}else{this.numZoomLevels=a}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var f=0;this.resolutions=[];for(var d=this.minZoomLevel;d<=this.maxZoomLevel;d++){this.resolutions[f++]=this.RESOLUTIONS[d]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var b=null;var c=this.map.getSize();var a=this.getExtent();if((c!=null)&&(a!=null)){b=Math.max(a.getWidth()/c.w,a.getHeight()/c.h)}return b}},getExtent:function(){var a=null;var c=this.map.getSize();var e=new OpenLayers.Pixel(0,0);var f=this.getLonLatFromViewPortPx(e);var b=new OpenLayers.Pixel(c.w,c.h);var d=this.getLonLatFromViewPortPx(b);if((f!=null)&&(d!=null)){a=new OpenLayers.Bounds(f.lon,d.lat,d.lon,f.lat)}return a},getZoomForResolution:function(b){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var a=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(a)}},getOLZoomFromMapObjectZoom:function(b){var a=null;if(b!=null){a=b-this.minZoomLevel}return a},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=a+this.minZoomLevel}return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(b,a,e,c){var d=arguments;d=[b,c];OpenLayers.Layer.prototype.initialize.apply(this,d);this.url=a;this.params=OpenLayers.Util.extend({},e)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);return this.redraw()},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(e,d){var b=1;for(var c=0,a=e.length;c<a;c++){b*=e.charCodeAt(c)*this.URL_HASH_FACTOR;b-=Math.floor(b)}return d[Math.floor(b*d.length)]},getFullRequestString:function(d,e){var b=e||this.url;var c=OpenLayers.Util.extend({},this.params);c=OpenLayers.Util.extend(c,d);var a=OpenLayers.Util.getParameterString(c);if(b instanceof Array){b=this.selectUrl(a,b)}var g=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var h in c){if(h.toUpperCase() in g){delete c[h]}}a=OpenLayers.Util.getParameterString(c);var i=b;if(a!=""){var f=b.charAt(b.length-1);if((f=="&")||(f=="?")){i+=a}else{if(b.indexOf("?")==-1){i+="?"+a}else{i+="&"+a}}}return i},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(c,b,a,e,d){this.url=b;this.extent=a;this.size=e;OpenLayers.Layer.prototype.initialize.apply(this,[c,d]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.tile.destroy();this.tile=null}OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(b,f,a){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var e=(this.tile==null);if(f||e){this.setTileSize();var d=new OpenLayers.LonLat(this.extent.left,this.extent.top);var c=this.map.getLayerPxFromLonLat(d);if(e){this.tile=new OpenLayers.Tile.Image(this,c,this.extent,null,this.tileSize)}else{this.tile.size=this.tileSize.clone();this.tile.position=c.clone()}this.tile.draw()}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a)},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(c){if(c!=this.opacity){this.opacity=c;for(var b=0,a=this.markers.length;b<a;b++){this.markers[b].setOpacity(this.opacity)}}},moveTo:function(c,e,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(e||!this.drawn){for(var d=0,a=this.markers.length;d<a;d++){this.drawMarker(this.markers[d])}this.drawn=true}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a)}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);if((a.icon!=null)&&(a.icon.imageDiv!=null)&&(a.icon.imageDiv.parentNode==this.div)){this.div.removeChild(a.icon.imageDiv)}}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(c){var b=this.map.getLayerPxFromLonLat(c.lonlat);if(b==null){c.display(false)}else{if(!c.isDrawn()){var a=c.draw(b);this.div.appendChild(a)}else{if(c.icon){c.icon.moveTo(b)}}}},getDataExtent:function(){var d=null;if(this.markers&&(this.markers.length>0)){var d=new OpenLayers.Bounds();for(var b=0,a=this.markers.length;b<a;b++){var c=this.markers[b];d.extend(c.lonlat)}}return d},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;if(this.sphericalMercator){a=this.map.calculateBounds()}else{a=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return a},initMercatorParameters:function(){this.RESOLUTIONS=[];var a=156543.0339;for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=a/Math.pow(2,b)}this.units="m";this.projection="EPSG:900913"},forwardMercator:function(c,b){var a=c*20037508.34/180;var d=Math.log(Math.tan((90+b)*Math.PI/360))/(Math.PI/180);d=d*20037508.34/180;return new OpenLayers.LonLat(a,d)},inverseMercator:function(a,d){var c=(a/20037508.34)*180;var b=(d/20037508.34)*180;b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(c,b)},projectForward:function(b){var a=OpenLayers.Layer.SphericalMercator.forwardMercator(b.x,b.y);b.x=a.lon;b.y=a.lat;return b},projectInverse:function(b){var a=OpenLayers.Layer.SphericalMercator.inverseMercator(b.x,b.y);b.x=a.lon;b.y=a.lat;return b}};OpenLayers.Projection.addTransform("EPSG:4326","EPSG:900913",OpenLayers.Layer.SphericalMercator.projectForward);OpenLayers.Projection.addTransform("EPSG:900913","EPSG:4326",OpenLayers.Layer.SphericalMercator.projectInverse);OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],featureAdded:function(){},handlerOptions:null,initialize:function(b,c,a){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature},this.callbacks);this.layer=b;this.handler=new c(this,this.callbacks,this.handlerOptions)},drawFeature:function(b){var a=new OpenLayers.Feature.Vector(b);a.state=OpenLayers.State.INSERT;this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a})},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.measureComplete,point:this.measurePartial},this.callbacks);this.handler=new b(this,this.callbacks,this.handlerOptions)},updateHandler:function(b,a){var c=this.active;if(c){this.deactivate()}this.handler=new b(this,this.callbacks,a);if(c){this.activate()}},measureComplete:function(a){this.measure(a,"measure")},measurePartial:function(a,b){this.measure(b,"measurepartial")},measure:function(d,b){var c,a;if(d.CLASS_NAME.indexOf("LineString")>-1){c=this.getBestLength(d);a=1}else{c=this.getBestArea(d);a=2}this.events.triggerEvent(b,{measure:c[0],units:c[1],order:a,geometry:d})},getBestArea:function(f){var b=this.displaySystemUnits[this.displaySystem];var e,d;for(var c=0,a=b.length;c<a;++c){e=b[c];d=this.getArea(f,e);if(d>1){break}}return[d,e]},getArea:function(e,a){var b=e.getArea();var d=OpenLayers.INCHES_PER_UNIT[a];if(d){var c=OpenLayers.INCHES_PER_UNIT[this.map.getUnits()];b*=Math.pow((c/d),2)}return b},getBestLength:function(f){var c=this.displaySystemUnits[this.displaySystem];var e,b;for(var d=0,a=c.length;d<a;++d){e=c[d];b=this.getLength(f,e);if(b>1){break}}return[b,e]},getLength:function(e,b){var a=e.getLength();var d=OpenLayers.INCHES_PER_UNIT[b];if(d){var c=OpenLayers.INCHES_PER_UNIT[this.map.getUnits()];a*=(c/d)}return a},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:this,geometryTypes:null,layer:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(c,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=c;var a={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){a.over=this.overFeature;a.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(a,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,c,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},activate:function(){if(!this.active){this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(c){var a;for(var b=this.layer.selectedFeatures.length-1;b>=0;--b){a=this.layer.selectedFeatures[b];if(!c||c.except!=a){this.unselect(a)}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(this.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a)}else{if(!this.multipleSelect()){this.unselectAll({except:a})}}}else{if(!this.multipleSelect()){this.unselectAll({except:a})}this.select(a)}}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(a){if(this.hover&&(OpenLayers.Util.indexOf(this.layer.selectedFeatures,a)==-1)){this.select(a)}},outFeature:function(a){if(this.hover){this.unselect(a)}},select:function(c){var a=this.onBeforeSelect.call(this.scope,c);if(a!==false){a=this.layer.events.triggerEvent("beforefeatureselected",{feature:c});if(a!==false){this.layer.selectedFeatures.push(c);var b=this.selectStyle||this.renderIntent;this.layer.drawFeature(c,b);this.layer.events.triggerEvent("featureselected",{feature:c});this.onSelect.call(this.scope,c)}}},unselect:function(a){this.layer.drawFeature(a,"default");OpenLayers.Util.removeItem(this.layer.selectedFeatures,a);this.layer.events.triggerEvent("featureunselected",{feature:a});this.onUnselect.call(this.scope,a)},selectBox:function(b){if(b instanceof OpenLayers.Bounds){var g=this.map.getLonLatFromPixel(new OpenLayers.Pixel(b.left,b.bottom));var d=this.map.getLonLatFromPixel(new OpenLayers.Pixel(b.right,b.top));var c=new OpenLayers.Bounds(g.lon,g.lat,d.lon,d.lat);if(!this.multipleSelect()){this.unselectAll()}var h=this.multiple;this.multiple=true;for(var f=0,a=this.layer.features.length;f<a;++f){var e=this.layer.features[f];if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1){if(c.toGeometry().intersects(e.geometry)){if(OpenLayers.Util.indexOf(this.layer.selectedFeatures,e)==-1){this.select(e)}}}}this.multiple=h}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){if(!this.out){var g=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom));var l=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top));var i=new OpenLayers.Bounds(g.lon,g.lat,l.lon,l.lat)}else{var c=Math.abs(e.right-e.left);var m=Math.abs(e.top-e.bottom);var f=Math.min((this.map.size.h/m),(this.map.size.w/c));var j=this.map.getExtent();var h=this.map.getLonLatFromPixel(e.getCenterPixel());var a=h.lon-(j.getWidth()/2)*f;var d=h.lon+(j.getWidth()/2)*f;var k=h.lat-(j.getHeight()/2)*f;var b=h.lat+(j.getHeight()/2)*f;var i=new OpenLayers.Bounds(a,k,d,b)}this.map.zoomToExtent(i)}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(f){var b,e,h;var g=this.regExes.typeStr.exec(f);if(g){e=g[1].toLowerCase();h=g[2];if(this.parse[e]){b=this.parse[e].apply(this,[h])}if(this.internalProjection&&this.externalProjection){if(b&&b.CLASS_NAME=="OpenLayers.Feature.Vector"){b.geometry.transform(this.externalProjection,this.internalProjection)}else{if(b&&e!="geometrycollection"&&typeof b=="object"){for(var d=0,a=b.length;d<a;d++){var c=b[d];c.geometry.transform(this.externalProjection,this.internalProjection)}}}}}return b},write:function(g){var b,j,h,d,a;if(g.constructor==Array){b=g;a=true}else{b=[g];a=false}var e=[];if(a){e.push("GEOMETRYCOLLECTION(")}for(var c=0,f=b.length;c<f;++c){if(a&&c>0){e.push(",")}j=b[c].geometry;h=j.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[h]){return null}if(this.internalProjection&&this.externalProjection){j=j.clone();j.transform(this.internalProjection,this.externalProjection)}d=this.extract[h].apply(this,[j]);e.push(h.toUpperCase()+"("+d+")")}if(a){e.push(")")}return e.join("")},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push(this.extract.point.apply(this,[c.components[b]]))}return d.join(",")},linestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.point.apply(this,[b.components[c]]))}return d.join(",")},multilinestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push("("+this.extract.linestring.apply(this,[b.components[c]])+")")}return d.join(",")},polygon:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push("("+this.extract.linestring.apply(this,[b.components[c]])+")")}return d.join(",")},multipolygon:function(d){var c=[];for(var b=0,a=d.components.length;b<a;++b){c.push("("+this.extract.polygon.apply(this,[d.components[b]])+")")}return c.join(",")}},parse:{point:function(b){var a=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(e){var c=OpenLayers.String.trim(e).split(",");var b=[];for(var d=0,a=c.length;d<a;++d){b.push(this.parse.point.apply(this,[c[d]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(b))},linestring:function(e){var c=OpenLayers.String.trim(e).split(",");var b=[];for(var d=0,a=c.length;d<a;++d){b.push(this.parse.point.apply(this,[c[d]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b))},multilinestring:function(f){var d;var c=OpenLayers.String.trim(f).split(this.regExes.parenComma);var b=[];for(var e=0,a=c.length;e<a;++e){d=c[e].replace(this.regExes.trimParens,"$1");b.push(this.parse.linestring.apply(this,[d]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(b))},polygon:function(h){var d,b,f;var g=OpenLayers.String.trim(h).split(this.regExes.parenComma);var c=[];for(var e=0,a=g.length;e<a;++e){d=g[e].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[d]).geometry;f=new OpenLayers.Geometry.LinearRing(b.components);c.push(f)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(c))},multipolygon:function(f){var d;var c=OpenLayers.String.trim(f).split(this.regExes.doubleParenComma);var b=[];for(var e=0,a=c.length;e<a;++e){d=c[e].replace(this.regExes.trimParens,"$1");b.push(this.parse.polygon.apply(this,[d]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(b))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");var d=OpenLayers.String.trim(e).split("|");var b=[];for(var c=0,a=d.length;c<a;++c){b.push(OpenLayers.Format.WKT.prototype.read.apply(this,[d[c]]))}return b}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(b,a){b.options.maxScale=this.getChildValue(a)},read_sld_MaxScaleDenominator:function(b,a){b.options.minScale=this.getChildValue(a)},write_wmc_Layer:function(b){var c=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[b]);if(b.options.resolutions||b.options.scales||b.options.minResolution||b.options.maxScale){var d=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");d.appendChild(this.createTextNode(b.maxScale.toPrecision(10)));c.insertBefore(d,c.childNodes[3])}if(b.options.resolutions||b.options.scales||b.options.maxResolution||b.options.minScale){var a=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");a.appendChild(this.createTextNode(b.minScale.toPrecision(10)));c.insertBefore(a,c.childNodes[4])}return c},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(d){var a=d.bounds;var f=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(a.left,a.top));var b=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(a.right,a.bottom));if(b==null||f==null){d.display(false)}else{var e=new OpenLayers.Size(Math.max(1,b.x-f.x),Math.max(1,b.y-f.y));var c=d.draw(f,e);if(!d.drawn){this.div.appendChild(c);d.drawn=true}}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);if((a.div!=null)&&(a.div.parentNode==this.div)){this.div.removeChild(a.div)}},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(b,a,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[b,c]);this.location=a;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(a,c,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(k){var q=k.responseXML;if(!q||!q.documentElement){q=OpenLayers.Format.XML.prototype.read(k.responseText)}if(this.useFeedTitle){var a=null;try{a=q.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(j){a=q.getElementsByTagName("title")[0].firstChild.nodeValue}if(a){this.setName(a)}}var n={};OpenLayers.Util.extend(n,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){n.externalProjection=this.projection;n.internalProjection=this.map.getProjectionObject()}var s=new OpenLayers.Format.GeoRSS(n);var h=s.read(q);for(var d=0,g=h.length;d<g;d++){var c={};var m=h[d];if(!m.geometry){continue}var o=m.attributes.title?m.attributes.title:"Untitled";var r=m.attributes.description?m.attributes.description:"No description.";var l=m.attributes.link?m.attributes.link:"";var p=m.geometry.getBounds().getCenterLonLat();c.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();c.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(o||r){c.title=o;c.description=r;var f='<div class="olLayerGeoRSSClose">[x]</div>';f+='<div class="olLayerGeoRSSTitle">';if(l){f+='<a class="link" href="'+l+'" target="_blank">'}f+=o;if(l){f+="</a>"}f+="</div>";f+='<div style="" class="olLayerGeoRSSDescription">';f+=r;f+="</div>";c.popupContentHTML=f}var m=new OpenLayers.Feature(this,p,c);this.features.push(m);var b=m.createMarker();b.events.register("click",m,this.markerClick);this.addMarker(b)}this.events.triggerEvent("loadend")},markerClick:function(c){var e=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!e)?this:null;for(var d=0,a=this.layer.map.popups.length;d<a;d++){this.layer.map.removePopup(this.layer.map.popups[d])}if(!e){var b=this.createPopup();OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var g=0,f=this.layer.map.popups.length;g<f;g++){this.layer.map.removePopup(this.layer.map.popups[g])}},this));this.layer.map.addPopup(b)}OpenLayers.Event.stop(c)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257],type:null,sphericalMercator:false,dragObject:null,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);this.addContainerPxFunction();if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{this.mapObject=new GMap2(this.div);if(typeof this.mapObject.getDragObject=="function"){this.dragObject=this.mapObject.getDragObject()}else{this.dragPanMapObject=null}var a=this.div.lastChild;this.div.removeChild(a);this.pane.appendChild(a);a.className="olLayerGooglePoweredBy gmnoprint";a.style.left="";a.style.bottom="";var b=this.div.lastChild;this.div.removeChild(b);this.pane.appendChild(b);b.className="olLayerGoogleCopyright";b.style.right="";b.style.bottom=""}catch(c){OpenLayers.Console.error(c)}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);if(this.type!=null){this.map.events.register("moveend",this,this.setMapType)}},setMapType:function(){if(this.mapObject.getCenter()!=null){if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)==-1){this.mapObject.addMapType(this.type)}this.mapObject.setMapType(this.type);this.map.events.unregister("moveend",this,this.setMapType)}},onMapResize:function(){if(this.visibility){this.mapObject.checkResize()}else{this.windowResized=true}},display:function(a){OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments);if(this.div.style.display=="block"&&this.windowResized){this.mapObject.checkResize();this.windowResized=false}},getOLBoundsFromMapObjectBounds:function(c){var b=null;if(c!=null){var a=c.getSouthWest();var d=c.getNorthEast();if(this.sphericalMercator){a=this.forwardMercator(a.lng(),a.lat());d=this.forwardMercator(d.lng(),d.lat())}else{a=new OpenLayers.LonLat(a.lng(),a.lat());d=new OpenLayers.LonLat(d.lng(),d.lat())}b=new OpenLayers.Bounds(a.lon,a.lat,d.lon,d.lat)}return b},getMapObjectBoundsFromOLBounds:function(b){var c=null;if(b!=null){var a=this.sphericalMercator?this.inverseMercator(b.bottom,b.left):new OpenLayers.LonLat(b.bottom,b.left);var d=this.sphericalMercator?this.inverseMercator(b.top,b.right):new OpenLayers.LonLat(b.top,b.right);c=new GLatLngBounds(new GLatLng(a.lat,a.lon),new GLatLng(d.lat,d.lon))}return c},addContainerPxFunction:function(){if((typeof GMap2!="undefined")&&!GMap2.prototype.fromLatLngToContainerPixel){GMap2.prototype.fromLatLngToContainerPixel=function(b){var a=this.fromLatLngToDivPixel(b);var c=this.getContainer().firstChild.firstChild;a.x+=c.offsetLeft;a.y+=c.offsetTop;return a}}},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},setMapObjectCenter:function(b,a){this.mapObject.setCenter(b,a)},dragPanMapObject:function(b,a){this.dragObject.moveBy(new GSize(-b,a))},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(b){var a=this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat();return a},getMapObjectLonLatFromLonLat:function(d,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(d,b);c=new GLatLng(a.lat,a.lon)}else{c=new GLatLng(b,d)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(b,a,d,c){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var f=0,b=this.grid.length;f<b;f++){var e=this.grid[f];for(var c=0,a=e.length;c<a;c++){var d=e[c];this.removeTileMonitoringHooks(d);d.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(c,e,a){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);c=c||this.map.getExtent();if(c!=null){var b=!this.grid.length||e;var d=this.getTilesBounds();if(this.singleTile){if(b||(!a&&!d.containsBounds(c))){this.initSingleTile(c)}}else{if(b||!d.containsBounds(c,true)){this.initGriddedTiles(c)}else{this.moveGriddedTiles(c)}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize().clone();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var a=null;if(this.grid.length){var e=this.grid.length-1;var d=this.grid[e][0];var b=this.grid[0].length-1;var c=this.grid[0][b];a=new OpenLayers.Bounds(d.bounds.left,d.bounds.bottom,c.bounds.right,c.bounds.top)}return a},initSingleTile:function(a){var f=a.getCenterLonLat();var g=a.getWidth()*this.ratio;var d=a.getHeight()*this.ratio;var h=new OpenLayers.Bounds(f.lon-(g/2),f.lat-(d/2),f.lon+(g/2),f.lat+(d/2));var c=new OpenLayers.LonLat(h.left,h.top);var b=this.map.getLayerPxFromLonLat(c);if(!this.grid.length){this.grid[0]=[]}var e=this.grid[0][0];if(!e){e=this.addTile(h,b);this.addTileMonitoringHooks(e);e.draw();this.grid[0][0]=e}else{e.moveTo(h,b)}this.removeExcessTiles(1,1)},calculateGridLayout:function(l,n,i){var b=i*this.tileSize.w;var j=i*this.tileSize.h;var d=l.left-n.left;var a=Math.floor(d/b)-this.buffer;var c=d/b-a;var g=-c*this.tileSize.w;var o=n.left+a*b;var k=l.top-(n.bottom+j);var e=Math.ceil(k/j)+this.buffer;var m=e-k/j;var h=-m*this.tileSize.h;var f=n.bottom+e*j;return{tilelon:b,tilelat:j,tileoffsetlon:o,tileoffsetlat:f,tileoffsetx:g,tileoffsety:h}},initGriddedTiles:function(f){var g=this.map.getSize();var u=Math.ceil(g.h/this.tileSize.h)+Math.max(1,2*this.buffer);var w=Math.ceil(g.w/this.tileSize.w)+Math.max(1,2*this.buffer);var a=this.maxExtent;var t=this.map.getResolution();var v=this.calculateGridLayout(f,a,t);var k=Math.round(v.tileoffsetx);var l=Math.round(v.tileoffsety);var d=v.tileoffsetlon;var c=v.tileoffsetlat;var j=v.tilelon;var e=v.tilelat;this.origin=new OpenLayers.Pixel(k,l);var q=k;var z=d;var r=0;var b=parseInt(this.map.layerContainerDiv.style.left);var s=parseInt(this.map.layerContainerDiv.style.top);do{var i=this.grid[r++];if(!i){i=[];this.grid.push(i)}d=z;k=q;var h=0;do{var n=new OpenLayers.Bounds(d,c,d+j,c+e);var o=k;o-=b;var m=l;m-=s;var p=new OpenLayers.Pixel(o,m);var A=i[h++];if(!A){A=this.addTile(n,p);this.addTileMonitoringHooks(A);i.push(A)}else{A.moveTo(n,p,false)}d+=j;k+=this.tileSize.w}while((d<=f.right+j*this.buffer)||h<w);c-=e;l+=this.tileSize.h}while((c>=f.bottom-e*this.buffer)||r<u);this.removeExcessTiles(r,h);this.spiralTileLoad()},spiralTileLoad:function(){var e=[];var h=["right","down","left","up"];var g=0;var a=-1;var k=OpenLayers.Util.indexOf(h,"right");var j=0;while(j<h.length){var l=g;var b=a;switch(h[k]){case"right":b++;break;case"down":l++;break;case"left":b--;break;case"up":l--;break}var f=null;if((l<this.grid.length)&&(l>=0)&&(b<this.grid[0].length)&&(b>=0)){f=this.grid[l][b]}if((f!=null)&&(!f.queued)){e.unshift(f);f.queued=true;j=0;g=l;a=b}else{k=(k+1)%4;j++}}for(var c=0,d=e.length;c<d;c++){var f=e[c];f.draw();f.queued=false}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(a){var c=this.buffer||1;while(true){var b=this.grid[0][0].position;var d=this.map.getViewPortPxFromLayerPx(b);if(d.x>-this.tileSize.w*(c-1)){this.shiftColumn(true)}else{if(d.x<-this.tileSize.w*c){this.shiftColumn(false)}else{if(d.y>-this.tileSize.h*(c-1)){this.shiftRow(true)}else{if(d.y<-this.tileSize.h*c){this.shiftRow(false)}else{break}}}}}},shiftRow:function(m){var a=(m)?0:(this.grid.length-1);var b=this.grid;var e=b[a];var g=this.map.getResolution();var d=(m)?-this.tileSize.h:this.tileSize.h;var c=g*-d;var n=(m)?b.pop():b.shift();for(var f=0,j=e.length;f<j;f++){var k=e[f];var l=k.bounds.clone();var h=k.position.clone();l.bottom=l.bottom+c;l.top=l.top+c;h.y=h.y+d;n[f].moveTo(l,h)}if(m){b.unshift(n)}else{b.push(n)}},shiftColumn:function(l){var b=(l)?-this.tileSize.w:this.tileSize.w;var d=this.map.getResolution();var k=d*b;for(var c=0,f=this.grid.length;c<f;c++){var m=this.grid[c];var a=(l)?0:(m.length-1);var h=m[a];var j=h.bounds.clone();var e=h.position.clone();j.left=j.left+k;j.right=j.right+k;e.x=e.x+b;var g=l?this.grid[c].pop():this.grid[c].shift();g.moveTo(j,e);if(l){m.unshift(g)}else{m.push(g)}}},removeExcessTiles:function(e,c){while(this.grid.length>e){var f=this.grid.pop();for(var b=0,a=f.length;b<a;b++){var d=f[b];this.removeTileMonitoringHooks(d);d.destroy()}}while(this.grid[0].length>c){for(var b=0,a=this.grid.length;b<a;b++){var f=this.grid[b];var d=f.pop();this.removeTileMonitoringHooks(d);d.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var g=this.maxExtent;var d=this.getResolution();var c=d*this.tileSize.w;var a=d*this.tileSize.h;var h=this.getLonLatFromViewPortPx(e);var f=g.left+(c*Math.floor((h.lon-g.left)/c));var b=g.bottom+(a*Math.floor((h.lat-g.bottom)/a));return new OpenLayers.Bounds(f,b,f+c,b+a)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.MultiMap=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[9,1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125],type:null,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters();this.RESOLUTIONS.unshift(10)}},loadMapObject:function(){try{this.mapObject=new MultimapViewer(this.div)}catch(a){}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"MM",layerLib:"MultiMap"})},setMapObjectCenter:function(b,a){this.mapObject.goToPosition(b,a)},getMapObjectCenter:function(){return this.mapObject.getCurrentPosition()},getMapObjectZoom:function(){return this.mapObject.getZoomFactor()},getMapObjectLonLatFromMapObjectPixel:function(a){a.x=a.x-(this.map.getSize().w/2);a.y=a.y-(this.map.getSize().h/2);return this.mapObject.getMapPositionAt(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.geoPosToContainerPixels(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lon:a.lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lat:a.lat},getMapObjectLonLatFromLonLat:function(d,c){var b;if(this.sphericalMercator){var a=this.inverseMercator(d,c);b=new MMLatLon(a.lat,a.lon)}else{b=new MMLatLon(c,d)}return b},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new MMPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.MultiMap"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=new Array()},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(b){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(a,c,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(j){var n=j.responseText;var l={};OpenLayers.Util.extend(l,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){l.externalProjection=this.projection;l.internalProjection=this.map.getProjectionObject()}var h=new OpenLayers.Format.Text(l);features=h.read(n);for(var c=0,f=features.length;c<f;c++){var d={};var k=features[c];var m;var a,e;m=new OpenLayers.LonLat(k.geometry.x,k.geometry.y);if(k.style.graphicWidth&&k.style.graphicHeight){a=new OpenLayers.Size(k.style.graphicWidth,k.style.graphicHeight)}if(k.style.graphicXOffset!==undefined&&k.style.graphicYOffset!==undefined){e=new OpenLayers.Pixel(k.style.graphicXOffset,k.style.graphicYOffset)}if(k.style.externalGraphic!=null){d.icon=new OpenLayers.Icon(k.style.externalGraphic,a,e)}else{d.icon=OpenLayers.Marker.defaultIcon();if(a!=null){d.icon.setSize(a)}}if((k.attributes.title!=null)&&(k.attributes.description!=null)){d.popupContentHTML="<h2>"+k.attributes.title+"</h2><p>"+k.attributes.description+"</p>"}d.overflow=k.attributes.overflow||"auto";var g=new OpenLayers.Feature(this,m,d);this.features.push(g);var b=g.createMarker();if((k.attributes.title!=null)&&(k.attributes.description!=null)){b.events.register("click",g,this.markerClick)}this.addMarker(b)}this.events.triggerEvent("loadend")},markerClick:function(b){var d=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!d)?this:null;for(var c=0,a=this.layer.map.popups.length;c<a;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!d){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(b)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062],type:null,sphericalMercator:false,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){var a=OpenLayers.Util.createDiv(this.name);var c=this.map.getSize();a.style.width=c.w+"px";a.style.height=c.h+"px";this.div.appendChild(a);try{this.mapObject=new VEMap(this.name)}catch(b){}if(this.mapObject!=null){try{this.mapObject.LoadMap(null,null,this.type,true);this.mapObject.AttachEvent("onmousedown",function(){return true})}catch(b){}this.mapObject.HideDashboard()}if(!this.mapObject||!this.mapObject.vemapcontrol||!this.mapObject.vemapcontrol.PanMap||(typeof this.mapObject.vemapcontrol.PanMap!="function")){this.dragPanMapObject=null}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(b,a){this.mapObject.SetCenterAndZoom(b,a)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(b,a){this.mapObject.vemapcontrol.PanMap(b,-a)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return(typeof VEPixel!="undefined")?this.mapObject.PixelToLatLong(a):this.mapObject.PixelToLatLong(a.x,a.y)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.LatLongToPixel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lon:a.Longitude},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lat:a.Latitude},getMapObjectLonLatFromLonLat:function(d,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(d,b);c=new VELatLong(a.lat,a.lon)}else{c=new VELatLong(b,d)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return(typeof VEPixel!="undefined")?new VEPixel(a,b):new Msn.VE.Pixel(a,b)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"});OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:15,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125],type:null,sphericalMercator:false,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,a);this.mapObject.disableKeyControls();this.mapObject.disableDragMap();if(!this.mapObject.moveByXY||(typeof this.mapObject.moveByXY!="function")){this.dragPanMapObject=null}}catch(b){}},onMapResize:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(a)}catch(b){}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var a=OpenLayers.Util.getElement("ygddfdiv");if(a!=null){if(a.parentNode!=null){a.parentNode.removeChild(a)}this.map.events.unregister("moveend",this,this.fixYahooEventPane)}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(b){var a=null;if(b!=null){a=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[b]);a=18-a}return a},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[a]);b=18-b}return b},setMapObjectCenter:function(b,a){this.mapObject.drawZoomAndCenter(b,a)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(b,a){this.mapObject.moveByXY({x:-b,y:a})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.convertXYLatLon(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.convertLatLonXY(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lon:a.Lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lat:a.Lat},getMapObjectLonLatFromLonLat:function(d,c){var b;if(this.sphericalMercator){var a=this.inverseMercator(d,c);b=new YGeoPoint(a.lat,a.lon)}else{b=new YGeoPoint(c,d)}return b},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new YCoordPoint(a,b)},getMapObjectSizeFromOLSize:function(a){return new YSize(a.w,a.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,initialize:function(a){this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments)},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},createCallback:function(c,b,a){return OpenLayers.Function.bind(function(){c.apply(this,[b,a])},this)},read:function(a){a=OpenLayers.Util.applyDefaults(a,this.options);var b=new OpenLayers.Protocol.Response({requestType:"read"});if(a.filter&&a.filter instanceof OpenLayers.Filter.Spatial){if(a.filter.type==OpenLayers.Filter.Spatial.BBOX){a.params=OpenLayers.Util.extend(a.params,{bbox:a.filter.value.toArray()})}}b.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers});return b},handleRead:function(b,a){this.handleResponse(b,a)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)});return c},handleCreate:function(b,a){this.handleResponse(b,a)},update:function(b,c){var a=c.url||b.url||this.options.url;c=OpenLayers.Util.applyDefaults(c,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"update"});d.priv=OpenLayers.Request.PUT({url:a,callback:this.createCallback(this.handleUpdate,d,c),headers:c.headers,data:this.format.write(b)});return d},handleUpdate:function(b,a){this.handleResponse(b,a)},"delete":function(b,c){var a=c.url||b.url||this.options.url;c=OpenLayers.Util.applyDefaults(c,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"delete"});d.priv=OpenLayers.Request.DELETE({url:a,callback:this.createCallback(this.handleDelete,d,c),headers:c.headers});return d},handleDelete:function(b,a){this.handleResponse(b,a)},handleResponse:function(c,a){var b=c.priv;if(a.callback){if(b.status>=200&&b.status<300){if(c.requestType!="delete"){c.features=this.parseFeatures(b)}c.code=OpenLayers.Protocol.Response.SUCCESS}else{c.code=OpenLayers.Protocol.Response.FAILURE}a.callback.call(a.scope,c)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(g,l){l=OpenLayers.Util.applyDefaults(l,this.options);var c=[],a=0;var h={};h[OpenLayers.State.INSERT]=[];h[OpenLayers.State.UPDATE]=[];h[OpenLayers.State.DELETE]=[];var k,j;for(var d=0,f=g.length;d<f;++d){k=g[d];j=h[k.state];if(j){j.push(k)}}var b=(h[OpenLayers.State.INSERT].length>0?1:0)+h[OpenLayers.State.UPDATE].length+h[OpenLayers.State.DELETE].length;function m(i){a++;i.last=(a>=b);this.callUserCallback(i,l)}var e=h[OpenLayers.State.INSERT];if(e.length>0){c.push(this.create(e,OpenLayers.Util.applyDefaults({callback:m,scope:this},l.create||{})))}e=h[OpenLayers.State.UPDATE];for(var d=e.length-1;d>=0;--d){c.push(this.update(e[d],OpenLayers.Util.applyDefaults({callback:m,scope:this},l.update||{})))}e=h[OpenLayers.State.DELETE];for(var d=e.length-1;d>=0;--d){c.push(this["delete"](e[d],OpenLayers.Util.applyDefaults({callback:m,scope:this},l["delete"]||{})))}return c},abort:function(a){if(a){a.priv.abort()}},callUserCallback:function(c,b){var a=b[c.requestType];if(a&&a.callback){a.callback.call(a.scope,c)}if(c.last&&b.callback){b.callback.call(b.scope)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Style=OpenLayers.Class({name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,propertyStyles:null,initialize:function(b,a){this.rules=[];this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"]);OpenLayers.Util.extend(this,a)},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(g){var b=this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),g);var j=this.rules;var h,c;var d=[];var a=false;for(var e=0,f=j.length;e<f;e++){h=j[e];var k=h.evaluate(g);if(k){if(h instanceof OpenLayers.Rule&&h.elseFilter){d.push(h)}else{a=true;this.applySymbolizer(h,b,g)}}}if(a==false&&d.length>0){a=true;for(var e=0,f=d.length;e<f;e++){this.applySymbolizer(d[e],b,g)}}if(j.length>0&&a==false){b.display="none"}else{b.display=""}return b},applySymbolizer:function(e,d,b){var a=b.geometry?this.getSymbolizerPrefix(b.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var c=e.symbolizer[a]||e.symbolizer;return this.createLiterals(OpenLayers.Util.extend(d,c),b)},createLiterals:function(d,a){var c=this.context||a.attributes||a.data;for(var b in this.propertyStyles){d[b]=OpenLayers.Style.createLiteral(d[b],c,a)}return d},findPropertyStyles:function(){var b={};var f=this.defaultStyle;this.addPropertyStyles(b,f);var h=this.rules;var e,g;for(var d=0,a=h.length;d<a;d++){var e=h[d].symbolizer;for(var c in e){g=e[c];if(typeof g=="object"){this.addPropertyStyles(b,g)}else{this.addPropertyStyles(b,e);break}}}return b},addPropertyStyles:function(b,d){var a;for(var c in d){a=d[c];if(typeof a=="string"&&a.match(/\$\{\w+\}/)){b[c]=true}}return b},addRules:function(a){this.rules=this.rules.concat(a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(d){var b=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var c=0,a=b.length;c<a;c++){if(d.CLASS_NAME.indexOf(b[c])!=-1){return b[c]}}},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(c,b,a){if(typeof c=="string"&&c.indexOf("${")!=-1){c=OpenLayers.String.format(c,b,[a]);c=(isNaN(c)||!c)?c:parseFloat(c)}return c};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text"];OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,mode:null,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(c,b){this.layer=c;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer());this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);if(!(this.deleteCodes instanceof Array)){this.deleteCodes=[this.deleteCodes]}var f=this;var d={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.selectControl=new OpenLayers.Control.SelectFeature(c,d);var a={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(h,g){f.dragStart.apply(f,[h,g])},onDrag:function(g){f.dragVertex.apply(f,[g])},onComplete:function(g){f.dragComplete.apply(f,[g])}};this.dragControl=new OpenLayers.Control.DragFeature(c,a);var e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e)}},destroy:function(){this.layer=null;this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.selectControl.activate()&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var a=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();if(this.feature&&this.feature.geometry){this.selectControl.unselect.apply(this.selectControl,[this.feature])}this.selectControl.deactivate();this.handlers.keyboard.deactivate();a=true}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){this.feature=a;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a})},dragStart:function(b,a){if(b!=this.feature&&!b.geometry.parent&&b!=this.dragHandle&&b!=this.radiusHandle){if(this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)!=-1){this.selectControl.clickFeature.apply(this.selectControl,[b]);this.dragControl.overFeature.apply(this.dragControl,[b]);this.dragControl.lastPixel=a;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=a;this.dragControl.handlers.drag.last=a}}},dragVertex:function(a){if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=a){this.feature=a}}else{if(a._index){a.geometry.parent.addComponent(a.geometry,a._index);delete a._index;OpenLayers.Util.removeItem(this.virtualVertices,a);this.vertices.push(a)}else{if(a==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.selectControl.renderIntent)}this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if((this.mode&OpenLayers.Control.ModifyFeature.RESHAPE)){this.collectVertices()}}},handleKeypress:function(b){var c=b.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,c)!=-1){var a=this.dragControl.feature;if(a&&OpenLayers.Util.indexOf(this.vertices,a)!=-1&&!this.dragControl.handlers.drag.dragging&&a.geometry.parent){a.geometry.parent.removeComponent(a.geometry);this.layer.drawFeature(this.feature,this.selectControl.renderIntent);this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var a=this;function b(j){var d,c,n,e;if(j.CLASS_NAME=="OpenLayers.Geometry.Point"){c=new OpenLayers.Feature.Vector(j);a.vertices.push(c)}else{var f=j.components.length;if(j.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){f-=1}for(d=0;d<f;++d){n=j.components[d];if(n.CLASS_NAME=="OpenLayers.Geometry.Point"){c=new OpenLayers.Feature.Vector(n);a.vertices.push(c)}else{b(n)}}if(j.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(d=0,e=j.components.length;d<e-1;++d){var m=j.components[d];var h=j.components[d+1];if(m.CLASS_NAME=="OpenLayers.Geometry.Point"&&h.CLASS_NAME=="OpenLayers.Geometry.Point"){var k=(m.x+h.x)/2;var g=(m.y+h.y)/2;var l=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,g),null,a.virtualStyle);l.geometry.parent=j;l._index=d+1;a.virtualVertices.push(l)}}}}}b.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var d=this.feature.geometry;var c=d.getBounds().getCenterLonLat();var a=new OpenLayers.Geometry.Point(c.lon,c.lat);var b=new OpenLayers.Feature.Vector(a);a.move=function(e,f){OpenLayers.Geometry.Point.prototype.move.call(this,e,f);d.move(e,f)};this.dragHandle=b;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var h=this.feature.geometry;var a=h.getBounds();var g=a.getCenterLonLat();var b=new OpenLayers.Geometry.Point(g.lon,g.lat);var e=new OpenLayers.Geometry.Point(a.right,a.bottom);var f=new OpenLayers.Feature.Vector(e);var d=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);var c=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);e.move=function(q,p){OpenLayers.Geometry.Point.prototype.move.call(this,q,p);var r=this.x-b.x;var n=this.y-b.y;var s=r-q;var o=n-p;if(c){var j=Math.atan2(o,s);var i=Math.atan2(n,r);var l=i-j;l*=180/Math.PI;h.rotate(l,b)}if(d){var m=Math.sqrt((s*s)+(o*o));var k=Math.sqrt((r*r)+(n*n));h.resize(k/m,b)}};this.radiusHandle=f;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.selectControl.setMap(a);this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,zoomBox:null,zoomWheelEnabled:true,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();this.zoomBox.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.div.oncontextmenu=function(){return false}}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown});this.activate()},defaultDblClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1)},defaultDblRightClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom-1)},wheelChange:function(h,e){var f=this.map.getZoom()+e;if(!this.map.isValidZoomLevel(f)){return}var i=this.map.getSize();var c=i.w/2-h.xy.x;var d=h.xy.y-i.h/2;var b=this.map.baseLayer.getResolutionForZoom(f);var a=this.map.getLonLatFromPixel(h.xy);var g=new OpenLayers.LonLat(a.lon+c*b,a.lat+d*b);this.map.setCenter(g,f)},wheelUp:function(a){this.wheelChange(a,1)},wheelDown:function(a){this.wheelChange(a,-1)},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return true},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry()},setBounds:function(a){if(a){this.bounds=a.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(a){var b=this.getBounds();if(!b){this.setBounds(a)}else{this.bounds.extend(a)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},atPoint:function(b,f,g){var e=false;var d=this.getBounds();if((d!=null)&&(b!=null)){var c=(f!=null)?f:0;var a=(g!=null)?g:0;var h=new OpenLayers.Bounds(this.bounds.left-c,this.bounds.bottom-a,this.bounds.right+c,this.bounds.top+a);e=h.containsLonLat(b)}return e},getLength:function(){return 0},getArea:function(){return 0},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.segmentsIntersect=function(r,q,n){var a=false;var o=r.x1-q.x1;var h=r.y1-q.y1;var m=r.x2-r.x1;var f=r.y2-r.y1;var p=q.y2-q.y1;var b=q.x2-q.x1;var j=(p*m)-(b*f);var i=(b*h)-(p*o);var g=(m*h)-(f*o);if(j==0){if(i==0&&g==0){a=true}}else{var c=i/j;var e=g/j;if(c>=0&&c<=1&&e>=0&&e<=1){if(!n){a=true}else{var l=r.x1+(c*m);var k=r.y1+(c*f);a=new OpenLayers.Geometry.Point(l,k)}}}return a};OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(b,a,e,c){var d=[];d.push(b,a,e,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(b){b=this.adjustBounds(b);var a=this.map.getResolution();var e=Math.round((this.map.getScale()*10000))/10000;var d=Math.round(b.left/a);var c=-Math.round(b.top/a);return this.getFullRequestString({t:c,l:d,s:e})},addTile:function(b,a){var c=this.getURL(b);return new OpenLayers.Tile.Image(this,a,b,c,this.tileSize)},calculateGridLayout:function(l,n,i){var b=i*this.tileSize.w;var j=i*this.tileSize.h;var d=l.left;var a=Math.floor(d/b)-this.buffer;var c=d/b-a;var g=-c*this.tileSize.w;var o=a*b;var k=l.top;var e=Math.ceil(k/j)+this.buffer;var m=e-k/j;var h=-(m+1)*this.tileSize.h;var f=e*j;return{tilelon:b,tilelat:j,tileoffsetlon:o,tileoffsetlat:f,tileoffsetx:g,tileoffsety:h}},clone:function(a){if(a==null){a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getTileBounds:function(e){var d=this.getResolution();var c=d*this.tileSize.w;var a=d*this.tileSize.h;var g=this.getLonLatFromViewPortPx(e);var f=c*Math.floor(g.lon/c);var b=a*Math.floor(g.lat/a);return new OpenLayers.Bounds(f,b,f+c,b+a)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,singleTile:false,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},defaultSize:new OpenLayers.Size(300,300),initialize:function(b,a,d,c){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(c==null||c.isBaseLayer==null){this.isBaseLayer=((this.transparent!="true")&&(this.transparent!=true))}if(this.singleTile){OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)}else{OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS);this.setTileSize(this.defaultSize)}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(h){var a;var i=h.getCenterLonLat();var e=this.map.getCurrentSize();if(this.singleTile){var d={};d.setdisplaydpi=OpenLayers.DOTS_PER_INCH;d.setdisplayheight=e.h*this.ratio;d.setdisplaywidth=e.w*this.ratio;d.setviewcenterx=i.lon;d.setviewcentery=i.lat;d.setviewscale=this.map.getScale();if(!this.isBaseLayer){this.params.operation="GETDYNAMICMAPOVERLAYIMAGE";var g={};g=OpenLayers.Util.extend(g,d);g.operation="GETVISIBLEMAPEXTENT";g.version="1.0.0";g.session=this.params.session;g.mapName=this.params.mapName;g.format="text/xml";a=this.getFullRequestString(g);OpenLayers.Request.GET({url:a,async:false})}a=this.getFullRequestString(d)}else{var b=this.map.getResolution();var c=Math.floor((h.left-this.maxExtent.left)/b);c=Math.round(c/this.tileSize.w);var f=Math.floor((this.maxExtent.top-h.top)/b);f=Math.round(f/this.tileSize.h);a=this.getFullRequestString({tilecol:c,tilerow:f,scaleindex:this.resolutions.length-this.map.zoom-1})}return a},getFullRequestString:function(d,e){var b=(e==null)?this.url:e;if(typeof b=="object"){b=b[Math.floor(Math.random()*b.length)]}var i=b;var c=OpenLayers.Util.extend({},this.params);c=OpenLayers.Util.extend(c,d);var g=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getArgs(b));for(var h in c){if(h.toUpperCase() in g){delete c[h]}}var a=OpenLayers.Util.getParameterString(c);a=a.replace(/,/g,"+");if(a!=""){var f=b.charAt(b.length-1);if((f=="&")||(f=="?")){i+=a}else{if(b.indexOf("?")==-1){i+="?"+a}else{i+="&"+a}}}return i},calculateGridLayout:function(l,n,i){var b=i*this.tileSize.w;var j=i*this.tileSize.h;var d=l.left-n.left;var a=Math.floor(d/b)-this.buffer;var c=d/b-a;var g=-c*this.tileSize.w;var o=n.left+a*b;var k=n.top-l.top+j;var e=Math.floor(k/j)-this.buffer;var m=e-k/j;var h=m*this.tileSize.h;var f=n.top-j*e;return{tilelon:b,tilelat:j,tileoffsetlon:o,tileoffsetlat:f,tileoffsetx:g,tileoffsety:h}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(b,a,e,c){var d=[];d.push(b,a,e,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(c==null||c.isBaseLayer==null){this.isBaseLayer=((this.params.transparent!="true")&&(this.params.transparent!=true))}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(b){b=this.adjustBounds(b);var c=[b.left,b.bottom,b.right,b.top];var a=this.getImageSize();var d=this.getFullRequestString({mapext:c,imgext:c,map_size:[a.w,a.h],imgx:a.w/2,imgy:a.h/2,imgxy:[a.w,a.h]});return d},getFullRequestString:function(d,e){var b=(e==null)?this.url:e;var c=OpenLayers.Util.extend({},this.params);c=OpenLayers.Util.extend(c,d);var a=OpenLayers.Util.getParameterString(c);if(b instanceof Array){b=this.selectUrl(a,b)}var g=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var h in c){if(h.toUpperCase() in g){delete c[h]}}a=OpenLayers.Util.getParameterString(c);var i=b;a=a.replace(/,/g,"+");if(a!=""){var f=b.charAt(b.length-1);if((f=="&")||(f=="?")){i+=a}else{if(b.indexOf("?")==-1){i+="?"+a}else{i+="&"+a}}}return i},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",isBaseLayer:true,tileOrigin:null,initialize:function(b,a,c){var d=[];d.push(b,a,{},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.TMS(this.name,this.url,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(b){b=this.adjustBounds(b);var d=this.map.getResolution();var a=Math.round((b.left-this.tileOrigin.lon)/(d*this.tileSize.w));var g=Math.round((b.bottom-this.tileOrigin.lat)/(d*this.tileSize.h));var f=this.map.getZoom();var e=this.serviceVersion+"/"+this.layername+"/"+f+"/"+a+"/"+g+"."+this.type;var c=this.url;if(c instanceof Array){c=this.selectUrl(e,c)}return c+e},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,tileOrigin:null,format:"image/png",initialize:function(c,b,a,d){this.layername=a;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,{},d]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(f){var e=this.map.getResolution();var g=this.maxExtent;var j=this.tileSize;var a=Math.round((f.left-g.left)/(e*j.w));var k=Math.round((f.bottom-g.bottom)/(e*j.h));var h=this.map.zoom;function d(m,l){m=String(m);var n=[];for(var o=0;o<l;++o){n.push("0")}return n.join("").substring(0,l-m.length)+m}var c=[this.layername,d(h,2),d(parseInt(a/1000000),3),d((parseInt(a/1000)%1000),3),d((parseInt(a)%1000),3),d(parseInt(k/1000000),3),d((parseInt(k/1000)%1000),3),d((parseInt(k)%1000),3)+"."+this.extension];var i=c.join("/");var b=this.url;if(b instanceof Array){b=this.selectUrl(i,b)}b=(b.charAt(b.length-1)=="/")?b:b+"/";return b+i},addTile:function(b,a){var c=this.getURL(b);return new OpenLayers.Tile.Image(this,a,b,c,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,initialize:function(b,a,e,c){var d=[];e=OpenLayers.Util.upperCaseObject(e);d.push(b,a,e,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((c==null)||(!c.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(c){c=this.adjustBounds(c);var a=this.getImageSize();var d={BBOX:this.encodeBBOX?c.toBBOX():c.toArray(),WIDTH:a.w,HEIGHT:a.h};var b=this.getFullRequestString(d);return b},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(c,a){var b=this.map.getProjection();this.params.SRS=(b=="none")?null:b;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(b,a,e,g,f,c){this.lzd=e;this.zoomLevels=g;var d=[];d.push(b,a,f,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getZoom:function(){var b=this.map.getZoom();var a=this.map.getMaxExtent();b=b-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);return b},getURL:function(b){b=this.adjustBounds(b);var e=this.getZoom();var c=this.map.getMaxExtent();var d=this.lzd/Math.pow(2,this.getZoom());var a=Math.floor((b.left-c.left)/d);var f=Math.floor((b.bottom-c.bottom)/d);if(this.map.getResolution()<=(this.lzd/512)&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:e,X:a,Y:f})}else{return OpenLayers.Util.getImagesLocation()+"blank.gif"}},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:true,typeOfFid:"string",db:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[a]);this.jsonParser=new OpenLayers.Format.JSON();this.wktParser=new OpenLayers.Format.WKT();this.fidRegExp=new RegExp("^"+this.FID_PREFIX);this.initializeDatabase()},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database");this.db.open(this.databaseName);this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,  state TEXT)")},destroy:function(){this.db.close();this.db=null;this.jsonParser=null;this.wktParser=null;OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return !!(window.google&&google.gears)},read:function(d){d=OpenLayers.Util.applyDefaults(d,this.options);var c,b=[];var a=this.db.execute("SELECT * FROM "+this.tableName);while(a.isValidRow()){c=this.unfreezeFeature(a);if(this.evaluateFilter(c,d.filter)){if(!d.noFeatureStateReset){c.state=null}b.push(c)}a.next()}a.close();var e=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:b});if(d&&d.callback){d.callback.call(d.scope,e)}return e},unfreezeFeature:function(d){var a;var b=d.fieldByName("geometry");if(b==this.NULL_GEOMETRY){a=new OpenLayers.Feature.Vector()}else{a=this.wktParser.read(b)}a.attributes=this.jsonParser.read(d.fieldByName("properties"));a.fid=this.extractFidFromField(d.fieldByName("fid"));var c=d.fieldByName("state");if(c==this.NULL_FEATURE_STATE){c=null}a.state=c;return a},extractFidFromField:function(a){if(!a.match(this.fidRegExp)&&this.typeOfFid=="number"){a=parseFloat(a)}return a},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=this.createOrUpdate(a);c.requestType="create";if(b&&b.callback){b.callback.call(b.scope,c)}return c},update:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=this.createOrUpdate(a);c.requestType="update";if(b&&b.callback){b.callback.call(b.scope,c)}return c},createOrUpdate:function(c){if(!(c instanceof Array)){c=[c]}var e,a=c.length,d;var b=new Array(a);for(e=0;e<a;e++){d=c[e];var f=this.freezeFeature(d);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state) VALUES (?, ?, ?, ?)",f);var g=d.clone();g.fid=this.extractFidFromField(f[0]);b[e]=g}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:b,reqFeatures:c})},freezeFeature:function(b){b.fid=b.fid!=null?""+b.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var d=b.geometry!=null?b.geometry.toString():this.NULL_GEOMETRY;var a=this.jsonParser.write(b.attributes);var c=this.getFeatureStateForFreeze(b);return[b.fid,d,a,c]},getFeatureStateForFreeze:function(a){var b;if(!this.saveFeatureState){b=this.NULL_FEATURE_STATE}else{if(this.createdOffline(a)){b=OpenLayers.State.INSERT}else{b=a.state}}return b},"delete":function(c,f){if(!(c instanceof Array)){c=[c]}f=OpenLayers.Util.applyDefaults(f,this.options);var e,a,d;for(e=0,a=c.length;e<a;e++){d=c[e];if(this.saveFeatureState&&!this.createdOffline(d)){var b=d.clone();b.fid=d.fid;if(b.geometry){b.geometry.destroy();b.geometry=null}b.state=d.state;this.createOrUpdate(b)}else{this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[d.fid])}}var g=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:c});if(f&&f.callback){f.callback.call(f.scope,g)}return g},createdOffline:function(a){return(typeof a.fid=="string"&&!!(a.fid.match(this.fidRegExp)))},commit:function(g,k){var b,e=[],c=0,a=0;function l(i){if(++a<c){i.last=false}this.callUserCallback(k,i)}var j,m=[],h=[],d=[];for(var f=g.length-1;f>=0;f--){j=g[f];switch(j.state){case OpenLayers.State.INSERT:m.push(j);break;case OpenLayers.State.UPDATE:h.push(j);break;case OpenLayers.State.DELETE:d.push(j);break}}if(m.length>0){c++;b=OpenLayers.Util.applyDefaults({callback:l,scope:this},k.create);e.push(this.create(m,b))}if(h.length>0){c++;b=OpenLayers.Util.applyDefaults({callback:l,scope:this},k.update);e.push(this.update(h,b))}if(d.length>0){c++;b=OpenLayers.Util.applyDefaults({callback:l,scope:this},k["delete"]);e.push(this["delete"](d,b))}return e},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(b,c){var a=b[c.requestType];if(a&&a.callback){a.callback.call(a.scope,c)}if(c.last&&b.callback){b.callback.call(b.scope)}},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"});OpenLayers.Rule=OpenLayers.Class({id:null,name:"default",title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.symbolizer={};OpenLayers.Util.extend(this,a)},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null}this.symbolizer=null},evaluate:function(a){var b=this.getContext(a);var c=true;if(this.minScaleDenominator||this.maxScaleDenominator){var d=a.layer.map.getScale()}if(this.minScaleDenominator){c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)}if(c&&this.maxScaleDenominator){c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)}if(c&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){c=this.filter.evaluate(a)}else{c=this.filter.evaluate(b)}}return c},getContext:function(a){var b=this.context;if(!b){b=a.attributes||a.data}if(typeof this.context=="function"){b=this.context(a)}return b},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(c,b){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary)};if(c instanceof OpenLayers.Style){this.styles["default"]=c;this.styles.select=c;this.styles.temporary=c}else{if(typeof c=="object"){for(var a in c){if(c[a] instanceof OpenLayers.Style){this.styles[a]=c[a]}else{if(typeof c[a]=="object"){this.styles[a]=new OpenLayers.Style(c[a])}else{this.styles["default"]=new OpenLayers.Style(c);this.styles.select=new OpenLayers.Style(c);this.styles.temporary=new OpenLayers.Style(c);break}}}}}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles){this.styles[a].destroy()}this.styles=null},createSymbolizer:function(c,a){if(!c){c=new OpenLayers.Feature.Vector()}if(!this.styles[a]){a="default"}c.renderIntent=a;var b={};if(this.extendDefault&&a!="default"){b=this.styles["default"].createSymbolizer(c)}return OpenLayers.Util.extend(b,this.styles[a].createSymbolizer(c))},addUniqueValueRules:function(c,a,e,b){var f=[];for(var d in e){f.push(new OpenLayers.Rule({symbolizer:e[d],context:b,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:a,value:d})}))}this.styles[c].addRules(f)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation(),new OpenLayers.Control.ZoomBox()])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(b){switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:case OpenLayers.Filter.Comparison.LESS_THAN:case OpenLayers.Filter.Comparison.GREATER_THAN:case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:return this.binaryCompare(b,this.property,this.value);case OpenLayers.Filter.Comparison.BETWEEN:var c=b[this.property]>=this.lowerBoundary;c=c&&b[this.property]<=this.upperBoundary;return c;case OpenLayers.Filter.Comparison.LIKE:var a=new RegExp(this.value,"gi");return a.test(b[this.property])}},value2regex:function(d,a,b){if(d=="."){var c="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(c);return null}d=d?d:"*";a=a?a:".";b=b?b:"!";this.value=this.value.replace(new RegExp("\\"+b+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+a,"g"),".");this.value=this.value.replace(new RegExp("\\"+d,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+d);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+a);return this.value},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(c,b){return b?c:"!."});a=a.replace(/(\\)?\\\*/g,function(c,b){return b?c:"!*"});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a},binaryCompare:function(b,a,c){switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:return b[a]==c;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:return b[a]!=c;case OpenLayers.Filter.Comparison.LESS_THAN:return b[a]<c;case OpenLayers.Filter.Comparison.GREATER_THAN:return b[a]>c;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:return b[a]<=c;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:return b[a]>=c}},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(b){for(var c=0,a=this.fids.length;c<a;c++){var d=b.fid||b.id;if(d==this.fids[c]){return true}}return false},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(c){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(c))}},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(b){var a=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(b.geometry){var c=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){c=this.value.toGeometry()}if(b.geometry.intersects(c)){a=true}}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"));break}return a},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a)}},destroy:function(){this.components.length=0;this.components=null},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var c=[];for(var b=0,a=this.components.length;b<a;b++){c.push(this.components[b].toShortString())}return c.join(",")},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var b=1,a=this.components.length;b<a;b++){this.extendBounds(this.components[b].getBounds())}}},addComponents:function(b){if(!(b instanceof Array)){b=[b]}for(var c=0,a=b.length;c<a;c++){this.addComponent(b[c])}},addComponent:function(d,c){var e=false;if(d){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,d.CLASS_NAME)>-1)){if(c!=null&&(c<this.components.length)){var a=this.components.slice(0,c);var b=this.components.slice(c,this.components.length);a.push(d);this.components=a.concat(b)}else{this.components.push(d)}d.parent=this;this.clearBounds();e=true}}return e},removeComponents:function(a){if(!(a instanceof Array)){a=[a]}for(var b=a.length-1;b>=0;--b){this.removeComponent(a[b])}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds()},getLength:function(){var b=0;for(var c=0,a=this.components.length;c<a;c++){b+=this.components[c].getLength()}return b},getArea:function(){var c=0;for(var b=0,a=this.components.length;b<a;b++){c+=this.components[b].getArea()}return c},move:function(b,d){for(var c=0,a=this.components.length;c<a;c++){this.components[c].move(b,d)}},rotate:function(d,c){for(var b=0,a=this.components.length;b<a;++b){this.components[b].rotate(d,c)}},resize:function(d,c,b){for(var a=0;a<this.components.length;++a){this.components[a].resize(d,c,b)}},equals:function(d){var c=true;if(!d||!d.CLASS_NAME||(this.CLASS_NAME!=d.CLASS_NAME)){c=false}else{if(!(d.components instanceof Array)||(d.components.length!=this.components.length)){c=false}else{for(var b=0,a=this.components.length;b<a;++b){if(!this.components[b].equals(d.components[b])){c=false;break}}}}return c},transform:function(b,c){if(b&&c){for(var e=0,a=this.components.length;e<a;e++){var d=this.components[e];d.transform(b,c)}this.bounds=null}return this},intersects:function(d){var b=false;for(var c=0,a=this.components.length;c<a;++c){b=d.intersects(this.components[c]);if(b){break}}return b},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(b){var d=0;if((this.x!=null)&&(this.y!=null)&&(b!=null)&&(b.x!=null)&&(b.y!=null)){var c=Math.pow(this.x-b.x,2);var a=Math.pow(this.y-b.y,2);d=Math.sqrt(c+a)}return d},equals:function(b){var a=false;if(b!=null){a=((this.x==b.x&&this.y==b.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(b.x)&&isNaN(b.y)))}return a},toShortString:function(){return(this.x+", "+this.y)},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds()},rotate:function(d,b){d*=Math.PI/180;var c=this.distanceTo(b);var a=d+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+(c*Math.cos(a));this.y=b.y+(c*Math.sin(a));this.clearBounds()},resize:function(c,b,a){a=(a==undefined)?1:a;this.x=b.x+(c*a*(this.x-b.x));this.y=b.y+(c*(this.y-b.y));this.clearBounds()},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b)}else{a=b.intersects(this)}return a},transform:function(a,b){if((a&&b)){OpenLayers.Projection.transform(this,a,b);this.bounds=null}return this},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(a,d,b,c){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=a;this.y=d;this.width=b;this.height=c},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var a=(2*this.width)+(2*this.height);return a},getArea:function(){var a=this.width*this.height;return a},CLASS_NAME:"OpenLayers.Geometry.Rectangle"});OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(b,a,d,c){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(g){g=this.adjustBounds(g);var e=this.map.getResolution();var f=Math.round((this.map.getScale()*10000))/10000;var d=Math.round(g.left/e);var b=-Math.round(g.top/e);var i=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var h=Math.floor(b/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var a=this.url;if(a instanceof Array){a=this.selectUrl(paramsString,a)}var c=[a,"/",this.params.map,"/",f,"/",this.params.g.replace(/\s/g,"_"),"/def/t",h,"/l",i,"/t",b,"l",d,".",this.extension];return c.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:true,initialize:function(b,a,e,c){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var d="The OpenLayers.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.MapServer class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(b,d){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var c=0,a=this.strategies.length;c<a;c++){this.strategies[c].setLayer(this)}}},destroy:function(){if(this.strategies){var c,b,a;for(b=0,a=this.strategies.length;b<a;b++){c=this.strategies[b];if(c.autoDestroy){c.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},refresh:function(a){if(this.inRange&&this.visibility){this.events.triggerEvent("refresh",a)}},assignRenderer:function(){for(var c=0,a=this.renderers.length;c<this.renderers.length;c++){var b=OpenLayers.Renderer[this.renderers[c]];if(b&&b.prototype.supported()){this.renderer=new b(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(c){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoActivate){d.activate()}}}},removeMap:function(c){if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoActivate){d.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(c,h,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var g=true;if(!b){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var d=this.map.getExtent();g=this.renderer.setExtent(d,h);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft}if(!h&&g){for(var f in this.unrenderedFeatures){var e=this.unrenderedFeatures[f];this.drawFeature(e)}}}if(!this.drawn||h||!g){this.drawn=true;var e;for(var f=0,a=this.features.length;f<a;f++){this.renderer.locked=(f!==(a-1));e=this.features[f];this.drawFeature(e)}}},addFeatures:function(e,h){if(!(e instanceof Array)){e=[e]}var j=!h||!h.silent;if(j){var a={features:e};var f=this.events.triggerEvent("beforefeaturesadded",a);if(f===false){return}e=a.features}for(var b=0,d=e.length;b<d;b++){if(b!=(e.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var g=e[b];if(this.geometryType&&!(g.geometry instanceof this.geometryType)){var c=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw c}this.features.push(g);g.layer=this;if(!g.style&&this.style){g.style=OpenLayers.Util.extend({},this.style)}if(j){if(this.events.triggerEvent("beforefeatureadded",{feature:g})===false){continue}this.preFeatureInsert(g)}this.drawFeature(g);if(j){this.events.triggerEvent("featureadded",{feature:g});this.onFeatureInsert(g)}}if(j){this.events.triggerEvent("featuresadded",{features:e})}},removeFeatures:function(a,e){if(!a||a.length===0){return}if(!(a instanceof Array)){a=[a]}var c=!e||!e.silent;for(var d=a.length-1;d>=0;d--){if(d!=0&&a[d-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var b=a[d];delete this.unrenderedFeatures[b.id];if(c){this.events.triggerEvent("beforefeatureremoved",{feature:b})}this.features=OpenLayers.Util.removeItem(this.features,b);b.layer=null;if(b.geometry){this.renderer.eraseGeometry(b.geometry)}if(OpenLayers.Util.indexOf(this.selectedFeatures,b)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,b)}if(c){this.events.triggerEvent("featureremoved",{feature:b})}}if(c){this.events.triggerEvent("featuresremoved",{features:a})}},destroyFeatures:function(a,c){var d=(a==undefined);if(d){a=this.features}if(a){this.removeFeatures(a,c);for(var b=a.length-1;b>=0;b--){a[b].destroy()}}},drawFeature:function(a,b){if(!this.drawn){return}if(typeof b!="object"){var c=typeof b=="string"?b:a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,c)}}if(!this.renderer.drawFeature(a,b)){this.unrenderedFeatures[a.id]=a}else{delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b)},getFeatureById:function(d){var b=null;for(var c=0,a=this.features.length;c<a;++c){if(this.features[c].id==d){b=this.features[c];break}}return b},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var c=null;if(this.features&&(this.features.length>0)){c=new OpenLayers.Bounds();for(var b=0,a=this.features.length;b<a;b++){c.extend(this.features[b].geometry.getBounds())}}return c},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:true,initialize:function(b,a,e,c){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var d="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.WMS.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(b,c){var a=(c&&c.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var d=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!d){throw"Can't find a Filter parser for version "+a}this.parser=new d(this.options)}return this.parser.write(b)},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var b=d.nodeType==9?d.documentElement:d;var a=this.version;if(!a){a=this.defaultVersion}if(!this.parser||this.parser.VERSION!=a){var e=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!e){throw"Can't find a Filter parser for version "+a}this.parser=new e(this.options)}var c=this.parser.read(d);return c},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(d,c){var b=(c&&c.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=b){var e=OpenLayers.Format.SLD["v"+b.replace(/\./g,"_")];if(!e){throw"Can't find a SLD parser for version "+b}this.parser=new e(this.options)}var a=this.parser.write(d);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var b=d.documentElement;var a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=a){var e=OpenLayers.Format.SLD["v"+a.replace(/\./g,"_")];if(!e){throw"Can't find a SLD parser for version "+a}this.parser=new e(this.options)}var c=this.parser.read(d);return c},CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(k){var a=k.split("\n");var b;var g=[];for(var t=0;t<(a.length-1);t++){var s=a[t].replace(/^\s*/,"").replace(/\s*$/,"");if(s.charAt(0)!="#"){if(!b){b=s.split("\t")}else{var l=s.split("\t");var d=new OpenLayers.Geometry.Point(0,0);var h={};var p={};var r,n,i,o;var j=false;for(var c=0;c<l.length;c++){if(l[c]){if(b[c]=="point"){var q=l[c].split(",");d.y=parseFloat(q[0]);d.x=parseFloat(q[1]);j=true}else{if(b[c]=="lat"){d.y=parseFloat(l[c]);j=true}else{if(b[c]=="lon"){d.x=parseFloat(l[c]);j=true}else{if(b[c]=="title"){h.title=l[c]}else{if(b[c]=="image"||b[c]=="icon"){p.externalGraphic=l[c]}else{if(b[c]=="iconSize"){var m=l[c].split(",");p.graphicWidth=parseFloat(m[0]);p.graphicHeight=parseFloat(m[1])}else{if(b[c]=="iconOffset"){var f=l[c].split(",");p.graphicXOffset=parseFloat(f[0]);p.graphicYOffset=parseFloat(f[1])}else{if(b[c]=="description"){h.description=l[c]}else{if(b[c]=="overflow"){h.overflow=l[c]}}}}}}}}}}}if(j){if(this.internalProjection&&this.externalProjection){d.transform(this.externalProjection,this.internalProjection)}var e=new OpenLayers.Feature.Vector(d,h,p);g.push(e)}}}}return g},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(c,a,b){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:function(){return true}},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(){this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}if(this.drawing){this.cancel()}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures()}this.point=null},finalize:function(a){var b=a?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(b,[this.geometryClone()]);if(a||!this.persist){this.destroyFeature()}},cancel:function(){this.finalize(true)},click:function(a){OpenLayers.Event.stop(a);return false},dblclick:function(a){OpenLayers.Event.stop(a);return false},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point.geometry;if(this.multi){a=new OpenLayers.Geometry.MultiPoint([a])}return a},geometryClone:function(){return this.getGeometry().clone()},mousedown:function(b){if(!this.checkModifiers(b)){return true}if(this.lastDown&&this.lastDown.equals(b.xy)){return true}if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature()}this.lastDown=b.xy;this.drawing=true;var a=this.map.getLonLatFromPixel(b.xy);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.point.geometry.clearBounds();this.drawFeature();return false},mousemove:function(b){if(this.drawing){var a=this.map.getLonLatFromPixel(b.xy);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.point.geometry.clearBounds();this.drawFeature()}return true},mouseup:function(a){if(this.drawing){this.finalize();return false}else{return true}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:false,format:null,formatOptions:null,initialize:function(b,a,c){var d=[];d.push(b,c);OpenLayers.Layer.Vector.prototype.initialize.apply(this,d);this.url=a},setVisibility:function(a,b){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},moveTo:function(a,c,b){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.events.triggerEvent("loadstart");this.loadGML()}},loadGML:function(){if(!this.loaded){OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this});this.loaded=true}},setUrl:function(a){this.url=a;this.destroyFeatures();this.loaded=false;this.events.triggerEvent("loadstart");this.loadGML()},requestSuccess:function(c){var d=c.responseXML;if(!d||!d.documentElement){d=c.responseText}var a={};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}var b=this.format?new this.format(a):new OpenLayers.Format.GML(a);this.addFeatures(b.read(d));this.events.triggerEvent("loadend")},requestFailure:function(a){OpenLayers.Console.userError(OpenLayers.i18n("errorLoadingGML",{url:this.url}));this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,initialize:function(a,b){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},addNodes:function(a){if(a.length<2){OpenLayers.Console.error("At least two point features have to be added to createa line from");return}var k=new Array(a.length-1);var h,f,g;for(var d=0,e=a.length;d<e;d++){h=a[d];g=h.geometry;if(!g){var b=h.lonlat;g=new OpenLayers.Geometry.Point(b.lon,b.lat)}else{if(g.CLASS_NAME!="OpenLayers.Geometry.Point"){OpenLayers.Console.error("Only features with point geometries are supported.");return}}if(d>0){var c=(this.dataFrom!=null)?(a[d+this.dataFrom].data||a[d+this.dataFrom].attributes):null;var j=new OpenLayers.Geometry.LineString([f,g]);k[d-1]=new OpenLayers.Feature.Vector(j,c)}f=g}this.addFeatures(k)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:false,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:true,encodeBBOX:false,extractAttributes:false,initialize:function(b,a,e,c){if(c==undefined){c={}}if(c.featureClass||!OpenLayers.Layer.Vector||!OpenLayers.Feature.Vector){this.vectorMode=false}OpenLayers.Util.extend(c,{reportError:false});var d=[];d.push(b,c);OpenLayers.Layer.Vector.prototype.initialize.apply(this,d);if(!this.renderer||!this.vectorMode){this.vectorMode=false;if(!c.featureClass){c.featureClass=OpenLayers.Feature.WFS}OpenLayers.Layer.Markers.prototype.initialize.apply(this,d)}if(this.params&&this.params.typename&&!this.options.typename){this.options.typename=this.params.typename}if(!this.options.geometry_column){this.options.geometry_column="the_geom"}this.params=OpenLayers.Util.applyDefaults(e,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.url=a},destroy:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments)}if(this.tile){this.tile.destroy()}this.tile=null;this.ratio=null;this.featureClass=null;this.format=null;if(this.formatObject&&this.formatObject.destroy){this.formatObject.destroy()}this.formatObject=null;this.formatOptions=null;this.vectorMode=null;this.encodeBBOX=null;this.extractAttributes=null},setMap:function(b){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var a={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.formatObject=this.format?new this.format(a):new OpenLayers.Format.GML(a)}else{OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)}},moveTo:function(g,i,l){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments)}if(l){return false}if(i){if(this.vectorMode){this.renderer.clear()}}if(this.options.minZoomLevel){OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError"));if(this.map.getZoom()<this.options.minZoomLevel){return null}}if(g==null){g=this.map.getExtent()}var m=(this.tile==null);var d=(!m&&!this.tile.bounds.containsBounds(g));if(i||m||(!l&&d)){var h=g.getCenterLonLat();var n=g.getWidth()*this.ratio;var c=g.getHeight()*this.ratio;var a=new OpenLayers.Bounds(h.lon-(n/2),h.lat-(c/2),h.lon+(n/2),h.lat+(c/2));var k=this.map.getSize();k.w=k.w*this.ratio;k.h=k.h*this.ratio;var f=new OpenLayers.LonLat(a.left,a.top);var j=this.map.getLayerPxFromLonLat(f);var b=this.getFullRequestString();var e={BBOX:this.encodeBBOX?a.toBBOX():a.toArray()};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){var o=a.clone();o.transform(this.map.getProjectionObject(),this.projection);e.BBOX=this.encodeBBOX?o.toBBOX():o.toArray()}b+="&"+OpenLayers.Util.getParameterString(e);if(!this.tile){this.tile=new OpenLayers.Tile.WFS(this,j,a,b,k);this.addTileMonitoringHooks(this.tile);this.tile.draw()}else{if(this.vectorMode){this.destroyFeatures();this.renderer.clear()}else{this.clearMarkers()}this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;this.tile=new OpenLayers.Tile.WFS(this,j,a,b,k);this.addTileMonitoringHooks(this.tile);this.tile.draw()}}},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("loadstart")}};a.events.register("loadstart",a,a.onLoadStart);a.onLoadEnd=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("tileloaded");this.layer.events.triggerEvent("loadend")}};a.events.register("loadend",a,a.onLoadEnd);a.events.register("unload",a,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:a})},onMapResize:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)}},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.options)}if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.clone.apply(this,[a])}else{a=OpenLayers.Layer.Markers.prototype.clone.apply(this,[a])}return a},getFullRequestString:function(c,a){var b=this.projection.getCode()||this.map.getProjection();this.params.SRS=(b=="none")?null:b;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var a={};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.writer=new OpenLayers.Format.WFS(a,this)}var b=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:b,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(c){var b=c.responseText;if(b.indexOf("SUCCESS")!=-1){this.commitReport(OpenLayers.i18n("commitSuccess",{response:b}));for(var a=0;a<this.features.length;a++){this.features[a].state=null}}else{if(b.indexOf("FAILED")!=-1||b.indexOf("Exception")!=-1){this.commitReport(OpenLayers.i18n("commitFailed",{response:b}))}}},commitFailure:function(a){},commitReport:function(a,b){OpenLayers.Console.userError(a)},refresh:function(){if(this.tile){if(this.vectorMode){this.renderer.clear();this.features.length=0}else{this.clearMarkers();this.markers.length=0}this.tile.draw()}},CLASS_NAME:"OpenLayers.Layer.WFS"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,ratio:2,response:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,scope:this});this.layer.events.un({refresh:this.update,scope:this})}return a},update:function(b){var a=this.layer.map.getExtent();if((b&&b.force)||this.invalidBounds(a)){this.calculateBounds(a);this.triggerRead()}},invalidBounds:function(a){if(!a){a=this.layer.map.getExtent()}return !this.bounds||!this.bounds.containsBounds(a)},calculateBounds:function(b){if(!b){b=this.layer.map.getExtent()}var d=b.getCenterLonLat();var a=b.getWidth()*this.ratio;var c=b.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(d.lon-(a/2),d.lat-(c/2),d.lon+(a/2),d.lat+(c/2))},triggerRead:function(){this.layer.protocol.abort(this.response);this.response=this.layer.protocol.read({filter:this.createFilter(),callback:this.merge,scope:this})},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})}return a},merge:function(b){this.layer.destroyFeatures();var a=b.features;if(a&&a.length>0){this.layer.addFeatures(a)}},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){var c={};var a=this.readers.ogc.Filter.apply(this,[b,c]);return c.filter},readers:{ogc:{Filter:function(b,a){var c={fids:[],filters:[]};this.readChildNodes(b,c);if(c.fids.length>0){a.filter=new OpenLayers.Filter.FeatureId({fids:c.fids})}else{if(c.filters.length>0){a.filter=c.filters[0]}}},FeatureId:function(a,b){var c=a.getAttribute("fid");if(c){b.fids.push(c)}},And:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(b,a);c.filters.push(a)},Or:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(b,a);c.filters.push(a)},Not:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsNotEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsBetween:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLike:function(d,e){var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(d,b);var f=d.getAttribute("wildCard");var c=d.getAttribute("singleChar");var a=d.getAttribute("escape");b.value2regex(f,c,a);e.filters.push(b)},Literal:function(a,b){b.value=this.getChildValue(a)},PropertyName:function(b,a){a.property=this.getChildValue(b)},LowerBoundary:function(b,a){a.lowerBoundary=this.readOgcExpression(b)},UpperBoundary:function(b,a){a.upperBoundary=this.readOgcExpression(b)}}},readOgcExpression:function(a){var c={};this.readChildNodes(a,c);var b=c.value;if(!b){b=this.getChildValue(a)}return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(a){var d=this.createElementNSPlus("ogc:Filter");var c=a.CLASS_NAME.split(".").pop();if(c=="FeatureId"){for(var b=0;b<a.fids.length;++b){this.writeNode(d,"FeatureId",a.fids[b])}}else{this.writeNode(d,this.getFilterType(a),a)}return d},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(b){var d=this.createElementNSPlus("ogc:And");var a;for(var c=0;c<b.filters.length;++c){a=b.filters[c];this.writeNode(d,this.getFilterType(a),a)}return d},Or:function(b){var d=this.createElementNSPlus("ogc:Or");var a;for(var c=0;c<b.filters.length;++c){a=b.filters[c];this.writeNode(d,this.getFilterType(a),a)}return d},Not:function(b){var c=this.createElementNSPlus("ogc:Not");var a=b.filters[0];this.writeNode(c,this.getFilterType(a),a);return c},PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.value);return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode(b,"PropertyName",a);this.writeNode(b,"LowerBoundary",a);this.writeNode(b,"UpperBoundary",a);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode(b,"PropertyName",a);this.writeNode(b,"Literal",a.regex2value());return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode(b,"Literal",a.lowerBoundary);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode(b,"Literal",a.upperBoundary);return b},BBOX:function(a){var c=this.createElementNSPlus("ogc:BBOX");this.writeNode(c,"PropertyName",a);var b=new OpenLayers.Format.GML();c.appendChild(b.buildGeometryNode(a.value));return c},DWITHIN:function(a){var c=this.createElementNSPlus("ogc:DWithin");this.writeNode(c,"PropertyName",a);var b=new OpenLayers.Format.GML();c.appendChild(b.buildGeometryNode(a.value));this.writeNode(c,"Distance",a);return c},INTERSECTS:function(a){var c=this.createElementNSPlus("ogc:Intersects");this.writeNode(c,"PropertyName",a);var b=new OpenLayers.Format.GML();c.appendChild(b.buildGeometryNode(a.value));return c},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})}}},getFilterType:function(b){var a=this.filterMap[b.type];if(!a){throw"Filter writing not supported for rule type: "+b.type}return a},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",INTERSECTS:"INTERSECTS"},getNamespacePrefix:function(c){var a=null;if(c==null){a=this.namespaces[this.defaultPrefix]}else{var b=false;for(a in this.namespaces){if(this.namespaces[a]==c){b=true;break}}if(!b){a=null}}return a},readChildNodes:function(e,g){var a=e.childNodes;var b,j,d,c,h;for(var f=0;f<a.length;++f){b=a[f];if(b.nodeType==1){c=this.getNamespacePrefix(b.namespaceURI);h=b.nodeName.split(":").pop();j=this.readers[c];if(j){d=j[h];if(d){d.apply(this,[b,g])}}}}},writeNode:function(b,c,f){var a,e;var d=c.indexOf(":");if(d>0){a=c.substring(0,d);e=c.substring(d+1)}else{a=this.getNamespacePrefix(b.namespaceURI);e=c}var g=this.writers[a][e].apply(this,[f]);b.appendChild(g);return g},createElementNSPlus:function(a,b){b=b||{};var e=a.indexOf(":");var d=b.uri||this.namespaces[b.prefix];if(!d){e=a.indexOf(":");d=this.namespaces[a.substring(0,e)]}if(!d){d=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(d,a);if(b.attributes){this.setAttributes(c,b.attributes)}if(b.value){c.appendChild(this.createTextNode(b.value))}return c},setAttributes:function(d,f){var e,g,b,c;for(var a in f){e=f[a].toString();c=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(d,c,a,e)}},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var b=0;if(this.components&&(this.components.length>1)){for(var c=1,a=this.components.length;c<a;c++){b+=this.components[c-1].distanceTo(this.components[c])}}return b},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.Filter.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){this.readers.ogc=OpenLayers.Format.Filter.v1.prototype.readers.ogc;this.writers.ogc=OpenLayers.Format.Filter.v1.prototype.writers.ogc;this.readOgcExpression=OpenLayers.Format.Filter.v1.prototype.readOgcExpression;this.getFilterType=OpenLayers.Format.Filter.v1.prototype.getFilterType;this.filterMap=OpenLayers.Format.Filter.v1.prototype.filterMap;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){var a={namedLayers:{}};this.readChildNodes(b,a);return a},readers:{sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(d,e){var c={userStyles:[],namedStyles:[]};this.readChildNodes(d,c);for(var b=0,a=c.userStyles.length;b<a;++b){c.userStyles[b].layerName=c.name}e.namedLayers[c.name]=c},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(c,a){var b=new OpenLayers.Style(this.defaultSymbolizer);this.readChildNodes(c,b);a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){var c={rules:[]};this.readChildNodes(b,c);a.rules=c.rules},Rule:function(a,c){var b=new OpenLayers.Rule();this.readChildNodes(a,b);c.rules.push(b)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=this.getChildValue(a)},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=this.getChildValue(a)},LineSymbolizer:function(b,c){var a=c.symbolizer.Line||{};this.readChildNodes(b,a);c.symbolizer.Line=a},PolygonSymbolizer:function(b,c){var a=c.symbolizer.Polygon||{};this.readChildNodes(b,a);c.symbolizer.Polygon=a},PointSymbolizer:function(b,c){var a=c.symbolizer.Point||{};this.readChildNodes(b,a);c.symbolizer.Point=a},Stroke:function(b,a){this.readChildNodes(b,a)},Fill:function(b,a){this.readChildNodes(b,a)},CssParameter:function(c,a){var b=c.getAttribute("name");var e=this.cssMap[b];if(e){var d=this.readOgcExpression(c);if(d){a[e]=d}}},Graphic:function(e,d){var h={};this.readChildNodes(e,h);var b=["strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var g,f;for(var c=0,a=b.length;c<a;++c){g=b[c];f=h[g];if(f!=undefined){d[g]=f}}if(h.opacity!=undefined){d.graphicOpacity=h.opacity}if(h.size!=undefined){d.pointRadius=h.size/2}if(h.href!=undefined){d.externalGraphic=h.href}if(h.rotation!=undefined){d.rotation=h.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,c){var a=this.getChildValue(b);if(a){c.opacity=a}},Size:function(b,c){var a=this.getChildValue(b);if(a){c.size=a}},Rotation:function(b,c){var a=this.getChildValue(b);if(a){c.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var d,c;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){d=b;break}}return d||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:{sld:{StyledLayerDescriptor:function(c){var a=this.createElementNSPlus("StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(c.name){this.writeNode(a,"Name",c.name)}if(c.title){this.writeNode(a,"Title",c.title)}if(c.description){this.writeNode(a,"Abstract",c.description)}for(var b in c.namedLayers){this.writeNode(a,"NamedLayer",c.namedLayers[b])}return a},Name:function(a){return this.createElementNSPlus("Name",{value:a})},Title:function(a){return this.createElementNSPlus("Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("Abstract",{value:a})},NamedLayer:function(c){var d=this.createElementNSPlus("NamedLayer");this.writeNode(d,"Name",c.name);if(c.namedStyles){for(var b=0,a=c.namedStyles.length;b<a;++b){this.writeNode(d,"NamedStyle",c.namedStyles[b])}}if(c.userStyles){for(var b=0,a=c.userStyles.length;b<a;++b){this.writeNode(d,"UserStyle",c.userStyles[b])}}return d},NamedStyle:function(a){var b=this.createElementNSPlus("NamedStyle");this.writeNode(b,"Name",a);return b},UserStyle:function(a){var b=this.createElementNSPlus("UserStyle");if(a.name){this.writeNode(b,"Name",a.name)}if(a.title){this.writeNode(b,"Title",a.title)}if(a.description){this.writeNode(b,"Abstract",a.description)}if(a.isDefault){this.writeNode(b,"IsDefault",a.isDefault)}this.writeNode(b,"FeatureTypeStyle",a);return b},IsDefault:function(a){return this.createElementNSPlus("IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(c){var d=this.createElementNSPlus("FeatureTypeStyle");for(var b=0,a=c.rules.length;b<a;++b){this.writeNode(d,"Rule",c.rules[b])}return d},Rule:function(g){var f=this.createElementNSPlus("Rule");if(g.name){this.writeNode(f,"Name",g.name)}if(g.title){this.writeNode(f,"Title",g.title)}if(g.description){this.writeNode(f,"Abstract",g.description)}if(g.elseFilter){this.writeNode(f,"ElseFilter")}else{if(g.filter){this.writeNode(f,"ogc:Filter",g.filter)}}if(g.minScaleDenominator!=undefined){this.writeNode(f,"MinScaleDenominator",g.minScaleDenominator)}if(g.maxScaleDenominator!=undefined){this.writeNode(f,"MaxScaleDenominator",g.maxScaleDenominator)}var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;var e,d;for(var b=0,a=c.length;b<a;++b){e=c[b];d=g.symbolizer[e];if(d){this.writeNode(f,e+"Symbolizer",d)}}return f},ElseFilter:function(){return this.createElementNSPlus("ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("LineSymbolizer");this.writeNode(b,"Stroke",a);return b},Stroke:function(a){var b=this.createElementNSPlus("Stroke");if(a.strokeColor!=undefined){this.writeNode(b,"CssParameter",{symbolizer:a,key:"strokeColor"})}if(a.strokeOpacity!=undefined){this.writeNode(b,"CssParameter",{symbolizer:a,key:"strokeOpacity"})}if(a.strokeWidth!=undefined){this.writeNode(b,"CssParameter",{symbolizer:a,key:"strokeWidth"})}return b},CssParameter:function(a){return this.createElementNSPlus("CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("TextSymbolizer");if(a.label!=null){this.writeNode(b,"Label",a.label)}if(a.fontFamily!=null||a.fontSize!=null){this.writeNode(b,"Font",a)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode(b,"Fill",a)}return b},Font:function(a){var b=this.createElementNSPlus("Font");if(a.fontFamily){this.writeNode(b,"CssParameter",{symbolizer:a,key:"fontFamily"})}if(a.fontSize){this.writeNode(b,"CssParameter",{symbolizer:a,key:"fontSize"})}return b},Label:function(b){var f=this.createElementNSPlus("Label");var g=b.split("${");f.appendChild(this.createTextNode(g[0]));var e,d;for(var c=1,a=g.length;c<a;c++){e=g[c];d=e.indexOf("}");if(d>0){this.writeNode(f,"ogc:PropertyName",{property:e.substring(0,d)});f.appendChild(this.createTextNode(e.substring(++d)))}else{f.appendChild(this.createTextNode("${"+e))}}return f},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("PolygonSymbolizer");this.writeNode(b,"Fill",a);this.writeNode(b,"Stroke",a);return b},Fill:function(a){var b=this.createElementNSPlus("Fill");if(a.fillColor){this.writeNode(b,"CssParameter",{symbolizer:a,key:"fillColor"})}if(a.fillOpacity!=null){this.writeNode(b,"CssParameter",{symbolizer:a,key:"fillOpacity"})}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("PointSymbolizer");this.writeNode(b,"Graphic",a);return b},Graphic:function(a){var b=this.createElementNSPlus("Graphic");if(a.externalGraphic!=undefined){this.writeNode(b,"ExternalGraphic",a)}else{if(a.graphicName){this.writeNode(b,"Mark",a)}}if(a.graphicOpacity!=undefined){this.writeNode(b,"Opacity",a.graphicOpacity)}if(a.pointRadius!=undefined){this.writeNode(b,"Size",a.pointRadius*2)}if(a.rotation!=undefined){this.writeNode(b,"Rotation",a.rotation)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("ExternalGraphic");this.writeNode(b,"OnlineResource",a.externalGraphic);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode(b,"Format",c);return b},Mark:function(a){var b=this.createElementNSPlus("Mark");this.writeNode(b,"WellKnownName",a.graphicName);this.writeNode(b,"Fill",a);this.writeNode(b,"Stroke",a);return b},WellKnownName:function(a){return this.createElementNSPlus("WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("Format",{value:a})}}},getNamespacePrefix:function(c){var a=null;if(c==null){a=this.namespaces[this.defaultPrefix]}else{var b=false;for(a in this.namespaces){if(this.namespaces[a]==c){b=true;break}}if(!b){a=null}}return a},readChildNodes:function(e,g){var a=e.childNodes;var b,k,d,c,j;for(var f=0,h=a.length;f<h;++f){b=a[f];if(b.nodeType==1){c=this.getNamespacePrefix(b.namespaceURI);j=b.nodeName.split(":").pop();k=this.readers[c];if(k){d=k[j];if(d){d.apply(this,[b,g])}}}}},writeNode:function(b,c,f){var a,e;var d=c.indexOf(":");if(d>0){a=c.substring(0,d);e=c.substring(d+1)}else{a=this.getNamespacePrefix(b.namespaceURI);e=c}var g=this.writers[a][e].apply(this,[f]);b.appendChild(g);return g},createElementNSPlus:function(a,b){b=b||{};var e=a.indexOf(":");var d=b.uri||this.namespaces[b.prefix];if(!d){e=a.indexOf(":");d=this.namespaces[a.substring(0,e)]}if(!d){d=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(d,a);if(b.attributes){this.setAttributes(c,b.attributes)}if(b.value!=null){c.appendChild(this.createTextNode(b.value))}return c},setAttributes:function(d,f){var e,g,b,c;for(var a in f){e=f[a].toString();c=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(d,c,a,e)}},CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(a){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}},intersects:function(n){var a=false;var l=n.CLASS_NAME;if(l=="OpenLayers.Geometry.LineString"||l=="OpenLayers.Geometry.LinearRing"||l=="OpenLayers.Geometry.Point"){var q=this.getSortedSegments();var o;if(l=="OpenLayers.Geometry.Point"){o=[{x1:n.x,y1:n.y,x2:n.x,y2:n.y}]}else{o=n.getSortedSegments()}var s,b,d,k,m,r,f,g;outer:for(var e=0,h=q.length;e<h;++e){s=q[e];b=s.x1;d=s.x2;k=s.y1;m=s.y2;inner:for(var c=0,p=o.length;c<p;++c){r=o[c];if(r.x1>d){break}if(r.x2<b){continue}f=r.y1;g=r.y2;if(Math.min(f,g)>Math.max(k,m)){continue}if(Math.max(f,g)<Math.min(k,m)){continue}if(OpenLayers.Geometry.segmentsIntersect(s,r)){a=true;break outer}}}}else{a=n.intersects(this)}return a},getSortedSegments:function(){var c=this.components.length-1;var a=new Array(c);for(var b=0;b<c;++b){point1=this.components[b];point2=this.components[b+1];if(point1.x<point2.x){a[b]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}}else{a[b]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}}}function d(f,e){return f.x1-e.x1}return a.sort(d)},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(z){if(typeof z=="string"){z=OpenLayers.Format.XML.prototype.read.apply(this,[z])}var c=[];if(this.extractTracks){var r=z.getElementsByTagName("trk");for(var s=0,t=r.length;s<t;s++){var m={};if(this.extractAttributes){m=this.parseAttributes(r[s])}var f=this.getElementsByTagNameNS(r[s],r[s].namespaceURI,"trkseg");for(var q=0,w=f.length;q<w;q++){var h=this.extractSegment(f[q],"trkpt");c.push(new OpenLayers.Feature.Vector(h,m))}}}if(this.extractRoutes){var e=z.getElementsByTagName("rte");for(var o=0,p=e.length;o<p;o++){var m={};if(this.extractAttributes){m=this.parseAttributes(e[o])}var v=this.extractSegment(e[o],"rtept");c.push(new OpenLayers.Feature.Vector(v,m))}}if(this.extractWaypoints){var a=z.getElementsByTagName("wpt");for(var n=0,t=a.length;n<t;n++){var m={};if(this.extractAttributes){m=this.parseAttributes(a[n])}var d=new OpenLayers.Geometry.Point(a[n].getAttribute("lon"),a[n].getAttribute("lat"));c.push(new OpenLayers.Feature.Vector(d,m))}}if(this.internalProjection&&this.externalProjection){for(var u=0,b=c.length;u<b;u++){c[u].geometry.transform(this.externalProjection,this.internalProjection)}}return c},extractSegment:function(e,f){var c=this.getElementsByTagNameNS(e,e.namespaceURI,f);var b=[];for(var d=0,a=c.length;d<a;d++){b.push(new OpenLayers.Geometry.Point(c[d].getAttribute("lon"),c[d].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(b)},parseAttributes:function(b){var a={};var d=b.firstChild;while(d){if(d.nodeType==1){var c=d.firstChild;if(c.nodeType==3||c.nodeType==4){name=(d.prefix)?d.nodeName.split(":")[1]:d.nodeName;if(name!="trkseg"&&name!="rtept"){a[name]=c.nodeValue}}}d=d.nextSibling}return a},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(a){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var c=false;var d=this.components.pop();if(b!=null||!a.equals(d)){c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var e=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]);return c},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}},move:function(b,d){for(var c=0,a=this.components.length;c<a-1;c++){this.components[c].move(b,d)}},rotate:function(d,c){for(var b=0,a=this.components.length;b<a-1;++b){this.components[b].rotate(d,c)}},resize:function(e,d,c){for(var b=0,a=this.components.length;b<a-1;++b){this.components[b].resize(e,d,c)}},transform:function(b,c){if(b&&c){for(var e=0,a=this.components.length;e<a-1;e++){var d=this.components[e];d.transform(b,c)}this.bounds=null}return this},getArea:function(){var g=0;if(this.components&&(this.components.length>2)){var f=0;for(var e=0,d=this.components.length;e<d-1;e++){var a=this.components[e];var h=this.components[e+1];f+=(a.x+h.x)*(h.y-a.y)}g=-f/2}return g},containsPoint:function(n){var m=OpenLayers.Number.limitSigDigs;var l=14;var k=m(n.x,l);var j=m(n.y,l);function s(w,t,v,i,u){return(((t-i)*w)+((i*v)-(t*u)))/(v-u)}var h=this.components.length-1;var f,e,r,d,q,b,c,a;var g=0;for(var p=0;p<h;++p){f=this.components[p];r=m(f.x,l);d=m(f.y,l);e=this.components[p+1];q=m(e.x,l);b=m(e.y,l);if(d==b){if(j==d){if(r<=q&&(k>=r&&k<=q)||r>=q&&(k<=r&&k>=q)){g=-1;break}}continue}c=m(s(j,r,d,q,b),l);if(c==k){if(d<b&&(j>=d&&j<=b)||d>b&&(j<=d&&j>=b)){g=-1;break}}if(c<=k){continue}if(r!=q&&(c<Math.min(r,q)||c>Math.max(r,q))){continue}if(d<b&&(j>=d&&j<b)||d>b&&(j<d&&j>=b)){++g}}var o=(g==-1)?1:!!(g&1);return o},intersects:function(d){var b=false;if(d.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(d)}else{if(d.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=d.intersects(this)}else{if(d.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[d])}else{for(var c=0,a=d.components.length;c<a;++c){b=d.components[c].intersects(this);if(b){break}}}}}return b},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(c,a,b){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(){this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString());this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null},destroyPoint:function(){if(this.point){this.layer.destroyFeatures([this.point])}},addPoint:function(){this.line.geometry.addComponent(this.point.geometry.clone(),this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()])},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(){var a=this.line.geometry.components.length-1;this.line.geometry.components[a].x=this.point.geometry.x;this.line.geometry.components[a].y=this.point.geometry.y;this.line.geometry.components[a].clearBounds()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.line.geometry;if(this.multi){a=new OpenLayers.Geometry.MultiLineString([a])}return a},mousedown:function(b){if(this.lastDown&&this.lastDown.equals(b.xy)){return false}if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature()}this.mouseDown=true;this.lastDown=b.xy;var a=this.control.map.getLonLatFromPixel(b.xy);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.point.geometry.clearBounds();if((this.lastUp==null)||!this.lastUp.equals(b.xy)){this.addPoint()}this.drawFeature();this.drawing=true;return false},mousemove:function(b){if(this.drawing){var a=this.map.getLonLatFromPixel(b.xy);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.point.geometry.clearBounds();if(this.mouseDown&&this.freehandMode(b)){this.addPoint()}else{this.modifyFeature()}this.drawFeature()}return true},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){if(this.persist){this.destroyPoint()}this.finalize()}else{if(this.lastUp==null){this.addPoint()}this.lastUp=a.xy}return false}return true},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);if(this.persist){this.destroyPoint()}this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var c=0;if(this.components&&(this.components.length>0)){c+=Math.abs(this.components[0].getArea());for(var b=1,a=this.components.length;b<a;b++){c-=Math.abs(this.components[b].getArea())}}return c},containsPoint:function(a){var e=this.components.length;var b=false;if(e>0){b=this.components[0].containsPoint(a);if(b!==1){if(b&&e>1){var d;for(var c=1;c<e;++c){d=this.components[c].containsPoint(a);if(d){if(d===1){b=1}else{b=false}break}}}}}return b},intersects:function(e){var b=false;var d,a;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(e)}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"||e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(d=0,a=this.components.length;d<a;++d){b=e.intersects(this.components[d]);if(b){break}}if(!b){for(d=0,a=e.components.length;d<a;++d){b=this.containsPoint(e.components[d]);if(b){break}}}}else{for(d=0,a=e.components.length;d<a;++d){b=this.intersects(e.components[d]);if(b){break}}}}if(!b&&e.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var c=this.components[0];for(d=0,a=c.components.length;d<a;++d){b=e.containsPoint(c.components[d]);if(b){break}}}return b},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(l,b,c,j){var d=Math.PI*((1/c)-(1/2));if(j){d+=(j/180)*Math.PI}var a,h,g;var k=[];for(var f=0;f<c;++f){a=d+(f*2*Math.PI/c);h=l.x+(b*Math.cos(a));g=l.y+(b*Math.sin(a));k.push(new OpenLayers.Geometry.Point(h,g))}var e=new OpenLayers.Geometry.LinearRing(k);return new OpenLayers.Geometry.Polygon([e])};OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},createGeometryFromItem:function(n){var j=this.getElementsByTagNameNS(n,this.georssns,"point");var f=this.getElementsByTagNameNS(n,this.geons,"lat");var a=this.getElementsByTagNameNS(n,this.geons,"long");var o=this.getElementsByTagNameNS(n,this.georssns,"line");var m=this.getElementsByTagNameNS(n,this.georssns,"polygon");var d=this.getElementsByTagNameNS(n,this.georssns,"where");if(j.length>0||(f.length>0&&a.length>0)){var k;if(j.length>0){k=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s+/);if(k.length!=2){k=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{k=[parseFloat(f[0].firstChild.nodeValue),parseFloat(a[0].firstChild.nodeValue)]}var h=new OpenLayers.Geometry.Point(parseFloat(k[1]),parseFloat(k[0]))}else{if(o.length>0){var l=OpenLayers.String.trim(this.concatChildValues(o[0])).split(/\s+/);var b=[];var j;for(var c=0,e=l.length;c<e;c+=2){j=new OpenLayers.Geometry.Point(parseFloat(l[c+1]),parseFloat(l[c]));b.push(j)}h=new OpenLayers.Geometry.LineString(b)}else{if(m.length>0){var l=OpenLayers.String.trim(this.concatChildValues(m[0])).split(/\s+/);var b=[];var j;for(var c=0,e=l.length;c<e;c+=2){j=new OpenLayers.Geometry.Point(parseFloat(l[c+1]),parseFloat(l[c]));b.push(j)}h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(b)])}else{if(d.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var g=this.gmlParser.parseFeature(d[0]);h=g.geometry}}}}if(h&&this.internalProjection&&this.externalProjection){h.transform(this.externalProjection,this.internalProjection)}return h},createFeatureFromItem:function(j){var g=this.createGeometryFromItem(j);var h=this.getChildValue(j,"*","title",this.featureTitle);var i=this.getChildValue(j,"*","description",this.getChildValue(j,"*","content",this.featureDescription));var f=this.getChildValue(j,"*","link");if(!f){try{f=this.getElementsByTagNameNS(j,"*","link")[0].getAttribute("href")}catch(c){f=null}}var a=this.getChildValue(j,"*","id",null);var b={title:h,description:i,link:f};var d=new OpenLayers.Feature.Vector(g,b);d.fid=a;return d},getChildValue:function(d,b,c,f){var e;var a=this.getElementsByTagNameNS(d,b,c);if(a&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue){e=a[0].firstChild.nodeValue}else{e=(f==undefined)?"":f}return e},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var c=null;c=this.getElementsByTagNameNS(e,"*","item");if(c.length==0){c=this.getElementsByTagNameNS(e,"*","entry")}var b=c.length;var a=new Array(b);for(var d=0;d<b;d++){a[d]=this.createFeatureFromItem(c[d])}return a},write:function(c){var b;if(c instanceof Array){b=this.createElementNS(this.rssns,"rss");for(var d=0,a=c.length;d<a;d++){b.appendChild(this.createFeatureXML(c[d]))}}else{b=this.createFeatureXML(c)}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(j){var c=this.buildGeometryNode(j.geometry);var i=this.createElementNS(this.rssns,"item");var d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(j.attributes.title?j.attributes.title:""));var a=this.createElementNS(this.rssns,"description");a.appendChild(this.createTextNode(j.attributes.description?j.attributes.description:""));i.appendChild(d);i.appendChild(a);if(j.attributes.link){var h=this.createElementNS(this.rssns,"link");h.appendChild(this.createTextNode(j.attributes.link));i.appendChild(h)}for(var g in j.attributes){if(g=="link"||g=="title"||g=="description"){continue}var f=this.createTextNode(j.attributes[g]);var e=g;if(g.search(":")!=-1){e=g.split(":")[1]}var b=this.createElementNS(this.featureNS,"feature:"+e);b.appendChild(f);i.appendChild(b)}i.appendChild(c);return i},buildGeometryNode:function(b){if(this.internalProjection&&this.externalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection)}var a;if(b.CLASS_NAME=="OpenLayers.Geometry.Polygon"){a=this.createElementNS(this.georssns,"georss:polygon");a.appendChild(this.buildCoordinatesNode(b.components[0]))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LineString"){a=this.createElementNS(this.georssns,"georss:line");a.appendChild(this.buildCoordinatesNode(b))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.createElementNS(this.georssns,"georss:point");a.appendChild(this.buildCoordinatesNode(b))}else{throw"Couldn't parse "+b.CLASS_NAME}}}return a},buildCoordinatesNode:function(f){var a=null;if(f.components){a=f.components}var e;if(a){var c=a.length;var d=new Array(c);for(var b=0;b<c;b++){d[b]=a[b].y+" "+a[b].x}e=d.join(" ")}else{e=f.y+" "+f.x}return this.createTextNode(e)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,extractStyles:false,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){this.features=[];this.styles={};this.fetched={};var a={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(b,a)},parseData:function(g,e){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var d=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var c=0,a=d.length;c<a;++c){var f=d[c];var b=this.getElementsByTagNameNS(g,"*",f);if(b.length==0){continue}switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(b,e);break;case"style":if(this.extractStyles){this.parseStyles(b,e)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(b,e)}break;case"placemark":this.parseFeatures(b,e);break}}return this.features},parseLinks:function(c,e){if(e.depth>=this.maxDepth){return false}var g=OpenLayers.Util.extend({},e);g.depth++;for(var d=0,a=c.length;d<a;d++){var b=this.parseProperty(c[d],"*","href");if(b&&!this.fetched[b]){this.fetched[b]=true;var f=this.fetchLink(b);if(f){this.parseData(f,g)}}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:false});if(b){return b.responseText}},parseStyles:function(b,d){for(var c=0,a=b.length;c<a;c++){var e=this.parseStyle(b[c]);if(e){styleName=(d.styleBaseUrl||"")+"#"+e.id;this.styles[styleName]=e}}},parseStyle:function(t){var H={};var F=["LineStyle","PolyStyle","IconStyle","BalloonStyle"];var R,f,j,n;for(var M=0,m=F.length;M<m;++M){R=F[M];styleTypeNode=this.getElementsByTagNameNS(t,"*",R)[0];if(!styleTypeNode){continue}switch(R.toLowerCase()){case"linestyle":var q=this.parseProperty(styleTypeNode,"*","color");if(q){var c=(q.toString()).match(this.regExes.kmlColor);var L=c[1];H.strokeOpacity=parseInt(L,16)/255;var Q=c[2];var O=c[3];var G=c[4];H.strokeColor="#"+G+O+Q}var a=this.parseProperty(styleTypeNode,"*","width");if(a){H.strokeWidth=a}case"polystyle":var q=this.parseProperty(styleTypeNode,"*","color");if(q){var c=(q.toString()).match(this.regExes.kmlColor);var L=c[1];H.fillOpacity=parseInt(L,16)/255;var Q=c[2];var O=c[3];var G=c[4];H.fillColor="#"+G+O+Q}var k=this.parseProperty(styleTypeNode,"*","fill");if(k=="0"){H.fillColor="none"}break;case"iconstyle":var u=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1);var a=32*u;var P=32*u;var J=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(J){var p=this.parseProperty(J,"*","href");if(p){var E=this.parseProperty(J,"*","w");var N=this.parseProperty(J,"*","h");var I="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(p,I)&&!E&&!N){E=64;N=64;u=u/2}E=E||N;N=N||E;if(E){a=parseInt(E)*u}if(N){P=parseInt(N)*u}var c=p.match(this.regExes.kmlIconPalette);if(c){var e=c[1];var o=c[2];var D=this.parseProperty(J,"*","x");var C=this.parseProperty(J,"*","y");var z=D?D/32:0;var v=C?(7-C/32):7;var s=v*8+z;p="http://maps.google.com/mapfiles/kml/pal"+e+"/icon"+s+o}H.graphicOpacity=1;H.externalGraphic=p}}var B=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];if(B){var D=parseFloat(B.getAttribute("x"));var C=parseFloat(B.getAttribute("y"));var l=B.getAttribute("xunits");if(l=="pixels"){H.graphicXOffset=-D*u}else{if(l=="insetPixels"){H.graphicXOffset=-a+(D*u)}else{if(l=="fraction"){H.graphicXOffset=-a*D}}}var K=B.getAttribute("yunits");if(K=="pixels"){H.graphicYOffset=-P+(C*u)+1}else{if(K=="insetPixels"){H.graphicYOffset=-(C*u)+1}else{if(K=="fraction"){H.graphicYOffset=-P*(1-C)+1}}}}H.graphicWidth=a;H.graphicHeight=P;break;case"balloonstyle":var d=OpenLayers.Util.getXmlNodeValue(styleTypeNode);if(d){H.balloonStyle=d.replace(this.regExes.straightBracket,"${$1}")}break;default:}}if(!H.strokeColor&&H.fillColor){H.strokeColor=H.fillColor}var A=t.getAttribute("id");if(A&&H){H.id=A}return H},parseStyleMaps:function(a,l){for(var g=0,h=a.length;g<h;g++){var d=a[g];var b=this.getElementsByTagNameNS(d,"*","Pair");var c=d.getAttribute("id");for(var f=0,n=b.length;f<n;f++){var e=b[f];var m=this.parseProperty(e,"*","key");var k=this.parseProperty(e,"*","styleUrl");if(k&&m=="normal"){this.styles[(l.styleBaseUrl||"")+"#"+c]=this.styles[(l.styleBaseUrl||"")+k]}if(k&&m=="highlight"){}}}},parseFeatures:function(a,h){var e=new Array(a.length);for(var b=0,d=a.length;b<d;b++){var f=a[b];var g=this.parseFeature.apply(this,[f]);if(g){if(this.extractStyles&&g.attributes&&g.attributes.styleUrl){g.style=this.getStyle(g.attributes.styleUrl)}if(this.extractStyles){var j=this.getElementsByTagNameNS(f,"*","Style")[0];if(j){var c=this.parseStyle(j);if(c){g.style=OpenLayers.Util.extend(g.style,c)}}}e[b]=g}else{throw"Bad Placemark: "+b}}this.features=this.features.concat(e)},parseFeature:function(b){var a=["MultiGeometry","Polygon","LineString","Point"];var j,d,l,h;for(var f=0,g=a.length;f<g;++f){j=a[f];this.internalns=b.namespaceURI?b.namespaceURI:this.kmlns;d=this.getElementsByTagNameNS(b,this.internalns,j);if(d.length>0){var h=this.parseGeometry[j.toLowerCase()];if(h){l=h.apply(this,[d[0]]);if(this.internalProjection&&this.externalProjection){l.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:j}))}break}}var e;if(this.extractAttributes){e=this.parseAttributes(b)}var k=new OpenLayers.Feature.Vector(l,e);var c=b.getAttribute("id")||b.getAttribute("name");if(c!=null){k.fid=c}return k},getStyle:function(a,c){var b=OpenLayers.Util.removeTail(a);var f=OpenLayers.Util.extend({},c);f.depth++;f.styleBaseUrl=b;if(!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&f.depth<=this.maxDepth&&!this.fetched[b]){var e=this.fetchLink(b);if(e){this.parseData(e,f)}}var d=this.styles[a];return d},parseGeometry:{point:function(e){var d=this.getElementsByTagNameNS(e,this.internalns,"coordinates");var b=[];if(d.length>0){var c=d[0].firstChild.nodeValue;c=c.replace(this.regExes.removeSpace,"");b=c.split(",")}var a=null;if(b.length>1){if(b.length==2){b[2]=null}a=new OpenLayers.Geometry.Point(b[0],b[1],b[2])}else{throw"Bad coordinate string: "+c}return a},linestring:function(c,e){var d=this.getElementsByTagNameNS(c,this.internalns,"coordinates");var l=null;if(d.length>0){var b=this.concatChildValues(d[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);var h=a.length;var j=new Array(h);var k,g;for(var f=0;f<h;++f){k=a[f].split(",");g=k.length;if(g>1){if(k.length==2){k[2]=null}j[f]=new OpenLayers.Geometry.Point(k[0],k[1],k[2])}else{throw"Bad LineString point coordinates: "+a[f]}}if(h){if(e){l=new OpenLayers.Geometry.LinearRing(j)}else{l=new OpenLayers.Geometry.LineString(j)}}else{throw"Bad LineString coordinates: "+b}}return l},polygon:function(f){var d=this.getElementsByTagNameNS(f,this.internalns,"LinearRing");var g=d.length;var b=new Array(g);if(g>0){var c;for(var e=0,a=d.length;e<a;++e){c=this.parseGeometry.linestring.apply(this,[d[e],true]);if(c){b[e]=c}else{throw"Bad LinearRing geometry: "+e}}}return new OpenLayers.Geometry.Polygon(b)},multigeometry:function(e){var h,g;var f=[];var c=e.childNodes;for(var b=0,a=c.length;b<a;++b){h=c[b];if(h.nodeType==1){var d=(h.prefix)?h.nodeName.split(":")[1]:h.nodeName;var g=this.parseGeometry[d.toLowerCase()];if(g){f.push(g.apply(this,[h]))}}}return new OpenLayers.Geometry.Collection(f)}},parseAttributes:function(d){var e={};var c,k,j;var b=d.childNodes;for(var f=0,g=b.length;f<g;++f){c=b[f];if(c.nodeType==1){k=c.childNodes;if(k.length==1||k.length==3){var j;switch(k.length){case 1:j=k[0];break;case 3:default:j=k[1];break}if(j.nodeType==3||j.nodeType==4){var a=(c.prefix)?c.nodeName.split(":")[1]:c.nodeName;var h=OpenLayers.Util.getXmlNodeValue(j);if(h){h=h.replace(this.regExes.trimSpace,"");e[a]=h}}}}}return e},parseProperty:function(c,d,b){var f;var a=this.getElementsByTagNameNS(c,d,b);try{f=OpenLayers.Util.getXmlNodeValue(a[0])}catch(g){f=null}return f},write:function(d){if(!(d instanceof Array)){d=[d]}var b=this.createElementNS(this.kmlns,"kml");var c=this.createFolderXML();for(var e=0,a=d.length;e<a;++e){c.appendChild(this.createPlacemarkXML(d[e]))}b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"name");var d=this.createTextNode(this.foldersName);e.appendChild(d);var b=this.createElementNS(this.kmlns,"description");var c=this.createTextNode(this.foldersDesc);b.appendChild(c);var a=this.createElementNS(this.kmlns,"Folder");a.appendChild(e);a.appendChild(b);return a},createPlacemarkXML:function(c){var g=this.createElementNS(this.kmlns,"name");var b=(c.attributes.name)?c.attributes.name:c.id;g.appendChild(this.createTextNode(b));var d=this.createElementNS(this.kmlns,"description");var f=(c.attributes.description)?c.attributes.description:this.placemarksDesc;d.appendChild(this.createTextNode(f));var a=this.createElementNS(this.kmlns,"Placemark");if(c.fid!=null){a.setAttribute("id",c.fid)}a.appendChild(g);a.appendChild(d);var e=this.buildGeometryNode(c.geometry);a.appendChild(e);return a},buildGeometryNode:function(e){if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var b=e.CLASS_NAME;var c=b.substring(b.lastIndexOf(".")+1);var a=this.buildGeometry[c.toLowerCase()];var d=null;if(a){d=a.apply(this,[e])}return d},buildGeometry:{point:function(b){var a=this.createElementNS(this.kmlns,"Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(b){var a=this.createElementNS(this.kmlns,"LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(b){var a=this.createElementNS(this.kmlns,"LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(h){var b=this.createElementNS(this.kmlns,"Polygon");var g=h.components;var f,c,e;for(var d=0,a=g.length;d<a;++d){e=(d==0)?"outerBoundaryIs":"innerBoundaryIs";f=this.createElementNS(this.kmlns,e);c=this.buildGeometry.linearring.apply(this,[g[d]]);f.appendChild(c);b.appendChild(f)}return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(d){var b=this.createElementNS(this.kmlns,"MultiGeometry");var e;for(var c=0,a=d.components.length;c<a;++c){e=this.buildGeometryNode.apply(this,[d.components[c]]);if(e){b.appendChild(e)}}return b}},buildCoordinatesNode:function(f){var d=this.createElementNS(this.kmlns,"coordinates");var j;var h=f.components;if(h){var g;var e=h.length;var a=new Array(e);for(var b=0;b<e;++b){g=h[b];a[b]=g.x+","+g.y}j=a.join(" ")}else{j=f.x+","+f.y}var c=this.createTextNode(j);d.appendChild(c);return d},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(b){var e={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};e=OpenLayers.Util.extend(e,b);var d={};for(var a=0;a<e.interestingTagsExclude.length;a++){d[e.interestingTagsExclude[a]]=true}e.interestingTagsExclude=d;var c={};for(var a=0;a<e.areaTags.length;a++){c[e.areaTags[a]]=true}e.areaTags=c;OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(o){if(typeof o=="string"){o=OpenLayers.Format.XML.prototype.read.apply(this,[o])}var a=this.getNodes(o);var p=this.getWays(o);var d=new Array(p.length);for(var g=0;g<p.length;g++){var m=new Array(p[g].nodes.length);var b=this.isWayArea(p[g])?1:0;for(var f=0;f<p[g].nodes.length;f++){var c=a[p[g].nodes[f]];var n=new OpenLayers.Geometry.Point(c.lon,c.lat);n.osm_id=parseInt(p[g].nodes[f]);m[f]=n;c.used=true}var l=null;if(b){l=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(m))}else{l=new OpenLayers.Geometry.LineString(m)}if(this.internalProjection&&this.externalProjection){l.transform(this.externalProjection,this.internalProjection)}var h=new OpenLayers.Feature.Vector(l,p[g].tags);h.osm_id=parseInt(p[g].id);h.fid="way."+h.osm_id;d[g]=h}for(var e in a){var c=a[e];if(!c.used||this.checkTags){var q=null;if(this.checkTags){var k=this.getTags(c.node,true);if(c.used&&!k[1]){continue}q=k[0]}else{q=this.getTags(c.node)}var h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),q);if(this.internalProjection&&this.externalProjection){h.geometry.transform(this.externalProjection,this.internalProjection)}h.osm_id=parseInt(e);h.fid="node."+h.osm_id;d.push(h)}c.node=null}return d},getNodes:function(e){var d=e.getElementsByTagName("node");var a={};for(var b=0;b<d.length;b++){var c=d[b];var f=c.getAttribute("id");a[f]={lat:c.getAttribute("lat"),lon:c.getAttribute("lon"),node:c}}return a},getWays:function(g){var f=g.getElementsByTagName("way");var h=[];for(var d=0;d<f.length;d++){var b=f[d];var c={id:b.getAttribute("id")};c.tags=this.getTags(b);var e=b.getElementsByTagName("nd");c.nodes=new Array(e.length);for(var a=0;a<e.length;a++){c.nodes[a]=e[a].getAttribute("ref")}h.push(c)}return h},getTags:function(f,e){var d=f.getElementsByTagName("tag");var b={};var g=false;for(var a=0;a<d.length;a++){var c=d[a].getAttribute("k");b[c]=d[a].getAttribute("v");if(e){if(!this.interestingTagsExclude[c]){g=true}}}return e?[b,g]:b},isWayArea:function(b){var a=false;var d=false;if(b.nodes[0]==b.nodes[b.nodes.length-1]){a=true}if(this.checkTags){for(var c in b.tags){if(this.areaTags[c]){d=true;break}}}return a&&(this.checkTags?d:true)},write:function(c){if(!(c instanceof Array)){c=[c]}this.osm_id=1;this.created_nodes={};var a=this.createElementNS(null,"osm");a.setAttribute("version","0.5");a.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var e=c.length-1;e>=0;e--){var b=this.createFeatureNodes(c[e]);for(var d=0;d<b.length;d++){a.appendChild(b[d])}}return OpenLayers.Format.XML.prototype.write.apply(this,[a])},createFeatureNodes:function(d){var c=[];var b=d.geometry.CLASS_NAME;var e=b.substring(b.lastIndexOf(".")+1);e=e.toLowerCase();var a=this.createXML[e];if(a){c=a.apply(this,[d])}return c},createXML:{point:function(a){var e=null;var c=a.geometry?a.geometry:a;var d=false;if(a.osm_id){e=a.osm_id;if(this.created_nodes[e]){d=true}}else{e=-this.osm_id;this.osm_id++}if(d){b=this.created_nodes[e]}else{var b=this.createElementNS(null,"node")}this.created_nodes[e]=b;b.setAttribute("id",e);b.setAttribute("lon",c.x);b.setAttribute("lat",c.y);if(a.attributes){this.serializeTags(a,b)}this.setState(a,b);return d?[]:[b]},linestring:function(d){var b=[];var h=d.geometry;if(d.osm_id){id=d.osm_id}else{id=-this.osm_id;this.osm_id++}var c=this.createElementNS(null,"way");c.setAttribute("id",id);for(var e=0;e<h.components.length;e++){var g=this.createXML.point.apply(this,[h.components[e]]);if(g.length){g=g[0];var f=g.getAttribute("id");b.push(g)}else{f=h.components[e].osm_id;g=this.created_nodes[f]}this.setState(d,g);var a=this.createElementNS(null,"nd");a.setAttribute("ref",f);c.appendChild(a)}this.serializeTags(d,c);b.push(c);return b},polygon:function(b){var a=OpenLayers.Util.extend({area:"yes"},b.attributes);var c=new OpenLayers.Feature.Vector(b.geometry.components[0],a);c.osm_id=b.osm_id;return this.createXML.linestring.apply(this,[c])}},serializeTags:function(b,d){for(var c in b.attributes){var a=this.createElementNS(null,"tag");a.setAttribute("k",c);a.setAttribute("v",b.attributes[c]);d.appendChild(a)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}if(c){b.setAttribute("action",c)}}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(c,a,b){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(){this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon());this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing());this.polygon.geometry.addComponent(this.line.geometry);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.polygon,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null},modifyFeature:function(){var a=this.line.geometry.components.length-2;this.line.geometry.components[a].x=this.point.geometry.x;this.line.geometry.components[a].y=this.point.geometry.y;this.line.geometry.components[a].clearBounds()},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.polygon.geometry;if(this.multi){a=new OpenLayers.Geometry.MultiPolygon([a])}return a},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);if(this.persist){this.destroyPoint()}this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b,a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation()]);var c=[new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var e=this.getElementsByTagNameNS(d.documentElement,this.gmlns,this.featureName);var a=[];for(var c=0;c<e.length;c++){var b=this.parseFeature(e[c]);if(b){a.push(b)}}return a},parseFeature:function(b){var a=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope","Box"];var j,d,l,g;for(var f=0;f<a.length;++f){j=a[f];d=this.getElementsByTagNameNS(b,this.gmlns,j);if(d.length>0){var g=this.parseGeometry[j.toLowerCase()];if(g){l=g.apply(this,[d[0]]);if(this.internalProjection&&this.externalProjection){l.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:j}))}break}}var e;if(this.extractAttributes){e=this.parseAttributes(b)}var k=new OpenLayers.Feature.Vector(l,e);k.gml={featureType:b.firstChild.nodeName.split(":")[1],featureNS:b.firstChild.namespaceURI,featureNSPrefix:b.firstChild.prefix};var h=b.firstChild;var c;while(h){if(h.nodeType==1){c=h.getAttribute("fid")||h.getAttribute("id");if(c){break}}h=h.nextSibling}k.fid=c;return k},parseGeometry:{point:function(e){var c,b;var a=[];var c=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(c.length>0){b=c[0].firstChild.nodeValue;b=b.replace(this.regExes.trimSpace,"");a=b.split(this.regExes.splitSpace)}if(a.length==0){c=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(c.length>0){b=c[0].firstChild.nodeValue;b=b.replace(this.regExes.removeSpace,"");a=b.split(",")}}if(a.length==0){c=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(c.length>0){var f=this.getElementsByTagNameNS(c[0],this.gmlns,"X");var d=this.getElementsByTagNameNS(c[0],this.gmlns,"Y");if(f.length>0&&d.length>0){a=[f[0].firstChild.nodeValue,d[0].firstChild.nodeValue]}}}if(a.length==2){a[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(a[0],a[1],a[2])}else{return new OpenLayers.Geometry.Point(a[1],a[0],a[2])}},multipoint:function(e){var c=this.getElementsByTagNameNS(e,this.gmlns,"Point");var b=[];if(c.length>0){var a;for(var d=0;d<c.length;++d){a=this.parseGeometry.point.apply(this,[c[d]]);if(a){b.push(a)}}}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(c,e){var d,b;var o=[];var n=[];d=this.getElementsByTagNameNS(c,this.gmlns,"posList");if(d.length>0){b=this.concatChildValues(d[0]);b=b.replace(this.regExes.trimSpace,"");o=b.split(this.regExes.splitSpace);var h=parseInt(d[0].getAttribute("dimension"));var f,m,l,k;for(var g=0;g<o.length/h;++g){f=g*h;m=o[f];l=o[f+1];k=(h==2)?null:o[f+2];if(this.xy){n.push(new OpenLayers.Geometry.Point(m,l,k))}else{n.push(new OpenLayers.Geometry.Point(l,m,k))}}}if(o.length==0){d=this.getElementsByTagNameNS(c,this.gmlns,"coordinates");if(d.length>0){b=this.concatChildValues(d[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);for(var g=0;g<a.length;++g){o=a[g].split(",");if(o.length==2){o[2]=null}if(this.xy){n.push(new OpenLayers.Geometry.Point(o[0],o[1],o[2]))}else{n.push(new OpenLayers.Geometry.Point(o[1],o[0],o[2]))}}}}var p=null;if(n.length!=0){if(e){p=new OpenLayers.Geometry.LinearRing(n)}else{p=new OpenLayers.Geometry.LineString(n)}}return p},multilinestring:function(e){var c=this.getElementsByTagNameNS(e,this.gmlns,"LineString");var b=[];if(c.length>0){var a;for(var d=0;d<c.length;++d){a=this.parseGeometry.linestring.apply(this,[c[d]]);if(a){b.push(a)}}}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(e){var c=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing");var a=[];if(c.length>0){var b;for(var d=0;d<c.length;++d){b=this.parseGeometry.linestring.apply(this,[c[d],true]);if(b){a.push(b)}}}return new OpenLayers.Geometry.Polygon(a)},multipolygon:function(e){var c=this.getElementsByTagNameNS(e,this.gmlns,"Polygon");var a=[];if(c.length>0){var b;for(var d=0;d<c.length;++d){b=this.parseGeometry.polygon.apply(this,[c[d]]);if(b){a.push(b)}}}return new OpenLayers.Geometry.MultiPolygon(a)},envelope:function(e){var d=[];var c;var b;var h=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(h.length>0){var j=[];if(h.length>0){c=h[0].firstChild.nodeValue;c=c.replace(this.regExes.trimSpace,"");j=c.split(this.regExes.splitSpace)}if(j.length==2){j[2]=null}if(this.xy){var g=new OpenLayers.Geometry.Point(j[0],j[1],j[2])}else{var g=new OpenLayers.Geometry.Point(j[1],j[0],j[2])}}var a=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(a.length>0){var j=[];if(a.length>0){c=a[0].firstChild.nodeValue;c=c.replace(this.regExes.trimSpace,"");j=c.split(this.regExes.splitSpace)}if(j.length==2){j[2]=null}if(this.xy){var i=new OpenLayers.Geometry.Point(j[0],j[1],j[2])}else{var i=new OpenLayers.Geometry.Point(j[1],j[0],j[2])}}if(g&&i){d.push(new OpenLayers.Geometry.Point(g.x,g.y));d.push(new OpenLayers.Geometry.Point(i.x,g.y));d.push(new OpenLayers.Geometry.Point(i.x,i.y));d.push(new OpenLayers.Geometry.Point(g.x,i.y));d.push(new OpenLayers.Geometry.Point(g.x,g.y));var f=new OpenLayers.Geometry.LinearRing(d);b=new OpenLayers.Geometry.Polygon([f])}return b}},parseAttributes:function(d){var e={};var g=d.firstChild;var b,f,c,k,j,a,h;while(g){if(g.nodeType==1){b=g.childNodes;for(f=0;f<b.length;++f){c=b[f];if(c.nodeType==1){k=c.childNodes;if(k.length==1){j=k[0];if(j.nodeType==3||j.nodeType==4){a=(c.prefix)?c.nodeName.split(":")[1]:c.nodeName;h=j.nodeValue.replace(this.regExes.trimSpace,"");e[a]=h}}}}break}g=g.nextSibling}return e},write:function(a){if(!(a instanceof Array)){a=[a]}var c=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var b=0;b<a.length;b++){c.appendChild(this.createFeatureXML(a[b]))}return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createFeatureXML:function(h){var j=h.geometry;var b=this.buildGeometryNode(j);var k=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);k.appendChild(b);var g=this.createElementNS(this.gmlns,"gml:"+this.featureName);var i=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var c=h.fid||h.id;i.setAttribute("fid",c);i.appendChild(k);for(var f in h.attributes){var e=this.createTextNode(h.attributes[f]);var d=f.substring(f.lastIndexOf(":")+1);var a=this.createElementNS(this.featureNS,this.featurePrefix+":"+d);a.appendChild(e);i.appendChild(a)}g.appendChild(i);return g},buildGeometryNode:function(d){if(this.externalProjection&&this.internalProjection){d=d.clone();d.transform(this.internalProjection,this.externalProjection)}var b=d.CLASS_NAME;var c=b.substring(b.lastIndexOf(".")+1);var a=this.buildGeometry[c.toLowerCase()];return a.apply(this,[d])},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(f){var d=this.createElementNS(this.gmlns,"gml:MultiPoint");var a=f.components;var c,e;for(var b=0;b<a.length;b++){c=this.createElementNS(this.gmlns,"gml:pointMember");e=this.buildGeometry.point.apply(this,[a[b]]);c.appendChild(e);d.appendChild(c)}return d},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(f){var d=this.createElementNS(this.gmlns,"gml:MultiLineString");var a=f.components;var b,e;for(var c=0;c<a.length;++c){b=this.createElementNS(this.gmlns,"gml:lineStringMember");e=this.buildGeometry.linestring.apply(this,[a[c]]);b.appendChild(e);d.appendChild(b)}return d},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(g){var e=this.createElementNS(this.gmlns,"gml:Polygon");var f=g.components;var d,a,c;for(var b=0;b<f.length;++b){c=(b==0)?"outerBoundaryIs":"innerBoundaryIs";d=this.createElementNS(this.gmlns,"gml:"+c);a=this.buildGeometry.linearring.apply(this,[f[b]]);d.appendChild(a);e.appendChild(d)}return e},multipolygon:function(f){var e=this.createElementNS(this.gmlns,"gml:MultiPolygon");var b=f.components;var a,c;for(var d=0;d<b.length;++d){a=this.createElementNS(this.gmlns,"gml:polygonMember");c=this.buildGeometry.polygon.apply(this,[b[d]]);a.appendChild(c);e.appendChild(a)}return e},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");b.appendChild(this.buildCoordinatesNode(a));return b}},buildCoordinatesNode:function(f){var d=this.createElementNS(this.gmlns,"gml:coordinates");d.setAttribute("decimal",".");d.setAttribute("cs",",");d.setAttribute("ts"," ");var e=[];if(f instanceof OpenLayers.Bounds){e.push(f.left+","+f.bottom);e.push(f.right+","+f.top)}else{var b=(f.components)?f.components:[f];for(var c=0;c<b.length;c++){e.push(b[c].x+","+b[c].y)}}var a=this.createTextNode(e.join(" "));d.appendChild(a);return d},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a])},read:function(j,g,f){g=(g)?g:"FeatureCollection";var c=null;var d=null;if(typeof j=="string"){d=OpenLayers.Format.JSON.prototype.read.apply(this,[j,f])}else{d=j}if(!d){OpenLayers.Console.error("Bad JSON: "+j)}else{if(typeof(d.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+j)}else{if(this.isValidType(d,g)){switch(g){case"Geometry":try{c=this.parseGeometry(d)}catch(a){OpenLayers.Console.error(a)}break;case"Feature":try{c=this.parseFeature(d);c.type="Feature"}catch(a){OpenLayers.Console.error(a)}break;case"FeatureCollection":c=[];switch(d.type){case"Feature":try{c.push(this.parseFeature(d))}catch(a){c=null;OpenLayers.Console.error(a)}break;case"FeatureCollection":for(var b=0,e=d.features.length;b<e;++b){try{c.push(this.parseFeature(d.features[b]))}catch(a){c=null;OpenLayers.Console.error(a)}}break;default:try{var h=this.parseGeometry(d);c.push(new OpenLayers.Feature.Vector(h))}catch(a){c=null;OpenLayers.Console.error(a)}}break}}}}return c},isValidType:function(c,a){var b=false;switch(a){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],c.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+c.type)}else{b=true}break;case"FeatureCollection":b=true;break;default:if(c.type==a){b=true}else{OpenLayers.Console.error("Cannot convert types from "+c.type+" to "+a)}}return b},parseFeature:function(d){var b,f,a,e;a=(d.properties)?d.properties:{};e=(d.geometry&&d.geometry.bbox)||d.bbox;try{f=this.parseGeometry(d.geometry)}catch(c){throw c}b=new OpenLayers.Feature.Vector(f,a);if(e){b.bounds=OpenLayers.Bounds.fromArray(e)}if(d.id){b.fid=d.id}return b},parseGeometry:function(e){if(e==null){return null}var f;if(e.type=="GeometryCollection"){if(!(e.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+e}var b=e.geometries.length;var a=new Array(b);for(var c=0;c<b;++c){a[c]=this.parseGeometry.apply(this,[e.geometries[c]])}f=new OpenLayers.Geometry.Collection(a)}else{if(!(e.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+e}if(!this.parseCoords[e.type.toLowerCase()]){throw"Unsupported geometry type: "+e.type}try{f=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(d){throw d}}if(this.internalProjection&&this.externalProjection){f.transform(this.externalProjection,this.internalProjection)}return f},parseCoords:{point:function(a){if(a.length!=2){throw"Only 2D points are supported: "+a}return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(f){var b=[];var e=null;for(var c=0,a=f.length;c<a;++c){try{e=this.parseCoords.point.apply(this,[f[c]])}catch(d){throw d}b.push(e)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(f){var b=[];var e=null;for(var c=0,a=f.length;c<a;++c){try{e=this.parseCoords.point.apply(this,[f[c]])}catch(d){throw d}b.push(e)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(f){var c=[];var b=null;for(var d=0,a=f.length;d<a;++d){try{b=this.parseCoords.linestring.apply(this,[f[d]])}catch(e){throw e}c.push(b)}return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(g){var f=[];var e,b;for(var c=0,a=g.length;c<a;++c){try{b=this.parseCoords.linestring.apply(this,[g[c]])}catch(d){throw d}e=new OpenLayers.Geometry.LinearRing(b.components);f.push(e)}return new OpenLayers.Geometry.Polygon(f)},multipolygon:function(f){var b=[];var e=null;for(var c=0,a=f.length;c<a;++c){try{e=this.parseCoords.polygon.apply(this,[f[c]])}catch(d){throw d}b.push(e)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(e,a){var d={type:null};if(e instanceof Array){d.type="FeatureCollection";var g=e.length;d.features=new Array(g);for(var c=0;c<g;++c){var b=e[c];if(!b instanceof OpenLayers.Feature.Vector){var f="FeatureCollection only supports collections of features: "+b;throw f}d.features[c]=this.extract.feature.apply(this,[b])}}else{if(e.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){d=this.extract.geometry.apply(this,[e])}else{if(e instanceof OpenLayers.Feature.Vector){d=this.extract.feature.apply(this,[e]);if(e.layer&&e.layer.projection){d.crs=this.createCRSObject(e)}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[d,a])},createCRSObject:function(b){var c=b.layer.projection.toString();var a={};if(c.match(/epsg:/i)){var d=parseInt(c.substring(c.indexOf(":")+1));if(d==4326){a={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{a={type:"EPSG",properties:{code:d}}}}return a},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]);return{type:"Feature",id:a.fid==null?a.id:a.fid,properties:a.attributes,geometry:b}},geometry:function(d){if(d==null){return null}if(this.internalProjection&&this.externalProjection){d=d.clone();d.transform(this.internalProjection,this.externalProjection)}var c=d.CLASS_NAME.split(".")[2];var b=this.extract[c.toLowerCase()].apply(this,[d]);var a;if(c=="Collection"){a={type:"GeometryCollection",geometries:b}}else{a={type:c,coordinates:b}}return a},point:function(a){return[a.x,a.y]},multipoint:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push(this.extract.point.apply(this,[c.components[b]]))}return d},linestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.point.apply(this,[b.components[c]]))}return d},multilinestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.linestring.apply(this,[b.components[c]]))}return d},polygon:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.linestring.apply(this,[b.components[c]]))}return d},multipolygon:function(d){var c=[];for(var b=0,a=d.components.length;b<a;++b){c.push(this.extract.polygon.apply(this,[d.components[b]]))}return c},collection:function(c){var a=c.components.length;var d=new Array(a);for(var b=0;b<a;++b){d[b]=this.extract.geometry.apply(this,[c.components[b]])}return d}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setNamespace("feature",a.featureNS)},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var c=[];this.readNode(e,{features:c});if(c.length==0){var b=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(b.length){for(var d=0,a=b.length;d<a;++d){this.readNode(b[d],{features:c})}}else{var b=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");if(b.length){this.readNode(b[0],{features:c})}}}return c},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},Point:function(b,a){var c={points:[]};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(c.points[0])},coordinates:function(f,g){var h=this.concatChildValues(f).replace(this.regExes.trimSpace,"");h=h.replace(this.regExes.trimComma,",");var b=h.split(this.regExes.splitSpace);var a;var e=b.length;var c=new Array(e);for(var d=0;d<e;++d){a=b[d].split(",");if(this.xy){c[d]=new OpenLayers.Geometry.Point(a[0],a[1],a[2])}else{c[d]=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}}g.points=c},coord:function(a,b){var c={};this.readChildNodes(a,c);if(!b.points){b.points=[]}b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(b,a){var c={};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(b,a){var c={outer:null,inner:[]};this.readChildNodes(b,c);c.inner.unshift(c.outer);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(b,c){var a={};this.readChildNodes(b,a);c.components=[new OpenLayers.Geometry.LinearRing(a.points)]},MultiPolygon:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(c,d){var a;var b=c.localName||c.nodeName.split(":").pop();if(b==this.featureType){a="_typeName"}else{if(c.childNodes.length==1&&c.firstChild.nodeType==3){if(this.extractAttributes){a="_attribute"}}else{a="_geometry"}}if(a){this.readers.feature[a].apply(this,[c,d])}},_typeName:function(c,d){var b={components:[],attributes:{}};this.readChildNodes(c,b);var a=new OpenLayers.Feature.Vector(b.components[0],b.attributes);var e=c.getAttribute("fid")||this.getAttributeNS(c,this.namespaces.gml,"id");if(e){a.fid=e}if(this.internalProjection&&this.externalProjection&&a.geometry){a.geometry.transform(this.externalProjection,this.internalProjection)}d.features.push(a)},_geometry:function(a,b){this.readChildNodes(a,b)},_attribute:function(b,d){var a=b.localName||b.nodeName.split(":").pop();var c=this.getChildValue(b);d.attributes[a]=c}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(b){var c;if(b instanceof Array){c="featureMembers"}else{c="featureMember"}var a=this.writeNode("gml:"+c,b);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(c){var b=this.createElementNSPlus("gml:MultiPoint");for(var a=0;a<c.components.length;++a){this.writeNode("pointMember",c.components[a],b)}return b},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a},MultiLineString:function(c){var b=this.createElementNSPlus("gml:MultiLineString");for(var a=0;a<c.components.length;++a){this.writeNode("lineStringMember",c.components[a],b)}return b},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a},MultiPolygon:function(c){var b=this.createElementNSPlus("gml:MultiPolygon");for(var a=0;a<c.components.length;++a){this.writeNode("polygonMember",c.components[a],b)}return b},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a},GeometryCollection:function(d){var c=this.createElementNSPlus("gml:GeometryCollection");for(var b=0,a=d.components.length;b<a;++b){this.writeNode("geometryMember",d.components[b],c)}return c},geometryMember:function(b){var a=this.createElementNSPlus("gml:geometryMember");var c=this.writeNode("feature:_geometry",b);a.appendChild(c.firstChild);return a}},feature:{_typeName:function(b){var c=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:b.fid}});if(b.geometry){this.writeNode("feature:_geometry",b.geometry,c)}for(var a in b.attributes){var d=b.attributes[a];if(d!=null){this.writeNode("feature:_attribute",{name:a,value:d},c)}}return c},_geometry:function(c){if(this.externalProjection&&this.internalProjection){c=c.clone().transform(this.internalProjection,this.externalProjection)}var b=this.createElementNSPlus("feature:"+this.geometryName);var a=this.geometryTypes[c.CLASS_NAME];var d=this.writeNode("gml:"+a,c,b);if(this.srsName){d.setAttribute("srsName",this.srsName)}return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(b){var d=this.createElementNSPlus("wfs:FeatureCollection");for(var c=0,a=b.length;c<a;++c){this.writeNode("gml:featureMember",b[c],d)}return d}}},geometryTypes:{"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(b,a){OpenLayers.Format.GML.prototype.initialize.apply(this,[b]);this.layer=a;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(a){var c=this.createElementNS(this.wfsns,"wfs:Transaction");c.setAttribute("version","1.0.0");c.setAttribute("service","WFS");for(var b=0;b<a.length;b++){switch(a[b].state){case OpenLayers.State.INSERT:c.appendChild(this.insert(a[b]));break;case OpenLayers.State.UPDATE:c.appendChild(this.update(a[b]));break;case OpenLayers.State.DELETE:c.appendChild(this.remove(a[b]));break}}return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createFeatureXML:function(d){var g=this.buildGeometryNode(d.geometry);var b=this.createElementNS(this.featureNS,"feature:"+this.geometryName);b.appendChild(g);var f=this.createElementNS(this.featureNS,"feature:"+this.featureName);f.appendChild(b);for(var a in d.attributes){var h=this.createTextNode(d.attributes[a]);var c=a;if(a.search(":")!=-1){c=a.split(":")[1]}var e=this.createElementNS(this.featureNS,"feature:"+c);e.appendChild(h);f.appendChild(e)}return f},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");b.appendChild(this.createFeatureXML(a));return b},update:function(h){if(!h.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"))}var c=this.createElementNS(this.wfsns,"wfs:Update");c.setAttribute("typeName",this.layerName);var j=this.createElementNS(this.wfsns,"wfs:Property");var a=this.createElementNS(this.wfsns,"wfs:Name");var g=this.createTextNode(this.geometryName);a.appendChild(g);j.appendChild(a);var i=this.createElementNS(this.wfsns,"wfs:Value");var f=this.buildGeometryNode(h.geometry);if(h.layer){f.setAttribute("srsName",h.layer.projection.getCode())}i.appendChild(f);j.appendChild(i);c.appendChild(j);for(var e in h.attributes){j=this.createElementNS(this.wfsns,"wfs:Property");a=this.createElementNS(this.wfsns,"wfs:Name");a.appendChild(this.createTextNode(e));j.appendChild(a);i=this.createElementNS(this.wfsns,"wfs:Value");i.appendChild(this.createTextNode(h.attributes[e]));j.appendChild(i);c.appendChild(j)}var b=this.createElementNS(this.ogcns,"ogc:Filter");var d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",h.fid);b.appendChild(d);c.appendChild(b);return c},remove:function(b){if(!b.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"));return false}var c=this.createElementNS(this.wfsns,"wfs:Delete");c.setAttribute("typeName",this.layerName);var a=this.createElementNS(this.ogcns,"ogc:Filter");var d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",b.fid);a.appendChild(d);c.appendChild(a);return c},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},innerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},Box:function(d,c){var e={};this.readChildNodes(d,e);if(!c.components){c.components=[]}var b=e.points[0];var a=e.points[1];c.components.push(new OpenLayers.Bounds(b.x,b.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){var c;if(b instanceof Array){c="wfs:FeatureCollection"}else{c="gml:featureMember"}var a=this.writeNode(c,b);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a},coordinates:function(b){var d=b.length;var e=new Array(d);var a;for(var c=0;c<d;++c){a=b[c];if(this.xy){e[c]=a.x+","+a.y}else{e[c]=a.y+","+a.x}if(a.z!=undefined){e[c]+=","+a.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(d==1)?e[0]:e.join(" ")})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a},Polygon:function(c){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",c.components[0],b);for(var a=1;a<c.components.length;++a){this.writeNode("innerBoundaryIs",c.components[a],b)}return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(a){var b=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b);if(this.srsName){b.setAttribute("srsName",this.srsName)}return b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},pos:function(c,d){var e=this.getChildValue(c).replace(this.regExes.trimSpace,"");var b=e.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(b[0],b[1],b[2])}else{a=new OpenLayers.Geometry.Point(b[1],b[0],b[2])}d.points=[a]},posList:function(a,d){var h=this.concatChildValues(a).replace(this.regExes.trimSpace,"");var o=h.split(this.regExes.splitSpace);var e=parseInt(a.getAttribute("dimension"))||2;var b,m,l,g;var k=o.length/e;var n=new Array(k);for(var c=0,f=o.length;c<f;c+=e){m=o[c];l=o[c+1];g=(e==2)?undefined:o[c+2];if(this.xy){n[c/e]=new OpenLayers.Geometry.Point(m,l,g)}else{n[c/e]=new OpenLayers.Geometry.Point(l,m,g)}}d.points=n},exterior:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},interior:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},MultiSurface:function(b,a){var c={components:[]};this.readChildNodes(b,c);if(c.components.length>0){a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]}},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(d,c){var e={points:new Array(2)};this.readChildNodes(d,e);if(!c.components){c.components=[]}var b=e.points[0];var a=e.points[1];c.components.push(new OpenLayers.Bounds(b.x,b.y,a.x,a.y))},lowerCorner:function(b,a){var c={};this.readChildNodes(b,c);a.points[0]=c.points[0]},upperCorner:function(b,a){var c={};this.readChildNodes(b,c);a.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){var c;if(b instanceof Array){c="featureMembers"}else{c="featureMember"}var a=this.writeNode("gml:"+c,b);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(b){var d=this.createElementNSPlus("gml:featureMembers");for(var c=0,a=b.length;c<a;++c){this.writeNode("feature:_typeName",b[c],d)}return d},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a},posList:function(c){var b=c.length;var e=new Array(b);var a;for(var d=0;d<b;++d){a=c[d];if(this.xy){e[d]=a.x+" "+a.y}else{e[d]=a.y+" "+a.x}}return this.createElementNSPlus("gml:posList",{value:e.join(" ")})},Polygon:function(d){var c=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",d.components[0],c);for(var b=1,a=d.components.length;b<a;++b){this.writeNode("interior",d.components[b],c)}return c},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",a,b);this.writeNode("upperCorner",a,b);if(this.srsName){b.setAttribute("srsName",this.srsName)}return b},lowerCorner:function(a){var b=this.createElementNSPlus("gml:lowerCorner");this.writeNode("pos",{x:a.left,y:a.bottom},b);return b},upperCorner:function(a){var b=this.createElementNSPlus("gml:upperCorner");this.writeNode("pos",{x:a.right,y:a.top},b);return b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v3"});